(()=>{var e={};e.id=259,e.ids=[259],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16821:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>r.a,__next_app__:()=>h,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>d}),t(20419),t(32487),t(87824);var a=t(93282),n=t(5736),i=t(93906),r=t.n(i),l=t(36880),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d=["",{children:["bookkeeping",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,20419)),"/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,32487)),"/Users/isak/dev/accounts/packages/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,87824,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/page.tsx"],x="/bookkeeping/page",h={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/bookkeeping/page",pathname:"/bookkeeping",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1707:(e,s,t)=>{Promise.resolve().then(t.bind(t,61707))},25619:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(24583).Z)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]])},7527:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(24583).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},72578:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(24583).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},61707:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ei});var a=t(73227),n=t(23677),i=t(79580),r=t(11250),l=t(31086),c=t(18755);let d=(0,l.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=n.forwardRef(({className:e,variant:s,...t},n)=>a.jsx("div",{ref:n,role:"alert",className:(0,c.cn)(d({variant:s}),e),...t}));o.displayName="Alert";let x=n.forwardRef(({className:e,...s},t)=>a.jsx("h5",{ref:t,className:(0,c.cn)("mb-1 font-medium leading-none tracking-tight",e),...s}));x.displayName="AlertTitle";let h=n.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:(0,c.cn)("text-sm [&_p]:leading-relaxed",e),...s}));h.displayName="AlertDescription";var m=t(44467),u=t(24988),j=t(13377),p=t(72578),g=t(25619),f=t(97464),v=t(93126),y=t(60237),N=t(71692),b=t(25515),w=t(24583);let _=(0,w.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),k=(0,w.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var C=t(20426),S=t(80582),Z=t(59298),z=t(49543),M=t(37139),P=t(12198),R=t(39885);function E({tasks:e,onTaskComplete:s}){let[t,i]=(0,n.useState)(new Set),{toast:l}=(0,Z.pm)(),c=async e=>{i(s=>new Set(s).add(e.id));try{switch(e.task_type){case"reconciliation":await d(e.account_id);break;case"categorization":await o(e);break;case"journal_entry":await x(e);break;case"period_closing":await h(e);break;default:l({title:"Task Started",description:`Processing ${e.title}`})}s()}catch(s){console.error("Error processing task:",s),l({title:"Error",description:`Failed to process ${e.title}`,variant:"destructive"})}finally{i(s=>{let t=new Set(s);return t.delete(e.id),t})}},d=async e=>{if(!(await fetch("/api/v1/bookkeeping/reconciliation/start",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({account_id:e})})).ok)throw Error("Failed to start reconciliation");l({title:"Reconciliation Started",description:"Account reconciliation has been initiated"})},o=async e=>{l({title:"Opening Categorization Review",description:`${e.transaction_count} transactions to review`}),window.location.href="/bookkeeping/categorization"},x=async e=>{l({title:"Opening Journal Entry",description:"Review and approve journal entry"}),window.location.href=`/bookkeeping/journal/${e.id}`},h=async e=>{l({title:"Period Closing",description:"Opening period closing workflow"}),window.location.href="/bookkeeping/period-closing"},m=e=>{switch(e){case"high":return a.jsx(v.Z,{className:"h-4 w-4 text-red-600"});case"medium":return a.jsx(y.Z,{className:"h-4 w-4 text-yellow-600"});default:return a.jsx(M.Z,{className:"h-4 w-4 text-blue-600"})}},j=e=>{let s={high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-blue-100 text-blue-800"};return a.jsx(u.C,{className:s[e]||s.low,variant:"outline",children:e})},g=e=>{switch(e){case"reconciliation":return a.jsx(p.Z,{className:"h-4 w-4"});case"journal_entry":return a.jsx(N.Z,{className:"h-4 w-4"});case"categorization":return a.jsx(v.Z,{className:"h-4 w-4"});default:return a.jsx(M.Z,{className:"h-4 w-4"})}};return 0===e.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx(P.Z,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-lg font-medium",children:"All caught up!"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"No pending bookkeeping tasks at this time."})]}):a.jsx("div",{className:"space-y-4",children:(0,a.jsxs)(z.iA,{children:[a.jsx(z.xD,{children:(0,a.jsxs)(z.SC,{children:[a.jsx(z.ss,{children:"Priority"}),a.jsx(z.ss,{children:"Type"}),a.jsx(z.ss,{children:"Task"}),a.jsx(z.ss,{children:"Details"}),a.jsx(z.ss,{children:"Due Date"}),a.jsx(z.ss,{className:"text-right",children:"Action"})]})}),a.jsx(z.RM,{children:e.map(e=>(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[m(e.priority),j(e.priority)]})}),a.jsx(z.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[g(e.task_type),a.jsx("span",{className:"text-sm",children:e.task_type})]})}),a.jsx(z.pj,{children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.title}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]})}),a.jsx(z.pj,{children:(0,a.jsxs)("div",{className:"text-sm",children:[e.account_name&&(0,a.jsxs)("p",{children:["Account: ",e.account_name]}),e.transaction_count&&(0,a.jsxs)("p",{children:[e.transaction_count," transactions"]}),e.amount&&(0,a.jsxs)("p",{children:["$",e.amount.toLocaleString()]})]})}),a.jsx(z.pj,{children:e.due_date?a.jsx("span",{className:"text-sm",children:(0,R.WU)(new Date(e.due_date),"MMM d, yyyy")}):a.jsx("span",{className:"text-sm text-muted-foreground",children:"No deadline"})}),a.jsx(z.pj,{className:"text-right",children:a.jsx(r.z,{size:"sm",onClick:()=>c(e),disabled:t.has(e.id),children:t.has(e.id)?a.jsx(p.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsxs)(a.Fragment,{children:["Process",a.jsx(k,{className:"h-4 w-4 ml-2"})]})})})]},e.id))})]})})}var A=t(73956),$=t(83414),F=t(10237),D=t(63062),T=t(49092),O=t(74871),U=t(28763),I=t(93770);function B({onReconciliationComplete:e}){let[s,t]=(0,n.useState)([]),[l,c]=(0,n.useState)(""),[d,o]=(0,n.useState)([]),[x,h]=(0,n.useState)(""),[m,j]=(0,n.useState)(""),[g,y]=(0,n.useState)(!1),[N,b]=(0,n.useState)(new Set),[w,_]=(0,n.useState)(""),{toast:k}=(0,Z.pm)(),C=async()=>{if(!l||!x||!m){k({title:"Missing Information",description:"Please select an account and enter statement details",variant:"destructive"});return}y(!0);try{let e=await fetch("/api/v1/bookkeeping/reconciliation/start",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({account_id:l,statement_balance:parseFloat(x),statement_date:m})});if(e.ok){let s=await e.json();o(s.items||[]),k({title:"Reconciliation Started",description:`Found ${s.items?.length||0} transactions to reconcile`})}else throw Error("Failed to start reconciliation")}catch(e){console.error("Error starting reconciliation:",e),k({title:"Error",description:"Failed to start reconciliation",variant:"destructive"})}finally{y(!1)}},M=async()=>{if(0===N.size){k({title:"No Items Selected",description:"Please select items to reconcile",variant:"destructive"});return}try{if((await fetch("/api/v1/bookkeeping/reconciliation/confirm",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({account_id:l,reconciled_item_ids:Array.from(N)})})).ok)k({title:"Reconciliation Complete",description:`Successfully reconciled ${N.size} items`}),e(),o([]),b(new Set),h(""),j("");else throw Error("Failed to confirm reconciliation")}catch(e){console.error("Error confirming reconciliation:",e),k({title:"Error",description:"Failed to confirm reconciliation",variant:"destructive"})}},P=e=>{b(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},E=d.filter(e=>""===w||e.statement_description.toLowerCase().includes(w.toLowerCase())||e.transaction?.description.toLowerCase().includes(w.toLowerCase())),B=()=>{let e=d.filter(e=>N.has(e.id)).reduce((e,s)=>e+s.statement_amount,0);return(parseFloat(x)||0)-e};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"Start Reconciliation"}),a.jsx(i.SZ,{children:"Select an account and enter your statement details"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Account"}),(0,a.jsxs)(D.Ph,{value:l,onValueChange:c,children:[a.jsx(D.i4,{children:a.jsx(D.ki,{placeholder:"Select account"})}),a.jsx(D.Bw,{children:s.map(e=>a.jsx(D.Ql,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{children:e.name}),e.unreconciled_transaction_count>0&&(0,a.jsxs)(u.C,{variant:"outline",className:"ml-2",children:[e.unreconciled_transaction_count," unreconciled"]})]})},e.id))})]})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Statement Balance"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(S.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(A.I,{type:"number",placeholder:"0.00",value:x,onChange:e=>h(e.target.value),className:"pl-9"})]})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Statement Date"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(A.I,{type:"date",value:m,onChange:e=>j(e.target.value),className:"pl-9"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(r.z,{onClick:C,disabled:g||!l,children:g?(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Starting..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"Start Reconciliation"]})}),(0,a.jsxs)(r.z,{variant:"outline",children:[a.jsx(T.Z,{className:"h-4 w-4 mr-2"}),"Import Statement"]})]})]})]}),d.length>0&&(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx(i.ll,{children:"Reconciliation Items"}),a.jsx(i.SZ,{children:"Review and match transactions with your statement"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(O.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(A.I,{placeholder:"Search transactions...",value:w,onChange:e=>_(e.target.value),className:"pl-9 w-64"})]}),a.jsx(r.z,{variant:"outline",onClick:()=>{b(new Set(d.filter(e=>e.is_matched).map(e=>e.id)))},children:"Select Matched"})]})]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)(z.iA,{children:[a.jsx(z.xD,{children:(0,a.jsxs)(z.SC,{children:[a.jsx(z.ss,{className:"w-12",children:a.jsx(F.X,{checked:N.size===E.length&&E.length>0,onCheckedChange:e=>{e?b(new Set(E.map(e=>e.id))):b(new Set)}})}),a.jsx(z.ss,{children:"Date"}),a.jsx(z.ss,{children:"Statement Description"}),a.jsx(z.ss,{children:"Matched Transaction"}),a.jsx(z.ss,{className:"text-right",children:"Amount"}),a.jsx(z.ss,{children:"Status"}),a.jsx(z.ss,{children:"Confidence"})]})}),a.jsx(z.RM,{children:E.map(e=>(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{children:a.jsx(F.X,{checked:N.has(e.id),onCheckedChange:()=>P(e.id)})}),a.jsx(z.pj,{children:(0,R.WU)(new Date(e.statement_date),"MMM d, yyyy")}),a.jsx(z.pj,{children:e.statement_description}),a.jsx(z.pj,{children:e.transaction?(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.transaction.description}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.transaction.category})]}):a.jsx("span",{className:"text-muted-foreground",children:"No match found"})}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",Math.abs(e.statement_amount).toFixed(2)]}),a.jsx(z.pj,{children:e.is_matched?(0,a.jsxs)(u.C,{className:"bg-green-100 text-green-800",children:[a.jsx(U.Z,{className:"h-3 w-3 mr-1"}),"Matched"]}):(0,a.jsxs)(u.C,{variant:"outline",children:[a.jsx(v.Z,{className:"h-3 w-3 mr-1"}),"Unmatched"]})}),a.jsx(z.pj,{children:e.match_confidence&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${100*e.match_confidence}%`}})}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Math.round(100*e.match_confidence),"%"]})]})})]},e.id))})]}),a.jsx("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Selected Items"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[N.size," of ",d.length]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Discrepancy"}),(0,a.jsxs)("p",{className:`text-2xl font-bold ${.01>Math.abs(B())?"text-green-600":"text-red-600"}`,children:["$",B().toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",children:[a.jsx(I.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(r.z,{onClick:M,disabled:0===N.size,children:[a.jsx(U.Z,{className:"h-4 w-4 mr-2"}),"Confirm Reconciliation"]})]})]})})]})]})]})}var L=t(58615),q=t(54686),Q=t(77587),J=t(56942),V=t(74431),Y=t(5569),W=t(7527),X=t(13835),G=t(90931),H=t(65248);let K=n.forwardRef(({className:e,...s},t)=>a.jsx("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...s}));function ee({isOpen:e,onClose:s,onSave:t,entry:i}){let[l,c]=(0,n.useState)({entry_date:(0,R.WU)(new Date,"yyyy-MM-dd"),description:"",reference:"",journal_type:"general",lines:[{account_id:"",debit_amount:0,credit_amount:0,description:""},{account_id:"",debit_amount:0,credit_amount:0,description:""}]}),[d,x]=(0,n.useState)([]),[m,u]=(0,n.useState)(!1),{toast:j}=(0,Z.pm)(),p=e=>{if(l.lines.length<=2){j({title:"Minimum Lines Required",description:"A journal entry must have at least 2 lines",variant:"destructive"});return}c(s=>({...s,lines:s.lines.filter((s,t)=>t!==e)}))},g=(e,s,t)=>{c(a=>({...a,lines:a.lines.map((a,n)=>{if(n===e){let e={...a,[s]:t};if("debit_amount"===s&&t>0?e.credit_amount=0:"credit_amount"===s&&t>0&&(e.debit_amount=0),"account_id"===s){let s=d.find(e=>e.id===t);s&&(e.account_code=s.account_code,e.account_name=s.account_name)}return e}return a})}))},f=()=>{let e=l.lines.reduce((e,s)=>e+(s.debit_amount||0),0),s=l.lines.reduce((e,s)=>e+(s.credit_amount||0),0);return{totalDebits:e,totalCredits:s,difference:e-s}},y=()=>{let{totalDebits:e,totalCredits:s}=f();return!(Math.abs(e-s)>.01)&&!!l.entry_date&&!!l.description&&l.lines.every(e=>e.account_id&&(e.debit_amount>0||e.credit_amount>0))},N=async()=>{if(!y()){j({title:"Invalid Entry",description:"Please ensure debits equal credits and all required fields are filled",variant:"destructive"});return}u(!0);try{let e=i?.id?`/api/v1/bookkeeping/journal-entries/${i.id}`:"/api/v1/bookkeeping/journal-entries",s=i?.id?"PUT":"POST";if((await fetch(e,{method:s,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(l)})).ok)j({title:"Success",description:i?.id?"Journal entry updated":"Journal entry created"}),t(l);else throw Error("Failed to save journal entry")}catch(e){console.error("Error saving journal entry:",e),j({title:"Error",description:"Failed to save journal entry",variant:"destructive"})}finally{u(!1)}},{totalDebits:b,totalCredits:w,difference:_}=f();return a.jsx(q.Vq,{open:e,onOpenChange:s,children:(0,a.jsxs)(q.cZ,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(q.fK,{children:[(0,a.jsxs)(q.$N,{children:[i?.id?"Edit":"Create"," Journal Entry"]}),a.jsx(q.Be,{children:"Record a double-entry bookkeeping transaction. Debits must equal credits."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Entry Date"}),a.jsx(A.I,{type:"date",value:l.entry_date,onChange:e=>c(s=>({...s,entry_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Journal Type"}),(0,a.jsxs)(D.Ph,{value:l.journal_type,onValueChange:e=>c(s=>({...s,journal_type:e})),children:[a.jsx(D.i4,{children:a.jsx(D.ki,{})}),(0,a.jsxs)(D.Bw,{children:[a.jsx(D.Ql,{value:"general",children:"General"}),a.jsx(D.Ql,{value:"sales",children:"Sales"}),a.jsx(D.Ql,{value:"purchase",children:"Purchase"}),a.jsx(D.Ql,{value:"cash_receipts",children:"Cash Receipts"}),a.jsx(D.Ql,{value:"cash_disbursements",children:"Cash Disbursements"})]})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Description"}),a.jsx(K,{placeholder:"Enter journal entry description",value:l.description,onChange:e=>c(s=>({...s,description:e.target.value})),rows:2})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Reference (Optional)"}),a.jsx(A.I,{placeholder:"Invoice #, Check #, etc.",value:l.reference,onChange:e=>c(s=>({...s,reference:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx($._,{children:"Entry Lines"}),(0,a.jsxs)(r.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{c(e=>({...e,lines:[...e.lines,{account_id:"",debit_amount:0,credit_amount:0,description:""}]}))},children:[a.jsx(V.Z,{className:"h-4 w-4 mr-2"}),"Add Line"]})]}),(0,a.jsxs)(z.iA,{children:[a.jsx(z.xD,{children:(0,a.jsxs)(z.SC,{children:[a.jsx(z.ss,{children:"Account"}),a.jsx(z.ss,{children:"Description"}),a.jsx(z.ss,{className:"text-right",children:"Debit"}),a.jsx(z.ss,{className:"text-right",children:"Credit"}),a.jsx(z.ss,{className:"w-10"})]})}),(0,a.jsxs)(z.RM,{children:[l.lines.map((e,s)=>(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{children:(0,a.jsxs)(D.Ph,{value:e.account_id,onValueChange:e=>g(s,"account_id",e),children:[a.jsx(D.i4,{children:a.jsx(D.ki,{placeholder:"Select account"})}),a.jsx(D.Bw,{children:d.map(e=>(0,a.jsxs)(D.Ql,{value:e.id,children:[e.account_code," - ",e.account_name]},e.id))})]})}),a.jsx(z.pj,{children:a.jsx(A.I,{placeholder:"Line description",value:e.description,onChange:e=>g(s,"description",e.target.value)})}),a.jsx(z.pj,{children:a.jsx(A.I,{type:"number",step:"0.01",placeholder:"0.00",value:e.debit_amount||"",onChange:e=>g(s,"debit_amount",parseFloat(e.target.value)||0),className:"text-right"})}),a.jsx(z.pj,{children:a.jsx(A.I,{type:"number",step:"0.01",placeholder:"0.00",value:e.credit_amount||"",onChange:e=>g(s,"credit_amount",parseFloat(e.target.value)||0),className:"text-right"})}),a.jsx(z.pj,{children:a.jsx(r.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(s),disabled:l.lines.length<=2,children:a.jsx(H.Z,{className:"h-4 w-4"})})})]},s)),(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{colSpan:2,className:"font-medium",children:"Total"}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",b.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",w.toFixed(2)]}),a.jsx(z.pj,{})]})]})]})]}),Math.abs(_)>.01&&(0,a.jsxs)(o,{variant:"destructive",children:[a.jsx(v.Z,{className:"h-4 w-4"}),(0,a.jsxs)(h,{children:["Entry is not balanced. Difference: $",Math.abs(_).toFixed(2)]})]}),.01>=Math.abs(_)&&b>0&&(0,a.jsxs)(o,{children:[a.jsx(J.Z,{className:"h-4 w-4"}),a.jsx(h,{className:"text-green-600",children:"Entry is balanced. Ready to save."})]})]}),(0,a.jsxs)(q.cN,{children:[a.jsx(r.z,{variant:"outline",onClick:s,disabled:m,children:"Cancel"}),a.jsx(r.z,{onClick:N,disabled:!y()||m,children:m?"Saving...":"Save Entry"})]})]})})}function es(){let[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!0),[c,d]=(0,n.useState)(""),[o,x]=(0,n.useState)("all"),[h,m]=(0,n.useState)("all"),[j,p]=(0,n.useState)(null),[g,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),{toast:N}=(0,Z.pm)(),b=async()=>{try{let e=await fetch("/api/v1/bookkeeping/journal-entries",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){let t=await e.json();s(t.entries||[])}}catch(e){console.error("Error fetching journal entries:",e),N({title:"Error",description:"Failed to fetch journal entries",variant:"destructive"})}finally{l(!1)}},w=async e=>{try{if((await fetch(`/api/v1/bookkeeping/journal-entries/${e}/post`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)N({title:"Entry Posted",description:"Journal entry has been posted successfully"}),b();else throw Error("Failed to post entry")}catch(e){console.error("Error posting entry:",e),N({title:"Error",description:"Failed to post journal entry",variant:"destructive"})}},_=async e=>{if(confirm("Are you sure you want to delete this journal entry?"))try{if((await fetch(`/api/v1/bookkeeping/journal-entries/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)N({title:"Entry Deleted",description:"Journal entry has been deleted"}),b();else throw Error("Failed to delete entry")}catch(e){console.error("Error deleting entry:",e),N({title:"Error",description:"Failed to delete journal entry",variant:"destructive"})}},k=async e=>{y({...e,id:void 0,entry_number:void 0,is_posted:!1,posting_date:null,created_at:void 0}),f(!0)},C=e.filter(e=>{let s=""===c||e.entry_number.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase())||e.reference&&e.reference.toLowerCase().includes(c.toLowerCase()),t="all"===o||e.journal_type===o,a="all"===h||"posted"===h&&e.is_posted||"unposted"===h&&!e.is_posted||"unbalanced"===h&&!e.is_balanced;return s&&t&&a}),S=e=>e.is_balanced?e.is_posted?(0,a.jsxs)(u.C,{className:"bg-green-100 text-green-800",children:[a.jsx(J.Z,{className:"h-3 w-3 mr-1"}),"Posted"]}):a.jsx(u.C,{variant:"outline",children:"Unposted"}):(0,a.jsxs)(u.C,{variant:"destructive",children:[a.jsx(Q.Z,{className:"h-3 w-3 mr-1"}),"Unbalanced"]}),M=e=>e?a.jsx(u.C,{className:{plaid_sync:"bg-blue-100 text-blue-800",manual:"bg-gray-100 text-gray-800",recurring:"bg-purple-100 text-purple-800",adjustment:"bg-yellow-100 text-yellow-800"}[e]||"bg-gray-100 text-gray-800",variant:"outline",children:e}):null;return t?a.jsx(i.Zb,{children:a.jsx(i.aY,{className:"flex items-center justify-center h-96",children:a.jsx("p",{className:"text-muted-foreground",children:"Loading journal entries..."})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx(i.ll,{children:"Journal Entries"}),a.jsx(i.SZ,{children:"Manage and review double-entry bookkeeping records"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>{let s=new Blob([e.map(e=>`${e.entry_number},${e.entry_date},${e.description},${e.total_debits},${e.total_credits}`).join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`journal_entries_${(0,R.WU)(new Date,"yyyy-MM-dd")}.csv`,a.click()},children:[a.jsx(I.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(r.z,{onClick:()=>f(!0),children:[a.jsx(V.Z,{className:"h-4 w-4 mr-2"}),"New Entry"]})]})]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[a.jsx(O.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(A.I,{placeholder:"Search entries...",value:c,onChange:e=>d(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(D.Ph,{value:o,onValueChange:x,children:[a.jsx(D.i4,{className:"w-40",children:a.jsx(D.ki,{placeholder:"Filter by type"})}),(0,a.jsxs)(D.Bw,{children:[a.jsx(D.Ql,{value:"all",children:"All Types"}),a.jsx(D.Ql,{value:"general",children:"General"}),a.jsx(D.Ql,{value:"sales",children:"Sales"}),a.jsx(D.Ql,{value:"purchase",children:"Purchase"}),a.jsx(D.Ql,{value:"cash_receipts",children:"Cash Receipts"}),a.jsx(D.Ql,{value:"cash_disbursements",children:"Cash Disbursements"})]})]}),(0,a.jsxs)(D.Ph,{value:h,onValueChange:m,children:[a.jsx(D.i4,{className:"w-40",children:a.jsx(D.ki,{placeholder:"Filter by status"})}),(0,a.jsxs)(D.Bw,{children:[a.jsx(D.Ql,{value:"all",children:"All Status"}),a.jsx(D.Ql,{value:"posted",children:"Posted"}),a.jsx(D.Ql,{value:"unposted",children:"Unposted"}),a.jsx(D.Ql,{value:"unbalanced",children:"Unbalanced"})]})]})]}),(0,a.jsxs)(z.iA,{children:[a.jsx(z.xD,{children:(0,a.jsxs)(z.SC,{children:[a.jsx(z.ss,{children:"Entry #"}),a.jsx(z.ss,{children:"Date"}),a.jsx(z.ss,{children:"Description"}),a.jsx(z.ss,{children:"Reference"}),a.jsx(z.ss,{children:"Type"}),a.jsx(z.ss,{className:"text-right",children:"Debits"}),a.jsx(z.ss,{className:"text-right",children:"Credits"}),a.jsx(z.ss,{children:"Status"}),a.jsx(z.ss,{children:"Source"}),a.jsx(z.ss,{className:"text-right",children:"Actions"})]})}),a.jsx(z.RM,{children:C.map(e=>(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{className:"font-medium",children:e.entry_number}),a.jsx(z.pj,{children:(0,R.WU)(new Date(e.entry_date),"MMM d, yyyy")}),a.jsx(z.pj,{className:"max-w-xs truncate",children:e.description}),a.jsx(z.pj,{children:e.reference||"-"}),a.jsx(z.pj,{children:e.journal_type||"General"}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",e.total_debits.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",e.total_credits.toFixed(2)]}),a.jsx(z.pj,{children:S(e)}),a.jsx(z.pj,{children:M(e.source_type)}),a.jsx(z.pj,{className:"text-right",children:(0,a.jsxs)(L.h_,{children:[a.jsx(L.$F,{asChild:!0,children:a.jsx(r.z,{variant:"ghost",size:"sm",children:a.jsx(Y.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(L.AW,{align:"end",children:[a.jsx(L.Ju,{children:"Actions"}),(0,a.jsxs)(L.Xi,{onClick:()=>p(e),children:[a.jsx(W.Z,{className:"h-4 w-4 mr-2"}),"View Details"]}),!e.is_posted&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(L.Xi,{onClick:()=>{y(e),f(!0)},children:[a.jsx(X.Z,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,a.jsxs)(L.Xi,{onClick:()=>w(e.id),children:[a.jsx(J.Z,{className:"h-4 w-4 mr-2"}),"Post Entry"]})]}),(0,a.jsxs)(L.Xi,{onClick:()=>k(e),children:[a.jsx(G.Z,{className:"h-4 w-4 mr-2"}),"Duplicate"]}),a.jsx(L.VD,{}),!e.is_posted&&(0,a.jsxs)(L.Xi,{onClick:()=>_(e.id),className:"text-red-600",children:[a.jsx(H.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))})]})]})]}),j&&a.jsx(q.Vq,{open:!!j,onOpenChange:()=>p(null),children:(0,a.jsxs)(q.cZ,{className:"max-w-3xl",children:[(0,a.jsxs)(q.fK,{children:[(0,a.jsxs)(q.$N,{children:["Journal Entry #",j.entry_number]}),a.jsx(q.Be,{children:j.description})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Date:"})," ",(0,R.WU)(new Date(j.entry_date),"MMM d, yyyy")]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Reference:"})," ",j.reference||"N/A"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Type:"})," ",j.journal_type||"General"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Status:"})," ",j.is_posted?"Posted":"Unposted"]})]}),(0,a.jsxs)(z.iA,{children:[a.jsx(z.xD,{children:(0,a.jsxs)(z.SC,{children:[a.jsx(z.ss,{children:"Account"}),a.jsx(z.ss,{children:"Description"}),a.jsx(z.ss,{className:"text-right",children:"Debit"}),a.jsx(z.ss,{className:"text-right",children:"Credit"})]})}),(0,a.jsxs)(z.RM,{children:[j.lines.map(e=>(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.account_code}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.account_name})]})}),a.jsx(z.pj,{children:e.description||"-"}),a.jsx(z.pj,{className:"text-right",children:e.debit_amount>0?`$${e.debit_amount.toFixed(2)}`:"-"}),a.jsx(z.pj,{className:"text-right",children:e.credit_amount>0?`$${e.credit_amount.toFixed(2)}`:"-"})]},e.id)),(0,a.jsxs)(z.SC,{children:[a.jsx(z.pj,{colSpan:2,className:"font-medium",children:"Total"}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",j.total_debits.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",j.total_credits.toFixed(2)]})]})]})]})]})]})}),g&&a.jsx(ee,{isOpen:g,onClose:()=>{f(!1),y(null)},onSave:()=>{f(!1),y(null),b()},entry:v})]})}function et({isOpen:e,onClose:s,onPeriodClosed:t}){let[i,l]=(0,n.useState)(""),[c,d]=(0,n.useState)([]),[m,g]=(0,n.useState)([]),[N,b]=(0,n.useState)(!1),[w,_]=(0,n.useState)(0),[C,S]=(0,n.useState)(!1),{toast:z}=(0,Z.pm)(),M=async()=>{b(!0);for(let e=0;e<m.length;e++){let s=m[e];if(_(e),g(e=>e.map(e=>e.id===s.id?{...e,status:"in_progress"}:e)),await new Promise(e=>setTimeout(e,1500)),s.warning&&Math.random()>.7&&s.required){g(e=>e.map(e=>e.id===s.id?{...e,status:"failed"}:e)),b(!1),z({title:"Period Closing Failed",description:`Failed at step: ${s.task}. ${s.warning}`,variant:"destructive"});return}g(e=>e.map(e=>e.id===s.id?{...e,status:"completed"}:e))}await P()},P=async()=>{try{if((await fetch("/api/v1/bookkeeping/periods/close",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({period_id:i})})).ok)z({title:"Period Closed Successfully",description:"The accounting period has been closed and locked"}),t(),s();else throw Error("Failed to close period")}catch(e){console.error("Error closing period:",e),z({title:"Error",description:"Failed to close the period",variant:"destructive"})}finally{b(!1)}},E=e=>{switch(e){case"completed":return a.jsx(U.Z,{className:"h-4 w-4 text-green-600"});case"in_progress":return a.jsx(p.Z,{className:"h-4 w-4 text-blue-600 animate-spin"});case"failed":return a.jsx(v.Z,{className:"h-4 w-4 text-red-600"});default:return a.jsx(f.Z,{className:"h-4 w-4 text-gray-400"})}};return a.jsx(q.Vq,{open:e,onOpenChange:s,children:(0,a.jsxs)(q.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(q.fK,{children:[a.jsx(q.$N,{children:"Close Accounting Period"}),a.jsx(q.Be,{children:"Complete all required tasks before closing the period. Once closed, the period will be locked and no changes can be made."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx($._,{children:"Select Period to Close"}),(0,a.jsxs)(D.Ph,{value:i,onValueChange:l,children:[a.jsx(D.i4,{children:a.jsx(D.ki,{placeholder:"Select accounting period"})}),a.jsx(D.Bw,{children:c.map(e=>a.jsx(D.Ql,{value:e.id,children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.period_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,R.WU)(new Date(e.start_date),"MMM d")," - ",(0,R.WU)(new Date(e.end_date),"MMM d, yyyy")]})]})},e.id))})]})]}),N&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium",children:"Closing Progress"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Math.round(m.filter(e=>"completed"===e.status).length/m.length*100),"%"]})]}),a.jsx(j.E,{value:m.filter(e=>"completed"===e.status).length/m.length*100})]}),(0,a.jsxs)("div",{children:[a.jsx($._,{className:"mb-2",children:"Period Closing Checklist"}),a.jsx("div",{className:"space-y-2 border rounded-lg p-4",children:m.map((e,s)=>(0,a.jsxs)("div",{className:`flex items-start gap-3 p-2 rounded ${s===w&&N?"bg-blue-50":""}`,children:[E(e.status),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:`font-medium ${"completed"===e.status?"line-through text-muted-foreground":""}`,children:e.task}),e.required&&a.jsx(u.C,{variant:"outline",className:"text-xs",children:"Required"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),e.warning&&"pending"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[a.jsx(y.Z,{className:"h-3 w-3 text-yellow-600"}),a.jsx("span",{className:"text-xs text-yellow-600",children:e.warning})]})]})]},e.id))})]}),(0,a.jsxs)(o,{children:[a.jsx(v.Z,{className:"h-4 w-4"}),a.jsx(x,{children:"Important Notice"}),a.jsx(h,{children:"Closing a period is irreversible. Once closed, you cannot make any changes to transactions or journal entries within this period. Please ensure all data is accurate before proceeding."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(F.X,{checked:C,onCheckedChange:e=>S(e),disabled:N}),a.jsx($._,{className:"text-sm",children:"I confirm that all financial data for this period is accurate and complete"})]})]}),(0,a.jsxs)(q.cN,{children:[a.jsx(r.z,{variant:"outline",onClick:s,disabled:N,children:"Cancel"}),a.jsx(r.z,{onClick:M,disabled:!i||!C||N,children:N?(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Closing Period..."]}):(0,a.jsxs)(a.Fragment,{children:["Close Period",a.jsx(k,{className:"h-4 w-4 ml-2"})]})})]})]})})}function ea({health:e}){let s=(e,s)=>0===e?"text-green-600":e<=s/2?"text-yellow-600":e<=s?"text-orange-600":"text-red-600",t=Math.max(0,Math.min(100,100-5*e.unreconciled_accounts-2*e.pending_journal_entries-3*e.days_behind_reconciliation-(100-e.ml_categorization_accuracy)*.5));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium",children:"Overall Health Score"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[t,"%"]})]}),a.jsx(j.E,{value:t,className:t<50?"bg-red-100":t<75?"bg-yellow-100":"bg-green-100"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(_,{className:`h-4 w-4 ${s(e.unreconciled_accounts,5)}`}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"Unreconciled"})]}),a.jsx("div",{className:"text-2xl font-bold",children:e.unreconciled_accounts}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"accounts"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(v.Z,{className:`h-4 w-4 ${s(e.pending_journal_entries,10)}`}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"Pending"})]}),a.jsx("div",{className:"text-2xl font-bold",children:e.pending_journal_entries}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"journal entries"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(M.Z,{className:`h-4 w-4 ${s(e.days_behind_reconciliation,7)}`}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"Days Behind"})]}),a.jsx("div",{className:"text-2xl font-bold",children:e.days_behind_reconciliation}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"reconciliation"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(C.Z,{className:`h-4 w-4 ${e.ml_categorization_accuracy>=90?"text-green-600":e.ml_categorization_accuracy>=75?"text-yellow-600":"text-red-600"}`}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"ML Accuracy"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[e.ml_categorization_accuracy,"%"]}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"categorization"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[e.unreconciled_accounts>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(y.Z,{className:"h-4 w-4 text-yellow-600"}),(0,a.jsxs)("span",{children:[e.unreconciled_accounts," accounts need reconciliation"]})]}),e.pending_categorizations>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(v.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("span",{children:[e.pending_categorizations," transactions pending categorization"]})]}),"healthy"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(U.Z,{className:"h-4 w-4 text-green-600"}),a.jsx("span",{children:"All systems operating normally"})]})]})]})}function en(){let[e,s]=(0,n.useState)(null),[t,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0),[w,z]=(0,n.useState)("overview"),[M,P]=(0,n.useState)(!1),[R,A]=(0,n.useState)(!1),{toast:$}=(0,Z.pm)(),F=async()=>{try{P(!0);let e=await fetch("/api/v1/bookkeeping/health",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){let t=await e.json();s(t)}let t=await fetch("/api/v1/bookkeeping/pending-tasks",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){let e=await t.json();l(e.tasks||[])}}catch(e){console.error("Error fetching bookkeeping data:",e),$({title:"Error",description:"Failed to fetch bookkeeping data",variant:"destructive"})}finally{d(!1),P(!1)}};return c?a.jsx("div",{className:"flex items-center justify-center h-96",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx(p.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),a.jsx("p",{className:"text-muted-foreground",children:"Loading bookkeeping data..."})]})}):(0,a.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[a.jsx(g.Z,{className:"h-8 w-8 text-primary"}),"Bookkeeping & Reconciliation"]}),a.jsx("p",{className:"text-muted-foreground mt-1",children:"Automated double-entry bookkeeping with ML-powered categorization"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>F(),disabled:M,children:[a.jsx(p.Z,{className:`h-4 w-4 mr-2 ${M?"animate-spin":""}`}),"Refresh"]}),(0,a.jsxs)(r.z,{onClick:()=>A(!0),children:[a.jsx(f.Z,{className:"h-4 w-4 mr-2"}),"Close Period"]})]})]}),e&&"critical"===e.status&&(0,a.jsxs)(o,{variant:"destructive",children:[a.jsx(v.Z,{className:"h-4 w-4"}),a.jsx(x,{children:"Critical Bookkeeping Issues"}),(0,a.jsxs)(h,{children:["Your bookkeeping is ",e.days_behind_reconciliation," days behind.",e.unreconciled_accounts," accounts need reconciliation. Immediate attention required to maintain accurate financial records."]})]}),t.filter(e=>"high"===e.priority).length>0&&(0,a.jsxs)(o,{children:[a.jsx(y.Z,{className:"h-4 w-4"}),a.jsx(x,{children:"High Priority Tasks"}),(0,a.jsxs)(h,{children:["You have ",t.filter(e=>"high"===e.priority).length," high priority bookkeeping tasks that need attention."]})]}),e&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"Bookkeeping Health Status"}),a.jsx(i.SZ,{children:"Overall system health and key metrics"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(u.C,{className:(e=>{switch(e){case"healthy":return"text-green-600 bg-green-100";case"warning":return"text-yellow-600 bg-yellow-100";case"behind":return"text-orange-600 bg-orange-100";case"critical":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}})(e.status),variant:"outline",children:e.status.toUpperCase()}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Last reconciliation: ",e.last_reconciliation_date||"Never"]})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current Period: ",e.current_period_status]})]}),a.jsx(ea,{health:e})]})]}),(0,a.jsxs)(m.mQ,{value:w,onValueChange:z,children:[(0,a.jsxs)(m.dr,{className:"grid w-full grid-cols-4",children:[a.jsx(m.SP,{value:"overview",children:"Overview"}),a.jsx(m.SP,{value:"reconciliation",children:"Reconciliation"}),a.jsx(m.SP,{value:"journal",children:"Journal Entries"}),a.jsx(m.SP,{value:"automation",children:"Automation"})]}),(0,a.jsxs)(m.nU,{value:"overview",className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"Pending Tasks"}),a.jsx(i.SZ,{children:"Tasks requiring manual review or action"})]}),a.jsx(i.aY,{children:a.jsx(E,{tasks:t,onTaskComplete:F})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"Quick Actions"}),a.jsx(i.SZ,{children:"Common bookkeeping operations"})]}),(0,a.jsxs)(i.aY,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[a.jsx(N.Z,{className:"h-5 w-5 mb-2"}),a.jsx("span",{className:"text-xs",children:"Create Entry"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[a.jsx(p.Z,{className:"h-5 w-5 mb-2"}),a.jsx("span",{className:"text-xs",children:"Reconcile All"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[a.jsx(b.Z,{className:"h-5 w-5 mb-2"}),a.jsx("span",{className:"text-xs",children:"Train ML"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[a.jsx(_,{className:"h-5 w-5 mb-2"}),a.jsx("span",{className:"text-xs",children:"Export Data"})]})]})]})]}),a.jsx(m.nU,{value:"reconciliation",children:a.jsx(B,{onReconciliationComplete:F})}),a.jsx(m.nU,{value:"journal",children:a.jsx(es,{})}),(0,a.jsxs)(m.nU,{value:"automation",className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"ML Categorization"}),a.jsx(i.SZ,{children:"Machine learning model performance and training"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium",children:"Accuracy"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e?.ml_categorization_accuracy||0,"%"]})]}),a.jsx(j.E,{value:e?.ml_categorization_accuracy||0})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Pending Categorizations"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e?.pending_categorizations||0," transactions need review"]})]}),(0,a.jsxs)(r.z,{children:["Review",a.jsx(k,{className:"h-4 w-4 ml-2"})]})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full",children:[a.jsx(b.Z,{className:"h-4 w-4 mr-2"}),"Retrain Model"]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:"Automation Rules"}),a.jsx(i.SZ,{children:"Configure automated bookkeeping rules"})]}),a.jsx(i.aY,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(N.Z,{className:"h-4 w-4 mr-2"}),"Manage Journal Entry Templates"]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(C.Z,{className:"h-4 w-4 mr-2"}),"Configure Accrual Rules"]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(S.Z,{className:"h-4 w-4 mr-2"}),"Set Categorization Rules"]})]})})]})]})]}),R&&a.jsx(et,{isOpen:R,onClose:()=>A(!1),onPeriodClosed:F})]})}function ei(){return a.jsx(en,{})}K.displayName="Textarea"},58615:(e,s,t)=>{"use strict";t.d(s,{$F:()=>x,AW:()=>h,Ju:()=>j,VD:()=>p,Xi:()=>m,bO:()=>u,h_:()=>o});var a=t(73227),n=t(23677),i=t(27237),r=t(25749),l=t(56942),c=t(38880),d=t(18755);let o=i.fC,x=i.xz;i.ZA,i.Uv,i.Tr,i.Ee,n.forwardRef(({className:e,inset:s,children:t,...n},l)=>(0,a.jsxs)(i.fF,{ref:l,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",e),...n,children:[t,a.jsx(r.Z,{className:"ml-auto h-4 w-4"})]})).displayName=i.fF.displayName,n.forwardRef(({className:e,...s},t)=>a.jsx(i.tu,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})).displayName=i.tu.displayName;let h=n.forwardRef(({className:e,sideOffset:s=4,...t},n)=>a.jsx(i.Uv,{children:a.jsx(i.VY,{ref:n,sideOffset:s,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));h.displayName=i.VY.displayName;let m=n.forwardRef(({className:e,inset:s,...t},n)=>a.jsx(i.ck,{ref:n,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...t}));m.displayName=i.ck.displayName;let u=n.forwardRef(({className:e,children:s,checked:t,...n},r)=>(0,a.jsxs)(i.oC,{ref:r,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:t,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(i.wU,{children:a.jsx(l.Z,{className:"h-4 w-4"})})}),s]}));u.displayName=i.oC.displayName,n.forwardRef(({className:e,children:s,...t},n)=>(0,a.jsxs)(i.Rk,{ref:n,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(i.wU,{children:a.jsx(c.Z,{className:"h-2 w-2 fill-current"})})}),s]})).displayName=i.Rk.displayName;let j=n.forwardRef(({className:e,inset:s,...t},n)=>a.jsx(i.__,{ref:n,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...t}));j.displayName=i.__.displayName;let p=n.forwardRef(({className:e,...s},t)=>a.jsx(i.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...s}));p.displayName=i.Z0.displayName},49543:(e,s,t)=>{"use strict";t.d(s,{RM:()=>c,SC:()=>d,iA:()=>r,pj:()=>x,ss:()=>o,xD:()=>l});var a=t(73227),n=t(23677),i=t(18755);let r=n.forwardRef(({className:e,...s},t)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",e),...s})}));r.displayName="Table";let l=n.forwardRef(({className:e,...s},t)=>a.jsx("thead",{ref:t,className:(0,i.cn)("[&_tr]:border-b",e),...s}));l.displayName="TableHeader";let c=n.forwardRef(({className:e,...s},t)=>a.jsx("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",e),...s}));c.displayName="TableBody",n.forwardRef(({className:e,...s},t)=>a.jsx("tfoot",{ref:t,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";let d=n.forwardRef(({className:e,...s},t)=>a.jsx("tr",{ref:t,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));d.displayName="TableRow";let o=n.forwardRef(({className:e,...s},t)=>a.jsx("th",{ref:t,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));o.displayName="TableHead";let x=n.forwardRef(({className:e,...s},t)=>a.jsx("td",{ref:t,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));x.displayName="TableCell",n.forwardRef(({className:e,...s},t)=>a.jsx("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption"},59298:(e,s,t)=>{"use strict";t.d(s,{pm:()=>a.pm});var a=t(95084)},20419:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(53189).createProxy)(String.raw`/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[193,858,846,153,878,610,92,754],()=>t(16821));module.exports=a})();