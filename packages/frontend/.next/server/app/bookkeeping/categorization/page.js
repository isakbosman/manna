(()=>{var e={};e.id=277,e.ids=[277],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},53572:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>c}),a(96734),a(32487),a(87824);var s=a(93282),r=a(5736),i=a(93906),n=a.n(i),l=a(36880),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let c=["",{children:["bookkeeping",{children:["categorization",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,96734)),"/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/categorization/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,32487)),"/Users/isak/dev/accounts/packages/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,87824,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/categorization/page.tsx"],m="/bookkeeping/categorization/page",x={require:a,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/bookkeeping/categorization/page",pathname:"/bookkeeping/categorization",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},22223:(e,t,a)=>{Promise.resolve().then(a.bind(a,37155))},72578:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(24583).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},34666:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(24583).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},37155:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var s=a(73227),r=a(23677),i=a(79580),n=a(11250),l=a(24988),o=a(13377),c=a(63062),d=a(49543),m=a(10237),x=a(72578),h=a(25515),p=a(34666),g=a(56942),u=a(71692),f=a(39885),j=a(59298);function y(){let[e,t]=(0,r.useState)([]),[a,y]=(0,r.useState)([]),[b,v]=(0,r.useState)([]),[N,w]=(0,r.useState)(new Set),[k,_]=(0,r.useState)(""),[S,z]=(0,r.useState)(""),[C,A]=(0,r.useState)(!1),[Z,M]=(0,r.useState)(0),[R,P]=(0,r.useState)(!0),{toast:T}=(0,j.pm)(),E=async()=>{try{let e=await fetch("/api/v1/transactions/uncategorized",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){let a=await e.json();t(a.transactions||[])}let a=await fetch("/api/v1/categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){let e=await a.json();y(e.categories||[])}let s=await fetch("/api/v1/tax-categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){let e=await s.json();v(e.categories||[])}let r=await fetch("/api/v1/ml/model-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(r.ok){let e=await r.json();M(e.accuracy||0)}}catch(e){console.error("Error fetching data:",e)}finally{P(!1)}},$=e=>{w(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},F=async()=>{let t=e.filter(e=>N.has(e.id)&&e.suggested_category);if(0===t.length){T({title:"No Suggestions",description:"Select transactions with suggestions to apply",variant:"destructive"});return}A(!0);try{let e=t.map(e=>({transaction_id:e.id,category_id:e.suggested_category.id,tax_category_id:e.suggested_tax_category?.id}));if((await fetch("/api/v1/transactions/bulk-categorize",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({updates:e})})).ok)T({title:"Categories Applied",description:`Successfully categorized ${t.length} transactions`}),E(),w(new Set);else throw Error("Failed to apply categories")}catch(e){console.error("Error applying categories:",e),T({title:"Error",description:"Failed to apply categories",variant:"destructive"})}finally{A(!1)}},B=async()=>{if(!k||0===N.size){T({title:"Selection Required",description:"Select transactions and a category",variant:"destructive"});return}A(!0);try{let e=Array.from(N).map(e=>({transaction_id:e,category_id:k,tax_category_id:S||void 0}));if((await fetch("/api/v1/transactions/bulk-categorize",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({updates:e,train_model:!0})})).ok)T({title:"Categories Applied",description:`Successfully categorized ${N.size} transactions`}),E(),w(new Set),_(""),z("");else throw Error("Failed to apply categories")}catch(e){console.error("Error applying categories:",e),T({title:"Error",description:"Failed to apply categories",variant:"destructive"})}finally{A(!1)}},q=async()=>{A(!0);try{let e=await fetch("/api/v1/ml/train",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){let t=await e.json();T({title:"Model Training Complete",description:`New accuracy: ${(100*t.accuracy).toFixed(1)}%`}),M(100*t.accuracy)}else throw Error("Failed to train model")}catch(e){console.error("Error training model:",e),T({title:"Error",description:"Failed to train model",variant:"destructive"})}finally{A(!1)}},O=e=>e>=.9?(0,s.jsxs)(l.C,{className:"bg-green-100 text-green-800",children:["High (",(100*e).toFixed(0),"%)"]}):e>=.7?(0,s.jsxs)(l.C,{className:"bg-yellow-100 text-yellow-800",children:["Medium (",(100*e).toFixed(0),"%)"]}):(0,s.jsxs)(l.C,{className:"bg-red-100 text-red-800",children:["Low (",(100*e).toFixed(0),"%)"]});return R?s.jsx(i.Zb,{children:s.jsx(i.aY,{className:"flex items-center justify-center h-96",children:s.jsx(x.Z,{className:"h-8 w-8 animate-spin text-primary"})})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(i.Zb,{children:[s.jsx(i.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(i.ll,{className:"flex items-center gap-2",children:[s.jsx(h.Z,{className:"h-5 w-5 text-primary"}),"ML Categorization Engine"]}),s.jsx(i.SZ,{children:"Automated transaction categorization using machine learning"})]}),(0,s.jsxs)(n.z,{onClick:q,disabled:C,children:[s.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"Train Model"]})]})}),s.jsx(i.aY,{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Model Accuracy"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(o.E,{value:Z,className:"flex-1"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[Z.toFixed(1),"%"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Uncategorized"}),s.jsx("p",{className:"text-2xl font-bold",children:e.length})]}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"High Confidence"}),s.jsx("p",{className:"text-2xl font-bold",children:e.filter(e=>e.suggested_category?.confidence&&e.suggested_category.confidence>.9).length})]})]})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[s.jsx(i.ll,{children:"Bulk Categorization"}),s.jsx(i.SZ,{children:"Select multiple transactions to categorize at once"})]}),(0,s.jsxs)(i.aY,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(c.Ph,{value:k,onValueChange:_,children:[s.jsx(c.i4,{className:"flex-1",children:s.jsx(c.ki,{placeholder:"Select category"})}),s.jsx(c.Bw,{children:a.map(e=>s.jsx(c.Ql,{value:e.id,children:e.name},e.id))})]}),(0,s.jsxs)(c.Ph,{value:S,onValueChange:z,children:[s.jsx(c.i4,{className:"flex-1",children:s.jsx(c.ki,{placeholder:"Select tax category (optional)"})}),s.jsx(c.Bw,{children:b.map(e=>(0,s.jsxs)(c.Ql,{value:e.id,children:[e.code," - ",e.name]},e.id))})]}),(0,s.jsxs)(n.z,{onClick:B,disabled:!k||0===N.size||C,children:["Apply to ",N.size," Selected"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[s.jsx(n.z,{variant:"outline",onClick:()=>{w(new Set(e.filter(e=>e.suggested_category&&e.suggested_category.confidence>.8).map(e=>e.id)))},disabled:C,children:"Select High Confidence"}),(0,s.jsxs)(n.z,{variant:"outline",onClick:F,disabled:0===N.size||C,children:[s.jsx(g.Z,{className:"h-4 w-4 mr-2"}),"Apply Suggestions"]})]})]})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[s.jsx(i.ll,{children:"Uncategorized Transactions"}),s.jsx(i.SZ,{children:"Review and categorize transactions with ML suggestions"})]}),s.jsx(i.aY,{children:0===e.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[s.jsx(g.Z,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),s.jsx("p",{className:"text-lg font-medium",children:"All transactions categorized!"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"No transactions require categorization at this time."})]}):(0,s.jsxs)(d.iA,{children:[s.jsx(d.xD,{children:(0,s.jsxs)(d.SC,{children:[s.jsx(d.ss,{className:"w-12",children:s.jsx(m.X,{checked:N.size===e.length&&e.length>0,onCheckedChange:t=>{t?w(new Set(e.map(e=>e.id))):w(new Set)}})}),s.jsx(d.ss,{children:"Date"}),s.jsx(d.ss,{children:"Description"}),s.jsx(d.ss,{className:"text-right",children:"Amount"}),s.jsx(d.ss,{children:"Suggested Category"}),s.jsx(d.ss,{children:"Tax Category"}),s.jsx(d.ss,{children:"Confidence"}),s.jsx(d.ss,{children:"Actions"})]})}),s.jsx(d.RM,{children:e.map(e=>(0,s.jsxs)(d.SC,{children:[s.jsx(d.pj,{children:s.jsx(m.X,{checked:N.has(e.id),onCheckedChange:()=>$(e.id)})}),s.jsx(d.pj,{children:(0,f.WU)(new Date(e.date),"MMM d")}),s.jsx(d.pj,{children:(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium",children:e.description}),e.merchant_name&&s.jsx("p",{className:"text-sm text-muted-foreground",children:e.merchant_name})]})}),(0,s.jsxs)(d.pj,{className:"text-right",children:["$",Math.abs(e.amount).toFixed(2)]}),s.jsx(d.pj,{children:e.suggested_category?s.jsx(l.C,{variant:"outline",children:e.suggested_category.name}):s.jsx("span",{className:"text-muted-foreground",children:"No suggestion"})}),s.jsx(d.pj,{children:e.suggested_tax_category?s.jsx(l.C,{variant:"outline",className:"text-xs",children:e.suggested_tax_category.code}):"-"}),s.jsx(d.pj,{children:e.suggested_category&&O(e.suggested_category.confidence)}),s.jsx(d.pj,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[e.suggested_category&&s.jsx(n.z,{size:"sm",variant:"ghost",onClick:()=>{w(new Set([e.id])),F()},title:"Accept suggestion",children:s.jsx(g.Z,{className:"h-4 w-4 text-green-600"})}),s.jsx(n.z,{size:"sm",variant:"ghost",onClick:()=>{T({title:"Similar Transactions",description:`Found ${e.similar_transactions?.length||0} similar transactions`})},title:"View similar",children:s.jsx(u.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})}function b(){return s.jsx("div",{className:"container mx-auto py-6",children:s.jsx(y,{})})}},24988:(e,t,a)=>{"use strict";a.d(t,{C:()=>l});var s=a(73227);a(23677);var r=a(31086),i=a(18755);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary-600 text-white hover:bg-primary-700",secondary:"border-transparent bg-secondary-100 text-secondary-900 hover:bg-secondary-200",destructive:"border-transparent bg-error-600 text-white hover:bg-error-700",outline:"text-foreground",success:"border-transparent bg-success-600 text-white hover:bg-success-700",warning:"border-transparent bg-warning-600 text-white hover:bg-warning-700",info:"border-transparent bg-info-600 text-white hover:bg-info-700"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...a}){return s.jsx("div",{className:(0,i.cn)(n({variant:t}),e),...a})}},10237:(e,t,a)=>{"use strict";a.d(t,{X:()=>n});var s=a(73227),r=a(23677),i=a(18755);let n=r.forwardRef(({className:e,label:t,description:a,error:r,...n},l)=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[s.jsx("div",{className:"relative flex items-center",children:s.jsx("input",{type:"checkbox",className:(0,i.cn)("h-4 w-4 rounded border-neutral-300 text-primary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 disabled:cursor-not-allowed disabled:opacity-50",r&&"border-error-500 focus:border-error-500 focus:ring-error-500",e),ref:l,...n})}),t&&(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-sm font-medium text-neutral-900",children:t}),a&&s.jsx("p",{className:"text-sm text-neutral-600",children:a})]})]}),r&&s.jsx("p",{className:"text-sm text-error-600",children:r})]}));n.displayName="Checkbox"},13377:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var s=a(73227),r=a(23677),i=a(37620),n=a(18755);let l=r.forwardRef(({className:e,value:t,...a},r)=>s.jsx(i.fC,{ref:r,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:s.jsx(i.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));l.displayName=i.fC.displayName},63062:(e,t,a)=>{"use strict";a.d(t,{Bw:()=>g,Ph:()=>d,Ql:()=>u,i4:()=>x,ki:()=>m});var s=a(73227),r=a(23677),i=a(52375),n=a(65327),l=a(87090),o=a(56942),c=a(18755);let d=i.fC;i.ZA;let m=i.B4,x=r.forwardRef(({className:e,children:t,...a},r)=>(0,s.jsxs)(i.xz,{ref:r,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-neutral-300 bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[t,s.jsx(i.JO,{asChild:!0,children:s.jsx(n.Z,{className:"h-4 w-4 opacity-50"})})]}));x.displayName=i.xz.displayName;let h=r.forwardRef(({className:e,...t},a)=>s.jsx(i.u_,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(l.Z,{className:"h-4 w-4"})}));h.displayName=i.u_.displayName;let p=r.forwardRef(({className:e,...t},a)=>s.jsx(i.$G,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(n.Z,{className:"h-4 w-4"})}));p.displayName=i.$G.displayName;let g=r.forwardRef(({className:e,children:t,position:a="popper",...r},n)=>s.jsx(i.h_,{children:(0,s.jsxs)(i.VY,{ref:n,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[s.jsx(h,{}),s.jsx(i.l_,{className:(0,c.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),s.jsx(p,{})]})}));g.displayName=i.VY.displayName,r.forwardRef(({className:e,...t},a)=>s.jsx(i.__,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=i.__.displayName;let u=r.forwardRef(({className:e,children:t,...a},r)=>(0,s.jsxs)(i.ck,{ref:r,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(i.wU,{children:s.jsx(o.Z,{className:"h-4 w-4"})})}),s.jsx(i.eT,{children:t})]}));u.displayName=i.ck.displayName,r.forwardRef(({className:e,...t},a)=>s.jsx(i.Z0,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=i.Z0.displayName},49543:(e,t,a)=>{"use strict";a.d(t,{RM:()=>o,SC:()=>c,iA:()=>n,pj:()=>m,ss:()=>d,xD:()=>l});var s=a(73227),r=a(23677),i=a(18755);let n=r.forwardRef(({className:e,...t},a)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:a,className:(0,i.cn)("w-full caption-bottom text-sm",e),...t})}));n.displayName="Table";let l=r.forwardRef(({className:e,...t},a)=>s.jsx("thead",{ref:a,className:(0,i.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let o=r.forwardRef(({className:e,...t},a)=>s.jsx("tbody",{ref:a,className:(0,i.cn)("[&_tr:last-child]:border-0",e),...t}));o.displayName="TableBody",r.forwardRef(({className:e,...t},a)=>s.jsx("tfoot",{ref:a,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let c=r.forwardRef(({className:e,...t},a)=>s.jsx("tr",{ref:a,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));c.displayName="TableRow";let d=r.forwardRef(({className:e,...t},a)=>s.jsx("th",{ref:a,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));d.displayName="TableHead";let m=r.forwardRef(({className:e,...t},a)=>s.jsx("td",{ref:a,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));m.displayName="TableCell",r.forwardRef(({className:e,...t},a)=>s.jsx("caption",{ref:a,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},59298:(e,t,a)=>{"use strict";a.d(t,{pm:()=>s.pm});var s=a(95084)},96734:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(53189).createProxy)(String.raw`/Users/isak/dev/accounts/packages/frontend/src/app/bookkeeping/categorization/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[193,858,846,153,92],()=>a(53572));module.exports=s})();