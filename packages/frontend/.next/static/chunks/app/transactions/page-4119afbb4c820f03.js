(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{96218:function(e,s,a){Promise.resolve().then(a.bind(a,89590))},89590:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return sv}});var t=a(27573),n=a(7653),l=a(23087),r=a(77930),i=a(31988),c=a(15969),o=a(50466),d=a(72196),m=a(76095),x=a(58912),u=a(26492),h=a(50188),g=a(39134),j=a(36733),p=a(95731),y=a(10269),f=a(85481),v=a(38983),N=a(59135),w=a(79951),C=a(88646),b=a(8641),k=a(58410),_=a(2966),S=a(74810),z=a(45249);function D(e){var s;let{columns:a,data:l,onRowSelectionChange:r,onRowClick:i,searchKey:c="description",searchPlaceholder:d="Search transactions...",showColumnToggle:m=!0,showPagination:D=!0,pageSize:Z=25,isLoading:F=!1,emptyMessage:M="No transactions found.",className:E}=e,[T,A]=(0,n.useState)([]),[P,L]=(0,n.useState)([]),[U,I]=(0,n.useState)({}),[R,V]=(0,n.useState)({}),[Q,K]=(0,n.useState)(""),[q,O]=(0,n.useState)({pageIndex:0,pageSize:Z}),B=(0,x.b7)({data:l,columns:a,getCoreRowModel:(0,u.sC)(),getSortedRowModel:(0,u.tj)(),getFilteredRowModel:(0,u.vL)(),getPaginationRowModel:(0,u.G_)(),onSortingChange:A,onColumnFiltersChange:L,onColumnVisibilityChange:I,onRowSelectionChange:e=>{if(V(e),r){let s="function"==typeof e?e(R):e;r(Object.keys(s).filter(e=>s[e]).map(e=>l[parseInt(e)]))}},onPaginationChange:O,onGlobalFilterChange:K,globalFilterFn:"includesString",state:{sorting:T,columnFilters:P,columnVisibility:U,rowSelection:R,pagination:q,globalFilter:Q}}),W=B.getPageCount(),Y=B.getState().pagination.pageIndex+1,G=(0,n.useCallback)(()=>{let e;let s=[],a=[];for(let e=1;e<=W;e++)(1===e||e===W||e>=Y-2&&e<=Y+2)&&s.push(e);return s.forEach(s=>{e&&(s-e==2?a.push(e+1):s-e!=1&&a.push("...")),a.push(s),e=s}),a},[Y,W]),X=Object.keys(R).filter(e=>R[e]).length;return(0,t.jsxs)("div",{className:(0,z.cn)("space-y-4",E),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center space-x-2",children:[(0,t.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,t.jsx)(p.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(g.I,{placeholder:d,value:null!=Q?Q:"",onChange:e=>K(e.target.value),className:"pl-9 pr-9"}),Q&&(0,t.jsx)(o.z,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 h-7 w-7 -translate-y-1/2 p-0",onClick:()=>K(""),children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})})]}),X>0&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[X," row",1!==X?"s":""," selected"]})]}),m&&(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsxs)(o.z,{variant:"outline",size:"sm",className:"ml-auto",children:[(0,t.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Columns",(0,t.jsx)(v.Z,{className:"ml-2 h-4 w-4"})]})}),(0,t.jsxs)(j.AW,{align:"end",className:"w-48",children:[(0,t.jsx)(j.Ju,{children:"Toggle columns"}),(0,t.jsx)(j.VD,{}),B.getAllColumns().filter(e=>e.getCanHide()).map(e=>(0,t.jsx)(j.bO,{className:"capitalize",checked:e.getIsVisible(),onCheckedChange:s=>e.toggleVisibility(!!s),children:e.id.replace(/_/g," ")},e.id))]})]})]}),(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(h.iA,{children:[(0,t.jsx)(h.xD,{children:B.getHeaderGroups().map(e=>(0,t.jsx)(h.SC,{children:e.headers.map(e=>(0,t.jsx)(h.ss,{className:(0,z.cn)(e.column.getCanSort()&&"cursor-pointer select-none","whitespace-nowrap"),onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isPlaceholder?null:(0,x.ie)(e.column.columnDef.header,e.getContext()),e.column.getCanSort()&&(0,t.jsx)("div",{className:"ml-2",children:"asc"===e.column.getIsSorted()?(0,t.jsx)(N.Z,{className:"h-4 w-4"}):"desc"===e.column.getIsSorted()?(0,t.jsx)(w.Z,{className:"h-4 w-4"}):(0,t.jsx)(C.Z,{className:"h-4 w-4 text-muted-foreground/50"})})]})},e.id))},e.id))}),(0,t.jsx)(h.RM,{children:F?(0,t.jsx)(h.SC,{children:(0,t.jsx)(h.pj,{colSpan:a.length,className:"h-96 text-center",children:(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Loading transactions..."})]})})}):(null===(s=B.getRowModel().rows)||void 0===s?void 0:s.length)?B.getRowModel().rows.map(e=>(0,t.jsx)(h.SC,{"data-state":e.getIsSelected()&&"selected",className:(0,z.cn)(i&&"cursor-pointer hover:bg-muted/50",e.getIsSelected()&&"bg-muted/50"),onClick:s=>{let a=s.target;!(a.closest('[role="checkbox"]')||a.closest("button")||a.closest("[data-no-row-click]"))&&i&&i(e.original)},children:e.getVisibleCells().map(e=>(0,t.jsx)(h.pj,{className:"py-2",children:(0,x.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(h.SC,{children:(0,t.jsx)(h.pj,{colSpan:a.length,className:"h-96 text-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-2",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:M}),Q&&(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>K(""),children:"Clear search"})]})})})})]})}),D&&W>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing"," ",(0,t.jsx)("span",{className:"font-medium",children:B.getState().pagination.pageIndex*B.getState().pagination.pageSize+1})," to ",(0,t.jsx)("span",{className:"font-medium",children:Math.min((B.getState().pagination.pageIndex+1)*B.getState().pagination.pageSize,l.length)})," of ",(0,t.jsx)("span",{className:"font-medium",children:l.length})," results"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"|"}),(0,t.jsx)("label",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),(0,t.jsx)("select",{className:"h-8 w-16 rounded border border-input bg-background px-2 text-sm",value:B.getState().pagination.pageSize,onChange:e=>{B.setPageSize(Number(e.target.value))},children:[10,25,50,100].map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>B.setPageIndex(0),disabled:!B.getCanPreviousPage(),className:"h-8 w-8 p-0",children:(0,t.jsx)(b.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>B.previousPage(),disabled:!B.getCanPreviousPage(),className:"h-8 w-8 p-0",children:(0,t.jsx)(k.Z,{className:"h-4 w-4"})}),(0,t.jsx)("div",{className:"flex items-center space-x-1",children:G().map((e,s)=>"..."===e?(0,t.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},"dots-".concat(s)):(0,t.jsx)(o.z,{variant:Y===e?"default":"outline",size:"sm",onClick:()=>B.setPageIndex(e-1),className:"h-8 w-8 p-0",children:e},e))}),(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>B.nextPage(),disabled:!B.getCanNextPage(),className:"h-8 w-8 p-0",children:(0,t.jsx)(_.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>B.setPageIndex(B.getPageCount()-1),disabled:!B.getCanNextPage(),className:"h-8 w-8 p-0",children:(0,t.jsx)(S.Z,{className:"h-4 w-4"})})]})]})]})}var Z=a(93125),F=a(85745),M=a(61284);let E=M.fC,T=M.xz,A=n.forwardRef((e,s)=>{let{className:a,align:n="center",sideOffset:l=4,...r}=e;return(0,t.jsx)(M.h_,{children:(0,t.jsx)(M.VY,{ref:s,align:n,sideOffset:l,className:(0,z.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})})});A.displayName=M.VY.displayName;var P=a(24603);function L(e){let{className:s,classNames:a,showOutsideDays:n=!0,...l}=e;return(0,t.jsx)(P._,{showOutsideDays:n,className:(0,z.cn)("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,z.cn)((0,o.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,z.cn)((0,o.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...s}=e;return(0,t.jsx)(k.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...s}=e;return(0,t.jsx)(_.Z,{className:"h-4 w-4"})}},...l})}L.displayName="Calendar";var U=a(38941),I=a(23727),R=a(57124),V=a(18177),Q=a(75317),K=a(1278),q=a(5602),O=a(91286),B=a(25018),W=a(81629);let Y=[{label:"Today",getValue:()=>({from:new Date,to:new Date})},{label:"Yesterday",getValue:()=>({from:(0,Q.k)(new Date,1),to:(0,Q.k)(new Date,1)})},{label:"Last 7 days",getValue:()=>({from:(0,Q.k)(new Date,6),to:new Date})},{label:"Last 30 days",getValue:()=>({from:(0,Q.k)(new Date,29),to:new Date})},{label:"This month",getValue:()=>({from:(0,K.N)(new Date),to:(0,q.V)(new Date)})},{label:"Last month",getValue:()=>{let e=(0,O.W)(new Date,1);return{from:(0,K.N)(e),to:(0,q.V)(e)}}},{label:"Last 3 months",getValue:()=>({from:(0,O.W)(new Date,3),to:new Date})},{label:"Last 6 months",getValue:()=>({from:(0,O.W)(new Date,6),to:new Date})},{label:"This year",getValue:()=>({from:new Date(new Date().getFullYear(),0,1),to:new Date})}];function G(e){var s,a;let{filters:l,onFiltersChange:r,accounts:i,categories:c,onReset:d,className:m}=e,[x,u]=(0,n.useState)(!1),[h,j]=(0,n.useState)({}),[f,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(l.date_from||l.date_to)&&j({from:l.date_from?(0,B.D)(l.date_from):void 0,to:l.date_to?(0,B.D)(l.date_to):void 0})},[l.date_from,l.date_to]);let w=(e,s)=>{let a={...l};""===s||void 0===s||"all"===s?delete a[e]:a[e]=s,r(a)},C=e=>{j(e),r({...l,date_from:e.from?(0,W.WU)(e.from,"yyyy-MM-dd"):void 0,date_to:e.to?(0,W.WU)(e.to,"yyyy-MM-dd"):void 0})},b=e=>{C(e.getValue()),N(!1)},k=Object.keys(l).filter(e=>void 0!==l[e]&&"limit"!==e&&"offset"!==e).length;return(0,t.jsxs)("div",{className:(0,z.cn)("space-y-4",m),children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)(E,{open:f,onOpenChange:N,children:[(0,t.jsx)(T,{asChild:!0,children:(0,t.jsxs)(o.z,{variant:"outline",className:(0,z.cn)("w-[240px] justify-start text-left font-normal",!h.from&&"text-muted-foreground"),children:[(0,t.jsx)(I.Z,{className:"mr-2 h-4 w-4"}),h.from?h.to?(0,t.jsxs)(t.Fragment,{children:[(0,W.WU)(h.from,"MMM d, yyyy")," - ",(0,W.WU)(h.to,"MMM d, yyyy")]}):(0,W.WU)(h.from,"MMM d, yyyy"):"Select date range"]})}),(0,t.jsx)(A,{className:"w-auto p-0",align:"start",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("div",{className:"border-r p-3 space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Quick Select"}),Y.map(e=>(0,t.jsx)(o.z,{variant:"ghost",size:"sm",className:"w-full justify-start text-left",onClick:()=>b(e),children:e.label},e.label))]}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)(L,{mode:"range",selected:h,onSelect:C,initialFocus:!0,numberOfMonths:2})})]})})]}),(0,t.jsxs)(F.Ph,{value:l.account_id||"all",onValueChange:e=>w("account_id","all"===e?void 0:e),children:[(0,t.jsx)(F.i4,{className:"w-[200px]",children:(0,t.jsx)(F.ki,{placeholder:"All accounts"})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"all",children:"All accounts"}),i.map(e=>(0,t.jsx)(F.Ql,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:e.name}),e.mask&&(0,t.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["•••• ",e.mask]})]})},e.id))]})]}),(0,t.jsxs)(F.Ph,{value:l.category_id||"all",onValueChange:e=>w("category_id","all"===e?void 0:e),children:[(0,t.jsx)(F.i4,{className:"w-[200px]",children:(0,t.jsx)(F.ki,{placeholder:"All categories"})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"all",children:"All categories"}),c.map(e=>(0,t.jsx)(F.Ql,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center",children:[e.icon&&(0,t.jsx)("span",{className:"mr-2",children:e.icon}),(0,t.jsx)("span",{children:e.name})]})},e.id))]})]}),(0,t.jsxs)(F.Ph,{value:l.transaction_type||"all",onValueChange:e=>w("transaction_type",e),children:[(0,t.jsx)(F.i4,{className:"w-[150px]",children:(0,t.jsx)(F.ki,{placeholder:"All types"})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"all",children:"All types"}),(0,t.jsx)(F.Ql,{value:"income",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),"Income"]})}),(0,t.jsx)(F.Ql,{value:"expense",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2"}),"Expense"]})})]})]}),(0,t.jsxs)("div",{className:"relative flex-1 min-w-[200px] max-w-[400px]",children:[(0,t.jsx)(p.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(g.I,{placeholder:"Search by description or merchant...",value:l.search||"",onChange:e=>w("search",e.target.value),className:"pl-9"})]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>u(!x),children:[(0,t.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),"Advanced",(0,t.jsx)(v.Z,{className:(0,z.cn)("ml-2 h-4 w-4 transition-transform",x&&"rotate-180")})]}),k>0&&(0,t.jsxs)(o.z,{variant:"ghost",size:"sm",onClick:()=>{j({}),d?d():r({})},children:[(0,t.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Clear (",k,")"]})]}),x&&(0,t.jsxs)("div",{className:"border rounded-lg p-4 space-y-4 bg-muted/30",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(Z._,{children:"Amount Range"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(V.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(g.I,{type:"number",placeholder:"Min",value:l.amount_min||"",onChange:e=>w("amount_min",e.target.value?parseFloat(e.target.value):void 0),className:"pl-9"})]}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"to"}),(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(V.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(g.I,{type:"number",placeholder:"Max",value:l.amount_max||"",onChange:e=>w("amount_max",e.target.value?parseFloat(e.target.value):void 0),className:"pl-9"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(Z._,{children:"Merchant Name"}),(0,t.jsx)(g.I,{placeholder:"Enter merchant name...",value:l.merchant_name||"",onChange:e=>w("merchant_name",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(Z._,{children:"Transaction Status"}),(0,t.jsxs)(F.Ph,{value:void 0===l.is_pending?"all":l.is_pending.toString(),onValueChange:e=>w("is_pending","all"===e?void 0:"true"===e),children:[(0,t.jsx)(F.i4,{children:(0,t.jsx)(F.ki,{placeholder:"All statuses"})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"all",children:"All statuses"}),(0,t.jsx)(F.Ql,{value:"false",children:"Posted"}),(0,t.jsx)(F.Ql,{value:"true",children:"Pending"})]})]})]})]}),k>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2 border-t",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Active filters:"}),l.date_from&&l.date_to&&(0,t.jsxs)(U.C,{variant:"secondary",children:[(0,W.WU)((0,B.D)(l.date_from),"MMM d")," - ",(0,W.WU)((0,B.D)(l.date_to),"MMM d")]}),l.account_id&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Account: ",null===(s=i.find(e=>e.id===l.account_id))||void 0===s?void 0:s.name]}),l.category_id&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Category: ",null===(a=c.find(e=>e.id===l.category_id))||void 0===a?void 0:a.name]}),l.transaction_type&&"all"!==l.transaction_type&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Type: ",l.transaction_type]}),void 0!==l.amount_min&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Min: $",l.amount_min]}),void 0!==l.amount_max&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Max: $",l.amount_max]}),l.merchant_name&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Merchant: ",l.merchant_name]}),void 0!==l.is_pending&&(0,t.jsxs)(U.C,{variant:"secondary",children:["Status: ",l.is_pending?"Pending":"Posted"]})]})]})]})}var X=a(50520),J=a(75661),$=a(27778),H=a(16843),ee=a(25555),es=a(73166),ea=a(97066),et=a(36673),en=a(69790),el=a(34915),er=a(51856),ei=a(59051),ec=a(25796),eo=a(88795),ed=a(30609),em=a(92482),ex=a(31815),eu=a(87354),eh=a(3172);let eg=n.forwardRef((e,s)=>{let{isOpen:a,onClose:l,title:r,description:i,children:c,size:o="md",className:d,hideCloseButton:m}=e;return(n.useEffect(()=>{let e=e=>{"Escape"===e.key&&l()};return a&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[a,l]),a)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),(0,t.jsxs)("div",{ref:s,className:(0,z.cn)("relative w-full rounded-lg bg-white shadow-xl",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-full mx-4"}[o],d),children:[(r||!m)&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 pb-4",children:[(0,t.jsxs)("div",{children:[r&&(0,t.jsx)("h2",{className:"text-lg font-semibold text-neutral-900",children:r}),i&&(0,t.jsx)("p",{className:"mt-1 text-sm text-neutral-600",children:i})]}),!m&&(0,t.jsx)("button",{onClick:l,className:"rounded-md p-2 hover:bg-neutral-100",children:(0,t.jsx)(y.Z,{className:"h-5 w-5"})})]}),(0,t.jsx)("div",{className:(0,z.cn)("px-6",r||!m?"pb-6":"py-6"),children:c})]})]}):null});eg.displayName="Modal";var ej=a(33154),ep=a(81381),ey=a(21746);let ef={salary:(0,t.jsx)(V.Z,{className:"h-4 w-4"}),freelance:(0,t.jsx)(V.Z,{className:"h-4 w-4"}),investment:(0,t.jsx)(V.Z,{className:"h-4 w-4"}),business:(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),other_income:(0,t.jsx)(V.Z,{className:"h-4 w-4"}),groceries:(0,t.jsx)(eo.Z,{className:"h-4 w-4"}),restaurants:(0,t.jsx)(eo.Z,{className:"h-4 w-4"}),gas:(0,t.jsx)(eo.Z,{className:"h-4 w-4"}),utilities:(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),rent:(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),mortgage:(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),default:(0,t.jsx)(es.Z,{className:"h-4 w-4"})};function ev(e){let{isOpen:s,onClose:a,transactions:l,onTransactionsUpdated:r,className:i}=e,[c,d]=n.useState([]),[m,x]=n.useState([]),[u,h]=n.useState(""),[j,f]=n.useState(""),[v,N]=n.useState({}),[w,C]=n.useState(!1),[b,k]=n.useState(!1),[_,S]=n.useState(!1),[D,Z]=n.useState(""),[F,M]=n.useState("expense"),[E,T]=n.useState(""),[A,P]=n.useState(""),[L,R]=n.useState(0),V=n.useRef(null),Q=n.useRef([]);n.useEffect(()=>{s&&(K(),q(),h(""),f(""),T(""),P(""),R(0),setTimeout(()=>{var e;null===(e=V.current)||void 0===e||e.focus()},100))},[s,l]),n.useEffect(()=>{let e=c.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.type.toLowerCase().includes(u.toLowerCase())),s=l[L];if(s&&v[s.id]){let a=new Set(v[s.id].map(e=>e.category_id));e.sort((e,s)=>{let t=a.has(e.id),n=a.has(s.id);return t&&!n?-1:!t&&n?1:e.name.localeCompare(s.name)})}else e.sort((e,s)=>e.name.localeCompare(s.name));x(e)},[c,u,v,L,l]),n.useEffect(()=>{let e=e=>{var t,n,r,i;if(s)switch(e.key){case"Escape":_?S(!1):a();break;case"ArrowDown":if(e.preventDefault(),V.current===document.activeElement)null===(t=Q.current[0])||void 0===t||t.focus();else{let e=Math.min(Q.current.findIndex(e=>e===document.activeElement)+1,m.length-1);null===(n=Q.current[e])||void 0===n||n.focus()}break;case"ArrowUp":e.preventDefault();let c=Q.current.findIndex(e=>e===document.activeElement);c<=0?null===(r=V.current)||void 0===r||r.focus():null===(i=Q.current[c-1])||void 0===i||i.focus();break;case"Enter":e.preventDefault();let o=Q.current.findIndex(e=>e===document.activeElement);o>=0&&G(m[o].id);break;case"ArrowLeft":L>0&&(R(e=>e-1),f(""));break;case"ArrowRight":L<l.length-1&&(R(e=>e+1),f(""))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,m,L,l.length,_,a]);let K=async()=>{try{C(!0);let e=(await ep.Y.getCategories()).map(e=>({...e,icon_element:O(e)}));d(e)}catch(e){console.error("Failed to load categories:",e),P("Failed to load categories")}finally{C(!1)}},q=async()=>{if(0!==l.length)try{let e=l.map(e=>e.id),s=await ep.Y.bulkCategorize(e);N(s.predictions)}catch(e){console.error("Failed to load ML predictions:",e)}},O=e=>ef[e.icon||e.name.toLowerCase().replace(/\s+/g,"_")]||ef.default,B=e=>{switch(e.type){case"income":return"success";case"expense":return"destructive";case"transfer":return"secondary";default:return"outline"}},Y=(e,s)=>{let a=v[s];if(!a)return 0;let t=a.find(s=>s.category_id===e);return(null==t?void 0:t.confidence)||0},G=e=>{f(e)},X=async()=>{if(D.trim())try{C(!0);let e=await ep.Y.createCategory({name:D.trim(),type:F,is_system:!1}),s={...e,icon_element:O(e)};d(e=>[...e,s]),f(e.id),S(!1),Z(""),T('Created category "'.concat(e.name,'"'))}catch(e){console.error("Failed to create category:",e),P("Failed to create category")}finally{C(!1)}},J=async()=>{if(j)try{if(k(!0),P(""),T(""),1===l.length){let e=await ey.d.updateTransaction(l[0].id,{category_id:j});r([e]),T("Transaction categorized successfully")}else{let e=0,s=[],a=[];for(let e=0;e<l.length;e+=10)a.push(l.slice(e,e+10));let t=[];for(let n of a)try{let s=await ey.d.bulkUpdateTransactions({transaction_ids:n.map(e=>e.id),updates:{category_id:j}});t.push(...s),e+=n.length}catch(e){s.push("Failed to update ".concat(n.length," transactions: ").concat(e.message))}r(t),0===s.length?T("".concat(e," transactions categorized successfully")):(T("".concat(e," transactions categorized successfully")),s.length>0&&P("".concat(s.length," batches failed. Some transactions may not have been updated.")))}1===l.length&&setTimeout(()=>{a()},1500)}catch(e){console.error("Failed to categorize transactions:",e),P(e.message||"Failed to categorize transactions")}finally{k(!1)}},$=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Math.abs(e)),H=l[L],ee=H&&v[H.id]||[],es=c.find(e=>e.id===j);return s?(0,t.jsx)(eg,{isOpen:s,onClose:a,title:1===l.length?"Categorize Transaction":"Categorize ".concat(l.length," Transactions"),description:1===l.length?"Select a category for this transaction":"Select a category to apply to all selected transactions",size:"xl",className:i,children:(0,t.jsxs)("div",{className:"space-y-6",children:[A&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-error-50 border border-error-200 rounded-lg text-error-700",children:[(0,t.jsx)(ed.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:A}),(0,t.jsx)("button",{onClick:()=>P(""),className:"ml-auto p-1 hover:bg-error-100 rounded",children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})})]}),E&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-success-50 border border-success-200 rounded-lg text-success-700",children:[(0,t.jsx)(ea.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:E}),(0,t.jsx)("button",{onClick:()=>T(""),className:"ml-auto p-1 hover:bg-success-100 rounded",children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"space-y-4",children:1===l.length?(0,t.jsx)("div",{className:"bg-neutral-50 border border-neutral-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-neutral-900",children:H.description}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-sm text-neutral-600",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(I.Z,{className:"h-4 w-4"}),(0,W.WU)(new Date(H.date),"MMM d, yyyy")]}),H.merchant_name&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),H.merchant_name]})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:(0,z.cn)("text-lg font-bold",H.amount<0?"text-error-600":"text-success-600"),children:[H.amount<0?"-":"+",$(H.amount)]})})]})}):(0,t.jsxs)("div",{className:"bg-neutral-50 border border-neutral-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("h3",{className:"font-semibold text-neutral-900",children:[l.length," Selected Transactions"]}),(0,t.jsxs)("div",{className:"text-sm text-neutral-600",children:["Total: ",$(l.reduce((e,s)=>e+s.amount,0))]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>R(e=>Math.max(0,e-1)),disabled:0===L,children:"Previous"}),(0,t.jsxs)("span",{className:"flex items-center px-3 py-1 bg-white border rounded text-sm",children:[L+1," of ",l.length]}),(0,t.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>R(e=>Math.min(l.length-1,e+1)),disabled:L===l.length-1,children:"Next"})]})]}),(0,t.jsxs)("div",{className:"flex items-start justify-between bg-white border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900",children:H.description}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-sm text-neutral-600",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(I.Z,{className:"h-4 w-4"}),(0,W.WU)(new Date(H.date),"MMM d, yyyy")]}),H.merchant_name&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),H.merchant_name]})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:(0,z.cn)("font-bold",H.amount<0?"text-error-600":"text-success-600"),children:[H.amount<0?"-":"+",$(H.amount)]})})]}),l.length>1&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-info-50 border border-info-200 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-info-700",children:[(0,t.jsx)(em.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Bulk Operation:"}),"The selected category will be applied to all ",l.length," transactions."]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-info-600",children:[l.filter(e=>!e.category_id).length," uncategorized transactions will be updated."]})]})]})}),ee.length>0&&(0,t.jsxs)("div",{className:"bg-info-50 border border-info-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(ex.Z,{className:"h-5 w-5 text-info-600"}),(0,t.jsx)("h4",{className:"font-medium text-info-900",children:"AI Suggestions"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:ee.slice(0,4).map((e,s)=>{let a=c.find(s=>s.id===e.category_id);return a?(0,t.jsxs)("button",{onClick:()=>G(e.category_id),className:(0,z.cn)("flex items-center gap-2 p-3 rounded-lg border text-left transition-colors hover:bg-info-100",j===e.category_id?"border-info-500 bg-info-100":"border-info-200 bg-white"),children:[a.icon_element,(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:a.name}),(0,t.jsxs)(U.C,{variant:"info",className:"text-xs",children:[Math.round(100*e.confidence),"% confidence"]})]}),j===e.category_id&&(0,t.jsx)(eu.Z,{className:"h-4 w-4 text-info-600"})]},e.category_id):null})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(p.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-500"}),(0,t.jsx)(g.I,{ref:V,placeholder:"Search categories...",value:u,onChange:e=>h(e.target.value),className:"pl-10"})]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>S(!0),children:[(0,t.jsx)(eh.Z,{className:"h-4 w-4 mr-1"}),"New"]})]}),_&&(0,t.jsxs)("div",{className:"bg-neutral-50 border border-neutral-200 rounded-lg p-4 space-y-3",children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900",children:"Create New Category"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(g.I,{placeholder:"Category name",value:D,onChange:e=>Z(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),X())},className:"flex-1"}),(0,t.jsxs)("select",{value:F,onChange:e=>M(e.target.value),className:"px-3 py-2 border border-neutral-300 rounded-md text-sm",children:[(0,t.jsx)("option",{value:"expense",children:"Expense"}),(0,t.jsx)("option",{value:"income",children:"Income"}),(0,t.jsx)("option",{value:"transfer",children:"Transfer"})]}),(0,t.jsx)(o.z,{onClick:X,disabled:!D.trim()||w,loading:w,children:"Create"}),(0,t.jsx)(o.z,{variant:"outline",onClick:()=>{S(!1),Z("")},children:"Cancel"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"font-medium text-neutral-900",children:["Categories (",m.length,")"]}),(0,t.jsx)(ej.x,{className:"max-h-80",children:(0,t.jsx)("div",{className:"space-y-1 pr-4",children:w?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"h-6 w-6 animate-spin rounded-full border-b-2 border-primary-600"})}):0===m.length?(0,t.jsx)("div",{className:"text-center py-8 text-neutral-500",children:u?"No categories found":"No categories available"}):m.map((e,s)=>{let a=Y(e.id,(null==H?void 0:H.id)||""),n=j===e.id;return(0,t.jsxs)("button",{ref:e=>{Q.current[s]=e},onClick:()=>G(e.id),className:(0,z.cn)("w-full flex items-center gap-3 p-3 rounded-lg border text-left transition-colors hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-primary-500",n?"border-primary-500 bg-primary-50":"border-neutral-200",a>.7&&"ring-2 ring-info-200"),children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:e.icon_element}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-neutral-900 truncate",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(U.C,{variant:B(e),className:"text-xs",children:e.type}),a>0&&(0,t.jsxs)(U.C,{variant:"info",className:"text-xs",children:[Math.round(100*a),"% match"]})]})]}),n&&(0,t.jsx)(eu.Z,{className:"h-5 w-5 text-primary-600 flex-shrink-0"})]},e.id)})})})]}),es&&(0,t.jsx)("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[es.icon_element,(0,t.jsxs)("span",{className:"font-medium text-primary-900",children:["Selected: ",es.name]})]}),(0,t.jsx)(U.C,{variant:B(es),children:es.type})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between border-t pt-4",children:[(0,t.jsx)("div",{className:"text-sm text-neutral-600",children:1===l.length?"Use arrow keys to navigate, Enter to select":"Will apply to ".concat(l.length," transactions • Use ← → to preview")}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.z,{variant:"outline",onClick:a,children:"Cancel"}),(0,t.jsx)(o.z,{onClick:J,disabled:!j||b,loading:b,className:l.length>1?"bg-primary-600 hover:bg-primary-700":"",children:b?1===l.length?"Applying...":"Applying to ".concat(l.length," transactions..."):1===l.length?"Apply Category":"Apply to ".concat(l.length," transactions")})]})]})]})}):null}var eN=a(17022),ew=a(83025),eC=a(49934),eb=a(51733),ek=a(36120),e_=a(96825),eS=a(38333),ez=a(97861),eD=a(12439),eZ=a(58248),eF=a(32026),eM=a(98325),eE=a(63502),eT=a(14699),eA=a(35995),eP=a(20144),eL=a(39912);let eU=["\uD83C\uDFE0","\uD83D\uDE97","\uD83C\uDF54","\uD83D\uDC8A","\uD83D\uDCDA","\uD83C\uDFAC","✈️","\uD83D\uDC55","⚡","\uD83D\uDCF1","\uD83C\uDFB5","\uD83C\uDFCB️","\uD83C\uDFA8","\uD83D\uDC15","\uD83C\uDF31","\uD83D\uDD27","\uD83C\uDF81","☕","\uD83C\uDFE6","\uD83D\uDCBC"],eI=["#EF4444","#F97316","#EAB308","#22C55E","#06B6D4","#3B82F6","#8B5CF6","#EC4899","#F43F5E","#84CC16","#10B981","#14B8A6","#6366F1","#8B5CF6","#A855F7"];function eR(e){let{isOpen:s,onClose:a,className:l}=e,d=(0,r.NL)(),m=(0,eL.PM)(),x=(0,eL.cM)(),[u,h]=n.useState(""),[j,y]=n.useState(!1),[f,v]=n.useState(null),[N,w]=n.useState("hierarchy"),[C,b]=n.useState("all"),[k,_]=n.useState([]),[S,z]=n.useState(new Set),[D,Z]=n.useState(!1),[M,E]=n.useState(null),[T,A]=n.useState(!1),[P,L]=n.useState(!1),[I,R]=n.useState(null),[V,Q]=n.useState(!1),[K,q]=n.useState(null),{data:O=[],isLoading:B}=(0,i.a)({queryKey:["categories"],queryFn:ep.Y.getCategories}),{data:W=[],isLoading:Y}=(0,i.a)({queryKey:["category-stats"],queryFn:()=>ep.Y.getCategoryStats(),enabled:"stats"===N}),{data:G=[],isLoading:X}=(0,i.a)({queryKey:["category-spending"],queryFn:()=>ep.Y.getCategorySpending(),enabled:"stats"===N}),J=(0,c.D)({mutationFn:ep.Y.createCategory,onSuccess:()=>{d.invalidateQueries({queryKey:["categories"]}),d.invalidateQueries({queryKey:["category-stats"]}),m("Category Created","Category created successfully"),y(!1)},onError:e=>{x("Create Failed",e.message||"Failed to create category")}}),$=(0,c.D)({mutationFn:e=>{let{id:s,updates:a}=e;return ep.Y.updateCategory(s,a)},onSuccess:()=>{d.invalidateQueries({queryKey:["categories"]}),d.invalidateQueries({queryKey:["category-stats"]}),m("Category Updated","Category updated successfully"),v(null)},onError:e=>{x("Update Failed",e.message||"Failed to update category")}}),H=(0,c.D)({mutationFn:ep.Y.deleteCategory,onSuccess:()=>{d.invalidateQueries({queryKey:["categories"]}),d.invalidateQueries({queryKey:["category-stats"]}),m("Category Deleted","Category deleted successfully")},onError:e=>{x("Delete Failed",e.message||"Failed to delete category")}}),ee=(0,c.D)({mutationFn:ep.Y.bulkUpdateCategories,onSuccess:()=>{d.invalidateQueries({queryKey:["categories"]}),m("Categories Updated","Category hierarchy updated successfully")},onError:e=>{x("Update Failed",e.message||"Failed to update categories")}}),ea=(0,c.D)({mutationFn:e=>{let{sourceId:s,targetId:a}=e;return ep.Y.mergeCategories(s,a)},onSuccess:()=>{d.invalidateQueries({queryKey:["categories"]}),d.invalidateQueries({queryKey:["category-stats"]}),m("Categories Merged","Categories merged successfully"),L(!1),R(null)},onError:e=>{x("Merge Failed",e.message||"Failed to merge categories")}});(0,eT.Dy)((0,eT.VT)(eT.we),(0,eT.VT)(eT.Lg,{coordinateGetter:eA.is}));let et=e=>{let s=new Map,a=[];return e.forEach(e=>{s.set(e.id,{...e,children:[],level:0,isExpanded:S.has(e.id)})}),e.forEach(e=>{let t=s.get(e.id);if(e.parent_id&&s.has(e.parent_id)){let a=s.get(e.parent_id);a.children.push(t),t.level=(a.level||0)+1}else a.push(t)}),a},en=e=>{let s=[],a=e=>{s.push(e),e.isExpanded&&e.children&&e.children.forEach(a)};return e.forEach(a),s},el=n.useMemo(()=>{let e=O.filter(e=>{let s=e.name.toLowerCase().includes(u.toLowerCase()),a="all"===C||"system"===C&&e.is_system||"custom"===C&&!e.is_system;return s&&a});return"hierarchy"===N?en(et(e)):e.map(e=>({...e,level:0}))},[O,u,C,N,S]),er=async()=>{if(0!==k.length){if(k.filter(e=>{var s;return null===(s=O.find(s=>s.id===e))||void 0===s?void 0:s.is_system}).length>0){x("Cannot Delete","System categories cannot be deleted");return}if(confirm("Delete ".concat(k.length," categories? This cannot be undone.")))try{await Promise.all(k.map(e=>ep.Y.deleteCategory(e))),d.invalidateQueries({queryKey:["categories"]}),m("Categories Deleted","".concat(k.length," categories deleted")),_([])}catch(e){x("Delete Failed",e.message||"Failed to delete categories")}}},ec=async e=>{try{let s=await ep.Y.exportCategories(e),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download="categories.".concat(e),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),m("Export Complete","Categories exported as ".concat(e.toUpperCase()))}catch(e){x("Export Failed",e.message||"Failed to export categories")}},eo=async e=>{if(e.is_system){x("Cannot Delete","System categories cannot be deleted");return}window.confirm('Are you sure you want to delete "'.concat(e.name,'"? This action cannot be undone.'))&&H.mutate(e.id)},ed=async e=>{let s={...e,name:"".concat(e.name," (Copy)"),is_system:!1,parent_id:e.parent_id};delete s.id,delete s.created_at,delete s.updated_at,J.mutate(s)},em=e=>{R(e),L(!0)},ex=e=>{q(e),Q(!0)};return s?(0,t.jsxs)(eg,{isOpen:s,onClose:a,title:"Category Management",description:"Create and manage categories for your transactions",size:"xl",className:l,children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(F.Ph,{value:N,onValueChange:e=>w(e),children:[(0,t.jsx)(F.i4,{className:"w-[140px]",children:(0,t.jsx)(F.ki,{})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"hierarchy",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eN.Z,{className:"h-4 w-4"}),"Hierarchy"]})}),(0,t.jsx)(F.Ql,{value:"grid",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(es.Z,{className:"h-4 w-4"}),"Grid"]})}),(0,t.jsx)(F.Ql,{value:"stats",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),"Statistics"]})}),(0,t.jsx)(F.Ql,{value:"rules",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eC.Z,{className:"h-4 w-4"}),"Rules"]})})]})]}),(0,t.jsxs)(F.Ph,{value:C,onValueChange:e=>b(e),children:[(0,t.jsx)(F.i4,{className:"w-[120px]",children:(0,t.jsx)(F.ki,{})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"all",children:"All"}),(0,t.jsx)(F.Ql,{value:"system",children:"System"}),(0,t.jsx)(F.Ql,{value:"custom",children:"Custom"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>ec("csv"),children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4 mr-1"}),"Export"]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>A(!0),children:[(0,t.jsx)(ek.Z,{className:"h-4 w-4 mr-1"}),"Import"]}),(0,t.jsxs)(o.z,{onClick:()=>y(!0),size:"sm",children:[(0,t.jsx)(eh.Z,{className:"h-4 w-4 mr-1"}),"New Category"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"relative max-w-sm",children:[(0,t.jsx)(p.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-500"}),(0,t.jsx)(g.I,{placeholder:"Search categories...",value:u,onChange:e=>h(e.target.value),className:"pl-10"})]}),k.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(U.C,{variant:"outline",children:[k.length," selected"]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:er,disabled:H.isPending,children:[(0,t.jsx)(ei.Z,{className:"h-4 w-4 mr-1"}),"Delete Selected"]}),(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>_([]),children:"Clear"})]})]}),(0,t.jsx)("div",{className:"h-[600px] overflow-hidden",children:(0,t.jsxs)(ej.x,{className:"h-full",children:["hierarchy"===N&&(0,t.jsx)(eO,{categories:el,selectedCategories:k,onSelectionChange:_,onEdit:v,onDelete:eo,onCopy:ed,onMerge:em,onPreview:ex,onToggleExpand:e=>{let s=new Set(S);s.has(e)?s.delete(e):s.add(e),z(s)},onDragEnd:e=>{let{active:s,over:a}=e;if(!a||s.id===a.id)return;let t=el.findIndex(e=>e.id===s.id),n=el.findIndex(e=>e.id===a.id);if(-1===t||-1===n)return;let l=(0,eA.Rp)(el,t,n).map((e,s)=>({id:e.id,sort_order:s}));ee.mutate(l)},isLoading:B}),"grid"===N&&(0,t.jsx)(eB,{categories:el,selectedCategories:k,onSelectionChange:_,onEdit:v,onDelete:eo,onCopy:ed,onMerge:em,onPreview:ex,isLoading:B}),"stats"===N&&(0,t.jsx)(eW,{categoryStats:W,categorySpending:G,searchTerm:u,isLoading:Y||X}),"rules"===N&&(0,t.jsx)(eY,{categories:el,onManageRules:e=>{E(e),Z(!0)},isLoading:B})]})}),0===el.length&&!B&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(es.Z,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:"No categories found"}),(0,t.jsx)("p",{className:"text-neutral-600 mb-4",children:u?"Try adjusting your search term.":"Create your first category to get started."}),!u&&(0,t.jsxs)(o.z,{onClick:()=>y(!0),children:[(0,t.jsx)(eh.Z,{className:"h-4 w-4 mr-1"}),"Create Category"]})]})]}),(0,t.jsx)(eQ,{isOpen:j||!!f,onClose:()=>{y(!1),v(null)},category:f,categories:O,onSubmit:e=>{f?$.mutate({id:f.id,updates:e}):J.mutate({...e,is_system:!1})},isLoading:J.isPending||$.isPending}),(0,t.jsx)(eG,{isOpen:D,onClose:()=>{Z(!1),E(null)},category:M}),(0,t.jsx)(eX,{isOpen:T,onClose:()=>A(!1),onImport:async(e,s)=>{try{let a=await ep.Y.importCategories(e,s);d.invalidateQueries({queryKey:["categories"]}),m("Import Complete","Imported ".concat(a.imported_count," categories")),A(!1)}catch(e){x("Import Failed",e.message||"Failed to import categories")}}}),(0,t.jsx)(eJ,{isOpen:P,onClose:()=>{L(!1),R(null)},sourceCategory:I,categories:O.filter(e=>e.id!==(null==I?void 0:I.id)),onMerge:e=>{I&&ea.mutate({sourceId:I.id,targetId:e})},isLoading:ea.isPending}),(0,t.jsx)(e$,{isOpen:V,onClose:()=>{Q(!1),q(null)},category:K})]}):null}function eV(e){let{category:s,isSelected:a,onSelect:n,onEdit:l,onDelete:r,onCopy:i,onMerge:c,onPreview:d,onToggleExpand:m}=e,{attributes:x,listeners:u,setNodeRef:h,transform:g,transition:j}=(0,eA.nB)({id:s.id}),p={transform:eP.ux.Transform.toString(g),transition:j},y=s.children&&s.children.length>0,f=24*(s.level||0);return(0,t.jsxs)("div",{ref:h,style:p,className:(0,z.cn)("flex items-center gap-3 p-3 rounded-lg border transition-all",a?"border-primary-500 bg-primary-50":"border-neutral-200 hover:border-neutral-300"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",style:{paddingLeft:f},children:[(0,t.jsx)(X.X,{checked:a,onChange:e=>n(s.id,e.target.checked)}),(0,t.jsx)("div",{...x,...u,className:"cursor-grab hover:cursor-grabbing",children:(0,t.jsx)(e_.Z,{className:"h-4 w-4 text-neutral-400"})}),y&&m&&(0,t.jsx)("button",{onClick:()=>m(s.id),className:"p-1 hover:bg-neutral-100 rounded",children:s.isExpanded?(0,t.jsx)(v.Z,{className:"h-4 w-4"}):(0,t.jsx)(_.Z,{className:"h-4 w-4"})}),(0,t.jsx)("div",{className:"w-6 h-6 rounded flex items-center justify-center text-sm",style:{backgroundColor:s.color||"#6B7280"},children:s.icon||eK(s.type)})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-medium text-neutral-900 truncate",children:s.name}),(0,t.jsx)(U.C,{variant:eq(s.type),className:"text-xs",children:s.type}),s.is_system&&(0,t.jsx)(U.C,{variant:"outline",className:"text-xs",children:"System"})]}),s.keywords&&s.keywords.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.keywords.slice(0,3).map(e=>(0,t.jsx)(U.C,{variant:"outline",className:"text-xs",children:e},e)),s.keywords.length>3&&(0,t.jsxs)(U.C,{variant:"outline",className:"text-xs",children:["+",s.keywords.length-3," more"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(J.u,{content:"Preview transactions",children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>d(s),className:"h-8 w-8 p-0",children:(0,t.jsx)(eS.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(J.u,{content:"Copy category",children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>i(s),className:"h-8 w-8 p-0",children:(0,t.jsx)(er.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(J.u,{content:"Edit category",children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>l(s),className:"h-8 w-8 p-0",children:(0,t.jsx)(el.Z,{className:"h-4 w-4"})})}),!s.is_system&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(J.u,{content:"Merge category",children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>c(s),className:"h-8 w-8 p-0",children:(0,t.jsx)(ez.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(J.u,{content:"Delete category",children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>r(s),className:"h-8 w-8 p-0 text-error-600 hover:text-error-700 hover:bg-error-50",children:(0,t.jsx)(ei.Z,{className:"h-4 w-4"})})})]})]})]})}function eQ(e){let{isOpen:s,onClose:a,category:l,categories:r,onSubmit:i,isLoading:c}=e,[d,m]=n.useState({name:"",type:"expense",icon:"",color:"#6B7280",keywords:[],confidence_threshold:.8}),[x,u]=n.useState(""),[h,j]=n.useState(!1),[p,f]=n.useState(!1);n.useEffect(()=>{l?m({name:l.name,type:l.type,icon:l.icon||"",color:l.color||"#6B7280",parent_id:l.parent_id,keywords:l.keywords||[],confidence_threshold:l.confidence_threshold||.8}):m({name:"",type:"expense",icon:"",color:"#6B7280",keywords:[],confidence_threshold:.8})},[l,s]);let v=()=>{x.trim()&&!d.keywords.includes(x.trim())&&(m(e=>({...e,keywords:[...e.keywords,x.trim()]})),u(""))},N=e=>{m(s=>({...s,keywords:s.keywords.filter(s=>s!==e)}))},w=r.filter(e=>e.id!==(null==l?void 0:l.id)&&!e.parent_id&&e.type===d.type);return(0,t.jsx)(eg,{isOpen:s,onClose:a,title:l?"Edit Category":"Create New Category",description:"Categories help organize your transactions for better financial insights",size:"lg",children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.name.trim()&&i(d)},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{htmlFor:"name",children:"Category Name *"}),(0,t.jsx)(g.I,{id:"name",value:d.name,onChange:e=>m(s=>({...s,name:e.target.value})),placeholder:"Enter category name",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{htmlFor:"type",children:"Type *"}),(0,t.jsxs)(F.Ph,{value:d.type,onValueChange:e=>m(s=>({...s,type:e})),children:[(0,t.jsx)(F.i4,{children:(0,t.jsx)(F.ki,{})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"income",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eD.Z,{className:"h-4 w-4 text-success-600"}),"Income"]})}),(0,t.jsx)(F.Ql,{value:"expense",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eZ.Z,{className:"h-4 w-4 text-error-600"}),"Expense"]})}),(0,t.jsx)(F.Ql,{value:"transfer",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eF.Z,{className:"h-4 w-4 text-info-600"}),"Transfer"]})})]})]})]})]}),w.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{htmlFor:"parent",children:"Parent Category"}),(0,t.jsxs)(F.Ph,{value:d.parent_id||"none",onValueChange:e=>m(s=>({...s,parent_id:"none"===e?void 0:e})),children:[(0,t.jsx)(F.i4,{children:(0,t.jsx)(F.ki,{placeholder:"Select parent category"})}),(0,t.jsxs)(F.Bw,{children:[(0,t.jsx)(F.Ql,{value:"none",children:"No parent (root category)"}),w.map(e=>(0,t.jsx)(F.Ql,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm",style:{color:e.color},children:e.icon||eK(e.type)}),e.name]})},e.id))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{children:"Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.z,{type:"button",variant:"outline",onClick:()=>j(!h),className:"w-12 h-12 p-0",children:d.icon?(0,t.jsx)("span",{className:"text-lg",children:d.icon}):(0,t.jsx)(eM.Z,{className:"h-5 w-5"})}),h&&(0,t.jsx)("div",{className:"absolute z-10 mt-2 p-3 bg-white border rounded-lg shadow-lg grid grid-cols-5 gap-2",children:eU.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{m(s=>({...s,icon:e})),j(!1)},className:"w-8 h-8 text-lg hover:bg-neutral-100 rounded",children:e},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{children:"Color"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.z,{type:"button",variant:"outline",onClick:()=>f(!p),className:"w-12 h-12 p-0",style:{backgroundColor:d.color},children:(0,t.jsx)(eE.Z,{className:"h-5 w-5 text-white"})}),p&&(0,t.jsx)("div",{className:"absolute z-10 mt-2 p-3 bg-white border rounded-lg shadow-lg grid grid-cols-5 gap-2",children:eI.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{m(s=>({...s,color:e})),f(!1)},className:"w-8 h-8 rounded border-2 border-neutral-200",style:{backgroundColor:e}},e))})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(Z._,{children:"Keywords (for auto-categorization)"}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(g.I,{value:x,onChange:e=>u(e.target.value),placeholder:"Add keyword",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),v())}}),(0,t.jsx)(o.z,{type:"button",onClick:v,variant:"outline",children:"Add"})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:d.keywords.map(e=>(0,t.jsxs)(U.C,{variant:"outline",className:"flex items-center gap-1",children:[e,(0,t.jsx)("button",{type:"button",onClick:()=>N(e),className:"ml-1 hover:bg-neutral-200 rounded p-0.5",children:(0,t.jsx)(y.Z,{className:"h-3 w-3"})})]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(Z._,{htmlFor:"confidence",children:["Confidence Threshold (",(100*d.confidence_threshold).toFixed(0),"%)"]}),(0,t.jsx)("input",{id:"confidence",type:"range",min:"0.1",max:"1",step:"0.1",value:d.confidence_threshold,onChange:e=>m(s=>({...s,confidence_threshold:parseFloat(e.target.value)})),className:"w-full"}),(0,t.jsx)("p",{className:"text-sm text-neutral-600 mt-1",children:"Minimum confidence level for automatic categorization"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(o.z,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),(0,t.jsxs)(o.z,{type:"submit",disabled:c,children:[c?"Saving...":l?"Update":"Create"," Category"]})]})]})})}let eK=e=>{switch(e){case"income":return(0,t.jsx)(eD.Z,{className:"h-4 w-4 text-success-600"});case"expense":return(0,t.jsx)(eZ.Z,{className:"h-4 w-4 text-error-600"});case"transfer":return(0,t.jsx)(eF.Z,{className:"h-4 w-4 text-info-600"});default:return(0,t.jsx)(es.Z,{className:"h-4 w-4 text-neutral-600"})}},eq=e=>{switch(e){case"income":return"success";case"expense":return"destructive";case"transfer":return"default";default:return"secondary"}};function eO(e){let{categories:s,selectedCategories:a,onSelectionChange:n,onEdit:l,onDelete:r,onCopy:i,onMerge:c,onPreview:o,onToggleExpand:d,onDragEnd:m,isLoading:x}=e,u=(0,eT.Dy)((0,eT.VT)(eT.we),(0,eT.VT)(eT.Lg,{coordinateGetter:eA.is}));return x?(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-16 bg-neutral-100 animate-pulse rounded-lg"},s))}):(0,t.jsx)(eT.LB,{sensors:u,collisionDetection:eT.pE,onDragEnd:m,children:(0,t.jsx)(eA.Fo,{items:s.map(e=>e.id),strategy:eA.qw,children:(0,t.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,t.jsx)(eV,{category:e,isSelected:a.includes(e.id),onSelect:(e,s)=>{s?n([...a,e]):n(a.filter(s=>s!==e))},onEdit:l,onDelete:r,onCopy:i,onMerge:c,onPreview:o,onToggleExpand:d},e.id))})})})}function eB(e){let{categories:s,selectedCategories:a,onSelectionChange:n,onEdit:l,onDelete:r,onCopy:i,onMerge:c,onPreview:m,isLoading:x}=e;return x?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((e,s)=>(0,t.jsx)("div",{className:"h-32 bg-neutral-100 animate-pulse rounded-lg"},s))}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>(0,t.jsxs)(d.Zb,{className:"p-4 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(X.X,{checked:a.includes(e.id),onChange:s=>{s.target.checked?n([...a,e.id]):n(a.filter(s=>s!==e.id))}}),(0,t.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center",style:{backgroundColor:e.color||"#6B7280"},children:(0,t.jsx)("span",{className:"text-white text-sm",children:e.icon||eK(e.type)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-neutral-900",children:e.name}),(0,t.jsx)(U.C,{variant:eq(e.type),className:"text-xs",children:e.type})]})]})}),e.is_system&&(0,t.jsx)(U.C,{variant:"outline",className:"text-xs mb-2",children:"System Category"}),e.keywords&&e.keywords.length>0&&(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("p",{className:"text-xs text-neutral-600 mb-1",children:"Keywords:"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.keywords.slice(0,3).map((e,s)=>(0,t.jsx)(U.C,{variant:"outline",className:"text-xs",children:e},s)),e.keywords.length>3&&(0,t.jsxs)(U.C,{variant:"outline",className:"text-xs",children:["+",e.keywords.length-3," more"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 mt-3",children:[(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>m(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(eS.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>i(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(er.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>l(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(el.Z,{className:"h-4 w-4"})}),!e.is_system&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>c(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(ez.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>r(e),className:"h-8 w-8 p-0 text-error-600 hover:text-error-700 hover:bg-error-50",children:(0,t.jsx)(ei.Z,{className:"h-4 w-4"})})]})]})]},e.id))})}function eW(e){let{categoryStats:s,categorySpending:a,searchTerm:n,isLoading:l}=e;if(l)return(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-20 bg-neutral-100 animate-pulse rounded-lg"},s))});let r=s.filter(e=>e.category.name.toLowerCase().includes(n.toLowerCase()));return(0,t.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,t.jsxs)(d.Zb,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center",style:{backgroundColor:e.category.color||"#6B7280"},children:(0,t.jsx)("span",{className:"text-white text-sm",children:e.category.icon||eK(e.category.type)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-neutral-900",children:e.category.name}),(0,t.jsxs)("p",{className:"text-sm text-neutral-600",children:[e.transaction_count," transactions • Avg: ",(0,z.xG)(e.avg_amount)]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-lg font-semibold",children:(0,z.xG)(e.total_amount)}),(0,t.jsxs)("p",{className:"text-sm text-neutral-600",children:[e.usage_frequency.toFixed(1)," tx/month"]})]})]}),e.last_used&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-neutral-600",children:["Last used: ",new Date(e.last_used).toLocaleDateString()]})]},e.category.id))})}function eY(e){let{categories:s,onManageRules:a,isLoading:n}=e;return n?(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-16 bg-neutral-100 animate-pulse rounded-lg"},s))}):(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>{var s;return(0,t.jsx)(d.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center",style:{backgroundColor:e.color||"#6B7280"},children:(0,t.jsx)("span",{className:"text-white text-sm",children:e.icon||eK(e.type)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-neutral-900",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-neutral-600",children:[(null===(s=e.rules)||void 0===s?void 0:s.length)||0," rules • Confidence: ",(100*(e.confidence_threshold||.8)).toFixed(0),"%"]})]})]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>a(e),children:[(0,t.jsx)(eC.Z,{className:"h-4 w-4 mr-1"}),"Manage Rules"]})]})},e.id)})})}function eG(e){let{isOpen:s,onClose:a,category:n}=e;return(0,t.jsx)(eg,{isOpen:s,onClose:a,title:"Manage Category Rules",size:"lg",children:(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("p",{className:"text-neutral-600",children:['Configure rules for automatic categorization of transactions for "',null==n?void 0:n.name,'"']})})})}function eX(e){let{isOpen:s,onClose:a,onImport:n}=e;return(0,t.jsx)(eg,{isOpen:s,onClose:a,title:"Import Categories",children:(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)("p",{className:"text-neutral-600",children:"Import categories from a CSV or JSON file"})})})}function eJ(e){let{isOpen:s,onClose:a,sourceCategory:n,categories:l,onMerge:r,isLoading:i}=e;return(0,t.jsx)(eg,{isOpen:s,onClose:a,title:"Merge Categories",children:(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("p",{className:"text-neutral-600",children:['Merge "',null==n?void 0:n.name,'" into another category. All transactions will be moved.']})})})}function e$(e){let{isOpen:s,onClose:a,category:n}=e;return(0,t.jsx)(eg,{isOpen:s,onClose:a,title:"Category Preview",children:(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("p",{className:"text-neutral-600",children:['Preview transactions in "',null==n?void 0:n.name,'" category']})})})}var eH=a(83989),e0=a(77329),e1=a(79901),e4=a(90743),e2=a(53512),e3=a(93017),e5=a(10997),e6=a(2461),e8=a(20054),e9=a(97112);let e7=e9.fC;e9.xz;let se=e9.h_,ss=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(e9.aV,{className:(0,z.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:s})});ss.displayName=e9.aV.displayName;let sa=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsxs)(se,{children:[(0,t.jsx)(ss,{}),(0,t.jsx)(e9.VY,{ref:s,className:(0,z.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]})});sa.displayName=e9.VY.displayName;let st=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,z.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...a})};st.displayName="AlertDialogHeader";let sn=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,z.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};sn.displayName="AlertDialogFooter";let sl=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(e9.Dx,{ref:s,className:(0,z.cn)("text-lg font-semibold",a),...n})});sl.displayName=e9.Dx.displayName;let sr=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(e9.dk,{ref:s,className:(0,z.cn)("text-sm text-muted-foreground",a),...n})});sr.displayName=e9.dk.displayName;let si=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(e9.aU,{ref:s,className:(0,z.cn)((0,o.d)(),a),...n})});si.displayName=e9.aU.displayName;let sc=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(e9.$j,{ref:s,className:(0,z.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...n})});sc.displayName=e9.$j.displayName;var so=a(22927),sd=a(7437);function sm(e){let{selectedTransactions:s,onClearSelection:a,onCategorize:l,onTransactionsUpdated:i,className:m}=e,x=(0,r.NL)(),u=(0,eL.PM)(),h=(0,eL.cM)(),[g,p]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[N,w]=(0,n.useState)(null),[C,b]=(0,n.useState)(!1),[k,_]=(0,n.useState)([]),S=(0,c.D)({mutationFn:async e=>{let{updates:s,transactionIds:a}=e;return ey.d.bulkUpdateTransactions({transaction_ids:a,updates:s})},onSuccess:e=>{x.invalidateQueries({queryKey:["transactions"]}),x.invalidateQueries({queryKey:["transaction-stats"]}),i(e)}}),D=(0,c.D)({mutationFn:async e=>{let a=s.slice();return _(e=>[...e,{operation:"delete",transactions:a,timestamp:new Date}]),Promise.all(e.map(e=>ey.d.deleteTransaction(e)))},onSuccess:()=>{x.invalidateQueries({queryKey:["transactions"]}),x.invalidateQueries({queryKey:["transaction-stats"]}),u("Transactions Deleted","Successfully deleted ".concat(s.length," transactions")),a()},onError:e=>{h("Delete Failed",e.message||"Failed to delete transactions")}}),Z=(0,c.D)({mutationFn:async e=>{let a={transaction_ids:s.map(e=>e.id)};return ey.d.exportTransactions(a,e)},onSuccess:(e,a)=>{u("Export Complete","".concat(s.length," transactions exported as ").concat(a.toUpperCase()))},onError:e=>{h("Export Failed",e.message||"Failed to export transactions")}}),F=(0,n.useMemo)(()=>{let e=s.reduce((e,s)=>e+s.amount,0),a=s.filter(e=>e.amount>0).reduce((e,s)=>e+s.amount,0),t=s.filter(e=>e.amount<0).reduce((e,s)=>e+Math.abs(s.amount),0),n=new Set(s.map(e=>e.account_id)).size,l=s.length>0?{start:new Date(Math.min(...s.map(e=>new Date(e.date).getTime()))),end:new Date(Math.max(...s.map(e=>new Date(e.date).getTime())))}:null,r=s.filter(e=>!e.category_id).length,i=s.filter(e=>e.is_pending).length;return{count:s.length,totalAmount:e,incomeAmount:a,expenseAmount:t,accounts:n,dateRange:l,uncategorized:r,pending:i}},[s]),M=(0,n.useMemo)(()=>{if(s.length<2)return[];let e=[],a=Object.entries(s.reduce((e,s)=>{let a=s.merchant_name||"Unknown";return e[a]=(e[a]||0)+1,e},{})).sort((e,s)=>{let[,a]=e,[,t]=s;return t-a})[0];a&&a[1]>1&&e.push({type:"merchant",title:"All from ".concat(a[0]),description:"".concat(a[1]," transactions from the same merchant"),count:a[1],icon:(0,t.jsx)(eH.Z,{className:"h-4 w-4"}),action:()=>{console.log("Filter by merchant:",a[0])}});let n=Object.entries(s.reduce((e,s)=>{let a=Math.round(Math.abs(s.amount));return e[a]=(e[a]||0)+1,e},{})).sort((e,s)=>{let[,a]=e,[,t]=s;return t-a})[0];n&&n[1]>1&&e.push({type:"amount",title:"Similar amounts (~".concat((0,z.xG)(Number(n[0])),")"),description:"".concat(n[1]," transactions with similar amounts"),count:n[1],icon:(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),action:()=>{console.log("Filter by amount:",n[0])}});let l=s.filter(e=>(0,sd.k)(new Date(e.date))).length;return l>.8*s.length&&e.push({type:"date",title:"Recent transactions",description:"".concat(l," transactions from this month"),count:l,icon:(0,t.jsx)(ee.Z,{className:"h-4 w-4"}),action:()=>{console.log("Focus on recent transactions")}}),e},[s]),E=(0,n.useCallback)(async e=>{try{w({isRunning:!0,operation:e?"Marking as reviewed":"Marking as unreviewed",completed:0,total:s.length,errors:[],startTime:new Date}),await S.mutateAsync({updates:{notes:e?"reviewed":void 0},transactionIds:s.map(e=>e.id)}),w(null),u(e?"Marked as Reviewed":"Marked as Unreviewed","".concat(s.length," transactions updated")),a()}catch(e){w(null),h("Update Failed",e.message||"Failed to update transactions")}},[s,S,u,h,a]),T=(0,n.useCallback)(async()=>{try{w({isRunning:!0,operation:"Deleting transactions",completed:0,total:s.length,errors:[],startTime:new Date}),await D.mutateAsync(s.map(e=>e.id)),w(null),p(!1)}catch(e){w(null)}},[s,D]),A=(0,n.useCallback)(async e=>{try{await Z.mutateAsync(e),v(!1)}catch(e){}},[Z]),P=(0,n.useCallback)(()=>{if(0===k.length)return;let e=k[k.length-1];_(e=>e.slice(0,-1)),u("Undo Available","".concat(e.operation," operation can be undone (feature coming soon)"))},[k,u]);return 0===s.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Zb,{className:(0,z.cn)("border-primary-200 bg-primary-50/50",m),children:(0,t.jsx)(d.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[N&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"font-medium",children:[N.operation,"..."]}),(0,t.jsxs)("span",{children:[N.completed,"/",N.total]})]}),(0,t.jsx)(so.E,{value:N.completed/N.total*100,className:"h-2"}),N.errors.length>0&&(0,t.jsxs)("div",{className:"text-xs text-error-600",children:[N.errors.length," errors occurred"]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(U.C,{variant:"default",className:"text-sm",children:[F.count," selected"]}),(0,t.jsxs)("div",{className:"text-sm text-neutral-600",children:[(0,t.jsx)("span",{className:"font-medium",children:(0,z.xG)(F.totalAmount)}),F.accounts>1&&(0,t.jsxs)("span",{className:"ml-2",children:["• ",F.accounts," accounts"]})]})]}),F.incomeAmount>0&&F.expenseAmount>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-neutral-500",children:[(0,t.jsxs)("span",{className:"text-success-600",children:["+",(0,z.xG)(F.incomeAmount)]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{className:"text-error-600",children:["-",(0,z.xG)(F.expenseAmount)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[F.uncategorized>0&&(0,t.jsxs)(J.u,{children:[(0,t.jsx)(J.aJ,{children:(0,t.jsxs)(U.C,{variant:"outline",className:"text-xs",children:[F.uncategorized," uncategorized"]})}),(0,t.jsxs)(J._v,{children:[F.uncategorized," transactions need categorization"]})]}),F.pending>0&&(0,t.jsxs)(J.u,{children:[(0,t.jsx)(J.aJ,{children:(0,t.jsxs)(U.C,{variant:"secondary",className:"text-xs",children:[F.pending," pending"]})}),(0,t.jsxs)(J._v,{children:[F.pending," transactions are still pending"]})]})]}),M.length>0&&(0,t.jsxs)(j.h_,{open:C,onOpenChange:b,children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-7",children:[(0,t.jsx)(e0.Z,{className:"h-4 w-4 mr-1"}),M.length," suggestion",1!==M.length?"s":""]})}),(0,t.jsxs)(j.AW,{align:"start",className:"w-80",children:[(0,t.jsx)(j.Ju,{children:"Smart Suggestions"}),(0,t.jsx)(j.VD,{}),M.map((e,s)=>(0,t.jsxs)(j.Xi,{onClick:e.action,className:"flex items-start gap-3 py-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:e.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium",children:e.title}),(0,t.jsx)("div",{className:"text-xs text-neutral-500",children:e.description})]})]},s))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:l,disabled:S.isPending,children:[(0,t.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Categorize"]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>E(!0),disabled:S.isPending,children:[(0,t.jsx)(e1.Z,{className:"h-4 w-4 mr-1"}),"Mark Reviewed"]}),(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsxs)(o.z,{variant:"outline",size:"sm",children:[(0,t.jsx)(e4.Z,{className:"h-4 w-4 mr-1"}),"More Actions"]})}),(0,t.jsxs)(j.AW,{align:"end",children:[(0,t.jsx)(j.Ju,{children:"Bulk Actions"}),(0,t.jsx)(j.VD,{}),(0,t.jsxs)(j.Xi,{onClick:()=>v(!0),children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4 mr-2"}),"Export Selected"]}),(0,t.jsxs)(j.Xi,{onClick:()=>E(!1),children:[(0,t.jsx)(e2.Z,{className:"h-4 w-4 mr-2"}),"Mark Unreviewed"]}),(0,t.jsxs)(j.Xi,{onClick:()=>{E(!0)},children:[(0,t.jsx)(e3.Z,{className:"h-4 w-4 mr-2"}),"Archive"]}),(0,t.jsx)(j.VD,{}),(0,t.jsxs)(j.Xi,{onClick:()=>p(!0),className:"text-error-600 focus:text-error-600",children:[(0,t.jsx)(e5.Z,{className:"h-4 w-4 mr-2"}),"Delete Selected"]})]})]}),k.length>0&&(0,t.jsxs)(J.u,{children:[(0,t.jsx)(J.aJ,{asChild:!0,children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:P,className:"h-8 w-8 p-0",children:(0,t.jsx)(e6.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(J._v,{children:"Undo last operation"})]}),(0,t.jsx)(o.z,{variant:"ghost",size:"sm",onClick:a,className:"h-8 w-8 p-0",children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})})]})]}),F.dateRange&&(0,t.jsx)("div",{className:"text-xs text-neutral-500",children:F.dateRange.start.getTime()===F.dateRange.end.getTime()?"".concat((0,W.WU)(F.dateRange.start,"MMM d, yyyy")):"".concat((0,W.WU)(F.dateRange.start,"MMM d")," - ").concat((0,W.WU)(F.dateRange.end,"MMM d, yyyy"))})]})})}),(0,t.jsx)(e7,{open:g,onOpenChange:p,children:(0,t.jsxs)(sa,{children:[(0,t.jsxs)(st,{children:[(0,t.jsxs)(sl,{className:"flex items-center gap-2",children:[(0,t.jsx)(e8.Z,{className:"h-5 w-5 text-error-600"}),"Delete ",s.length," Transaction",1!==s.length?"s":"","?"]}),(0,t.jsxs)(sr,{className:"space-y-2",children:[(0,t.jsx)("p",{children:"This action cannot be undone. The following transactions will be permanently deleted:"}),(0,t.jsxs)("div",{className:"bg-neutral-50 rounded-lg p-3 space-y-1 max-h-32 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:[F.count," transactions • ",(0,z.xG)(F.totalAmount)]}),F.dateRange&&(0,t.jsxs)("div",{className:"text-xs text-neutral-500",children:[(0,W.WU)(F.dateRange.start,"MMM d")," - ",(0,W.WU)(F.dateRange.end,"MMM d, yyyy")]}),F.accounts>1&&(0,t.jsxs)("div",{className:"text-xs text-neutral-500",children:["Across ",F.accounts," accounts"]})]})]})]}),(0,t.jsxs)(sn,{children:[(0,t.jsx)(sc,{children:"Cancel"}),(0,t.jsx)(si,{onClick:T,className:"bg-error-600 hover:bg-error-700",disabled:D.isPending,children:D.isPending?"Deleting...":"Delete Transactions"})]})]})}),(0,t.jsx)(e7,{open:f,onOpenChange:v,children:(0,t.jsxs)(sa,{children:[(0,t.jsxs)(st,{children:[(0,t.jsxs)(sl,{className:"flex items-center gap-2",children:[(0,t.jsx)(et.Z,{className:"h-5 w-5"}),"Export ",s.length," Transaction",1!==s.length?"s":""]}),(0,t.jsx)(sr,{children:"Choose the format for exporting your selected transactions."})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 py-4",children:[(0,t.jsxs)(o.z,{variant:"outline",onClick:()=>A("csv"),disabled:Z.isPending,className:"h-20 flex-col",children:[(0,t.jsx)(et.Z,{className:"h-6 w-6 mb-2"}),"CSV File",(0,t.jsx)("span",{className:"text-xs text-neutral-500",children:"Spreadsheet compatible"})]}),(0,t.jsxs)(o.z,{variant:"outline",onClick:()=>A("xlsx"),disabled:Z.isPending,className:"h-20 flex-col",children:[(0,t.jsx)(et.Z,{className:"h-6 w-6 mb-2"}),"Excel File",(0,t.jsx)("span",{className:"text-xs text-neutral-500",children:"Full formatting"})]})]}),(0,t.jsx)(sn,{children:(0,t.jsx)(sc,{children:"Cancel"})})]})})]})}var sx=a(12198),su=a(88623),sh=a(39790),sg=a(72829),sj=a(55055);function sp(e){let{icon:s,title:a,description:n,actionText:l,onAction:r}=e;return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(s,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:a}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-4 max-w-sm",children:n}),l&&r&&(0,t.jsx)(o.z,{onClick:r,children:l})]})}function sy(e){let{title:s,value:a,icon:n,trend:l,color:r="default",isLoading:i=!1}=e;return(0,t.jsx)(d.Zb,{children:(0,t.jsx)(d.aY,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-neutral-600",children:s}),i?(0,t.jsx)("div",{className:"h-8 w-24 bg-neutral-200 animate-pulse rounded"}):(0,t.jsx)("p",{className:"text-2xl font-bold ".concat({default:"text-neutral-600",success:"text-success-600",error:"text-error-600",warning:"text-warning-600"}[r]),children:a})]}),(0,t.jsx)("div",{className:"p-3 rounded-full bg-neutral-50 ".concat({default:"text-neutral-500",success:"text-success-500",error:"text-error-500",warning:"text-warning-500"}[r]),children:(0,t.jsx)(n,{className:"h-6 w-6"})})]})})})}let sf={date_from:(0,W.WU)((0,K.N)(new Date),"yyyy-MM-dd"),date_to:(0,W.WU)((0,q.V)(new Date),"yyyy-MM-dd")};function sv(){let e=(0,r.NL)(),s=(0,eL.PM)(),a=(0,eL.cM)(),[x,u]=(0,n.useState)(sf),[h,g]=(0,n.useState)([]),[p,y]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[N,w]=(0,n.useState)([]),[C,b]=(0,n.useState)(!1),[k,_]=(0,n.useState)(!1),{data:S,isLoading:Z,error:F}=(0,i.a)({queryKey:["transactions",x],queryFn:()=>ey.d.getTransactions(x)}),{data:M=[],isLoading:E}=(0,i.a)({queryKey:["accounts"],queryFn:sj.S.getAccounts}),{data:T=[],isLoading:A}=(0,i.a)({queryKey:["categories"],queryFn:ep.Y.getCategories}),{data:P,isLoading:L}=(0,i.a)({queryKey:["transaction-stats",x],queryFn:()=>ey.d.getTransactionStats({date_from:x.date_from,date_to:x.date_to,account_id:x.account_id})});(0,c.D)({mutationFn:e=>{let{id:s,updates:a}=e;return ey.d.updateTransaction(s,a)},onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["transaction-stats"]}),s("Transaction Updated","The transaction has been updated successfully")},onError:e=>{a("Update Failed",e.message||"Failed to update transaction")}});let I=(0,c.D)({mutationFn:ey.d.deleteTransaction,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["transaction-stats"]}),s("Transaction Deleted","The transaction has been deleted successfully")},onError:e=>{a("Delete Failed",e.message||"Failed to delete transaction")}});(0,c.D)({mutationFn:e=>ey.d.categorizeTransactions(e),onSuccess:a=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["transaction-stats"]}),s("Categorization Complete","Successfully categorized ".concat(a.categorized_count," transactions"))},onError:e=>{a("Categorization Failed",e.message||"Failed to categorize transactions")}});let R=(0,n.useCallback)(async()=>{y(!0);try{await ey.d.syncTransactions(),await e.invalidateQueries({queryKey:["transactions"]}),await e.invalidateQueries({queryKey:["transaction-stats"]}),s("Sync Complete","Transactions have been synced successfully")}catch(e){a("Sync Failed",e.message||"Failed to sync transactions")}finally{y(!1)}},[e,s,a]),Q=(0,n.useCallback)(async e=>{try{await ey.d.exportTransactions(x,e),s("Export Complete","Transactions exported as ".concat(e.toUpperCase()))}catch(e){a("Export Failed",e.message||"Failed to export transactions")}},[x,s,a]),K=(0,n.useCallback)(e=>{console.log("Edit transaction:",e)},[]),q=(0,n.useCallback)(e=>{confirm("Are you sure you want to delete this transaction?")&&I.mutate(e.id)},[I]),O=(0,n.useCallback)(e=>{w([e]),v(!0)},[]),Y=(0,n.useCallback)(()=>{if(0===h.length){a("No Selection","Please select transactions to categorize");return}w(h),v(!0)},[h,a]),ec=(0,n.useCallback)(()=>{g([]),_(!1)},[]),eo=(0,n.useCallback)(e=>{g(e),_(e.length>0)},[]),em=(0,n.useCallback)(()=>{u(sf)},[]),ex=(0,n.useCallback)(()=>{v(!1),w([])},[]),eu=(0,n.useCallback)(s=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["transaction-stats"]})},[e]),eg=(0,n.useMemo)(()=>(null==S?void 0:S.transactions)||[],[S]),ej=(0,n.useMemo)(()=>(null==S?void 0:S.total)||0,[S]);n.useEffect(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"a"===e.key&&(e.preventDefault(),eg&&eg.length>0&&(g(eg),_(!0),s("All Visible Transactions Selected","Selected ".concat(eg.length," transactions")))),"Escape"===e.key&&h.length>0&&(ec(),s("Selection Cleared","All transactions deselected")),(e.metaKey||e.ctrlKey)&&e.shiftKey&&"C"===e.key&&(e.preventDefault(),h.length>0&&Y())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[eg,h,ec,Y,s]);let ef=(0,n.useMemo)(()=>(function(e){let{accounts:s,categories:a,onEdit:n,onDelete:l,onCategorize:r,onDuplicate:i,onViewDetails:c}=e;return[{id:"select",header:e=>{let{table:s}=e;return(0,t.jsx)(X.X,{checked:s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e),"aria-label":"Select all"})},cell:e=>{let{row:s}=e;return(0,t.jsx)(X.X,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),"aria-label":"Select row","data-no-row-click":!0})},enableSorting:!1,enableHiding:!1},{accessorKey:"date",header:"Date",cell:e=>{let{row:s}=e,a=(0,B.D)(s.getValue("date"));return(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[(0,t.jsx)("div",{className:"font-medium",children:(0,W.WU)(a,"MMM d, yyyy")}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,W.WU)(a,"EEEE")})]})},sortingFn:"datetime"},{accessorKey:"description",header:"Description",cell:e=>{let{row:s}=e,a=s.original,n=a.amount>0;return(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)("div",{className:(0,z.cn)("mt-1 p-1 rounded",n?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:n?(0,t.jsx)($.Z,{className:"h-3 w-3"}):(0,t.jsx)(H.Z,{className:"h-3 w-3"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium truncate",children:a.description}),a.merchant_name&&a.merchant_name!==a.description&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:a.merchant_name})]}),a.is_pending&&(0,t.jsx)(J.pn,{children:(0,t.jsxs)(J.u,{children:[(0,t.jsx)(J.aJ,{children:(0,t.jsx)(ee.Z,{className:"h-4 w-4 text-amber-500"})}),(0,t.jsx)(J._v,{children:(0,t.jsx)("p",{children:"Pending transaction"})})]})})]})}},{id:"category",header:"Category",accessorFn:e=>e.category||"Uncategorized",cell:e=>{let{row:s}=e,n=s.original,l=n.category_id?a.find(e=>e.id===n.category_id):null;return l?(0,t.jsxs)(U.C,{variant:"outline",className:"cursor-pointer",onClick:e=>{e.stopPropagation(),r&&r(n)},"data-no-row-click":!0,children:[l.icon&&(0,t.jsx)("span",{className:"mr-1",children:l.icon}),l.name,n.subcategory&&(0,t.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["/ ",n.subcategory]})]}):(0,t.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-7 text-xs text-muted-foreground hover:text-foreground",onClick:e=>{e.stopPropagation(),r&&r(n)},"data-no-row-click":!0,children:[(0,t.jsx)(es.Z,{className:"mr-1 h-3 w-3"}),"Add category"]})},filterFn:(e,s,a)=>"Uncategorized"===a?!e.original.category_id:e.original.category_id===a},{accessorKey:"account_id",header:"Account",cell:e=>{let{row:a}=e,n=s.find(e=>e.id===a.getValue("account_id"));return n?(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:n.name}),n.mask&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["•••• ",n.mask]})]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"Unknown"})},filterFn:(e,s,a)=>e.getValue(s)===a},{accessorKey:"amount",header:e=>{let{column:s}=e;return(0,t.jsx)(o.z,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"hover:bg-transparent p-0",children:"Amount"})},cell:e=>{let{row:s}=e,a=parseFloat(s.getValue("amount")),n=a>0;return(0,t.jsxs)("div",{className:(0,z.cn)("font-mono font-semibold text-right whitespace-nowrap",n?"text-green-600":"text-red-600"),children:[n?"+":"-","$",Math.abs(a).toFixed(2)]})},sortingFn:"basic"},{id:"status",header:"Status",cell:e=>{let{row:s}=e,a=s.original;return(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[a.is_pending?(0,t.jsxs)(U.C,{variant:"secondary",className:"text-xs",children:[(0,t.jsx)(ee.Z,{className:"mr-1 h-3 w-3"}),"Pending"]}):(0,t.jsxs)(U.C,{variant:"outline",className:"text-xs",children:[(0,t.jsx)(ea.Z,{className:"mr-1 h-3 w-3"}),"Posted"]}),a.notes&&(0,t.jsx)(J.pn,{children:(0,t.jsxs)(J.u,{children:[(0,t.jsx)(J.aJ,{children:(0,t.jsx)(et.Z,{className:"h-3 w-3 text-muted-foreground"})}),(0,t.jsx)(J._v,{children:(0,t.jsx)("p",{className:"max-w-xs",children:a.notes})})]})})]})}},{id:"actions",enableHiding:!1,cell:e=>{let{row:s}=e,a=s.original;return(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsxs)(o.z,{variant:"ghost",className:"h-8 w-8 p-0","data-no-row-click":!0,children:[(0,t.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,t.jsx)(en.Z,{className:"h-4 w-4"})]})}),(0,t.jsxs)(j.AW,{align:"end",children:[(0,t.jsx)(j.Ju,{children:"Actions"}),(0,t.jsxs)(j.Xi,{onClick:()=>c&&c(a),children:[(0,t.jsx)(et.Z,{className:"mr-2 h-4 w-4"}),"View details"]}),(0,t.jsxs)(j.Xi,{onClick:()=>n&&n(a),children:[(0,t.jsx)(el.Z,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,t.jsxs)(j.Xi,{onClick:()=>r&&r(a),children:[(0,t.jsx)(es.Z,{className:"mr-2 h-4 w-4"}),"Categorize"]}),(0,t.jsxs)(j.Xi,{onClick:()=>i&&i(a),children:[(0,t.jsx)(er.Z,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),(0,t.jsx)(j.VD,{}),(0,t.jsxs)(j.Xi,{onClick:()=>l&&l(a),className:"text-red-600",children:[(0,t.jsx)(ei.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}}]})({accounts:M,categories:T,onEdit:K,onDelete:q,onCategorize:O}),[M,T,K,q,O]),eN=Z||E||A,ew=!eN&&0===eg.length&&!F;return(0,t.jsxs)(l.c,{title:"Transactions",description:"View and manage all your financial transactions across all accounts",children:[(0,t.jsxs)("div",{className:"space-y-6 relative",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-neutral-900",children:"All Transactions"}),(0,t.jsxs)("p",{className:"text-sm text-neutral-600 mt-1",children:[ej.toLocaleString()," total transactions",x.date_from&&x.date_to&&(0,t.jsxs)("span",{className:"ml-1",children:["from ",(0,W.WU)(new Date(x.date_from),"MMM d")," to ",(0,W.WU)(new Date(x.date_to),"MMM d, yyyy")]}),h.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-primary-600 font-medium",children:["• ",h.length," selected"]})]}),h.length>0&&(0,t.jsxs)("div",{className:"text-xs text-neutral-500 mt-1",children:["Keyboard shortcuts: ",(0,t.jsx)("kbd",{className:"px-1 py-0.5 bg-neutral-100 rounded text-xs",children:"Cmd+A"})," select all,",(0,t.jsx)("kbd",{className:"px-1 py-0.5 bg-neutral-100 rounded text-xs",children:"Esc"})," clear,",(0,t.jsx)("kbd",{className:"px-1 py-0.5 bg-neutral-100 rounded text-xs",children:"Cmd+Shift+C"})," categorize"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>Q("csv"),disabled:0===eg.length,children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4 mr-1"}),"Export"]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>b(!0),children:[(0,t.jsx)(sx.Z,{className:"h-4 w-4 mr-1"}),"Manage Categories"]}),(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:R,disabled:p,children:[p?(0,t.jsx)(m.gb,{size:"sm",className:"mr-1"}):(0,t.jsx)(su.Z,{className:"h-4 w-4 mr-1"}),"Sync"]}),(0,t.jsxs)(o.z,{size:"sm",children:[(0,t.jsx)(eh.Z,{className:"h-4 w-4 mr-1"}),"Add Transaction"]})]})]}),P&&(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)(sy,{title:"Total Income",value:(0,z.xG)(P.total_income),icon:eD.Z,color:"success",isLoading:L}),(0,t.jsx)(sy,{title:"Total Expenses",value:(0,z.xG)(Math.abs(P.total_expenses)),icon:eZ.Z,color:"error",isLoading:L}),(0,t.jsx)(sy,{title:"Net Income",value:(0,z.xG)(P.net_income),icon:V.Z,color:P.net_income>=0?"success":"error",isLoading:L}),(0,t.jsx)(sy,{title:"Avg Transaction",value:(0,z.xG)(P.avg_transaction_amount),icon:sh.Z,isLoading:L})]}),(0,t.jsxs)(d.Zb,{children:[(0,t.jsxs)(d.Ol,{className:"pb-4",children:[(0,t.jsx)(d.ll,{className:"text-lg",children:"Filters"}),(0,t.jsx)(d.SZ,{children:"Filter and search through your transactions"})]}),(0,t.jsx)(d.aY,{children:(0,t.jsx)(G,{filters:x,onFiltersChange:u,accounts:M,categories:T,onReset:em})})]}),h.length>0&&(0,t.jsx)("div",{className:"sticky top-4 z-10",children:(0,t.jsx)(sm,{selectedTransactions:h,onClearSelection:ec,onCategorize:Y,onTransactionsUpdated:eu})}),k&&h.length>0&&(0,t.jsx)("div",{className:"fixed bottom-6 right-6 z-20 md:hidden",children:(0,t.jsx)(o.z,{onClick:Y,className:"h-14 w-14 rounded-full shadow-lg",size:"sm",children:(0,t.jsx)(Tag,{className:"h-6 w-6"})})}),F?(0,t.jsx)(d.Zb,{children:(0,t.jsx)(d.aY,{className:"py-12",children:(0,t.jsx)(sp,{icon:ed.Z,title:"Error Loading Transactions",description:F.message||"Failed to load transactions",actionText:"Try Again",onAction:R})})}):ew?(0,t.jsx)(d.Zb,{children:(0,t.jsx)(d.aY,{className:"py-12",children:(0,t.jsx)(sp,{icon:x.date_from||x.account_id?et.Z:sg.Z,title:x.date_from||x.account_id?"No Transactions Found":"No Transactions Yet",description:x.date_from||x.account_id?"No transactions match your current filters. Try adjusting your search criteria.":"You don't have any transactions yet. Connect your accounts to start tracking.",actionText:x.date_from||x.account_id?"Clear Filters":"Connect Account",onAction:()=>x.date_from||x.account_id?em():window.location.href="/accounts"})})}):(0,t.jsx)(d.Zb,{className:"overflow-hidden",children:(0,t.jsx)(D,{columns:ef,data:eg,onRowSelectionChange:eo,onRowClick:e=>O(e),searchKey:"description",searchPlaceholder:"Search by description or merchant...",showColumnToggle:!0,showPagination:!0,pageSize:50,isLoading:eN||p,emptyMessage:"No transactions found matching your filters.",className:"border-0"})})]}),(0,t.jsx)(ev,{isOpen:f,onClose:ex,transactions:N,onTransactionsUpdated:eu}),(0,t.jsx)(eR,{isOpen:C,onClose:()=>b(!1)})]})}}},function(e){e.O(0,[351,671,293,528,744],function(){return e(e.s=96218)}),_N_E=e.O()}]);