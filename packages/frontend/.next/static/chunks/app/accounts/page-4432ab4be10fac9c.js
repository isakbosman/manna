(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{80750:function(e,s,t){Promise.resolve().then(t.bind(t,56941))},56941:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return F}});var n=t(27573),a=t(7653),c=t(23087);function l(){return(0,a.useEffect)(()=>{let e=()=>{console.log("=== Plaid Test ==="),console.log("window.Plaid exists:",!!window.Plaid),window.Plaid&&console.log("Plaid object:",window.Plaid)};e();let s=setTimeout(e,3e3);return fetch("http://localhost:8001/api/v1/plaid/create-link-token",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{console.log("Link token response:",e)}).catch(e=>{console.error("Link token error:",e)}),()=>clearTimeout(s)},[]),null}var i=t(50466),r=t(76095),d=t(55055),o=t(32026),m=t(30609),x=t(74859);function u(e){let{onSuccess:s,onError:t,disabled:c=!1,className:l=""}=e,[u,h]=(0,a.useState)(null),[j,g]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[N,p]=(0,a.useState)(null),[b,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://cdn.plaid.com/link/v2/stable/link-initialize.js",e.async=!0,e.onload=()=>{console.log("Plaid script loaded successfully")},e.onerror=()=>{console.error("Failed to load Plaid script"),p("Failed to load Plaid Link. Please refresh the page.")},document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[]);let w=(0,a.useCallback)(async()=>{console.log("Getting Plaid link token..."),g(!0),p(null);try{let e=await d.S.getPlaidLinkToken();console.log("Link token received:",e),h(e.link_token)}catch(s){console.error("Failed to get link token:",s);let e=s.message||"Failed to initialize Plaid Link";p(e),t(e)}finally{g(!1)}},[t]);(0,a.useEffect)(()=>{console.log("Plaid init check - linkToken:",!!u,"window.Plaid:",!!window.Plaid),u&&window.Plaid&&(console.log("Creating Plaid handler with token:",u),v(window.Plaid.create({token:u,env:x.env.NEXT_PUBLIC_PLAID_ENV||"sandbox",onSuccess:async(e,n)=>{y(!0);try{let t=await d.S.exchangePublicToken(e,n);s(t.accounts,t.institution_name)}catch(s){let e=s.message||"Failed to connect accounts";p(e),t(e)}finally{y(!1)}},onExit:(e,s)=>{if(null!=e){let s=e.error_message||"Connection cancelled";p(s),t(s)}y(!1)},onEvent:(e,s)=>{console.log("Plaid Link event:",e,s)}})))},[u,s,t]),(0,a.useEffect)(()=>()=>{b&&b.destroy()},[b]),(0,a.useEffect)(()=>{w()},[w]);let k=async()=>{if(!u){await w();return}if(!window.Plaid){p("Plaid is still loading. Please try again in a moment.");return}b?b.open():(p("Initializing Plaid Link..."),await w())},S=c||j||f||!window.Plaid;return(0,n.jsxs)("div",{className:"space-y-2 ".concat(l),children:[(0,n.jsxs)(i.z,{onClick:k,disabled:S,className:"w-full",size:"lg",children:[j?(0,n.jsx)(r.gb,{size:"sm",className:"mr-2"}):f?(0,n.jsx)(r.gb,{size:"sm",className:"mr-2"}):(0,n.jsx)(o.Z,{className:"w-5 h-5 mr-2"}),j?"Initializing...":f?"Connecting...":"Connect Bank Account"]}),N&&(0,n.jsxs)("div",{className:"flex items-center text-sm text-error-600 bg-error-50 p-2 rounded-md",children:[(0,n.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),N]}),!window.Plaid&&!j&&(0,n.jsx)("div",{className:"text-xs text-muted-foreground text-center",children:"Loading Plaid Link..."})]})}var h=t(72196),j=t(45249),g=t(2389);let f=(0,g.Z)("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),y=(0,g.Z)("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);var N=t(88623),p=t(62441),b=t(97066),v=t(81629);function w(e){let{accounts:s,onSync:t,isSyncing:a}=e,c=s.filter(e=>e.is_active),l=s.filter(e=>!e.is_active),r=[...new Set(s.filter(e=>e.institution_id).map(e=>e.institution_id))],d=s.reduce((e,s)=>"credit"===s.type?e-Math.abs(s.balance_current):e+s.balance_current,0),x=s.filter(e=>e.last_synced_at).map(e=>new Date(e.last_synced_at)).sort((e,s)=>s.getTime()-e.getTime()),u=x.length>0?x[0]:null,g=0===s.length?{status:"none",message:"No accounts connected",icon:f,color:"text-muted-foreground"}:l.length>0?{status:"partial",message:"".concat(l.length," account").concat(l.length>1?"s":""," need attention"),icon:m.Z,color:"text-warning-600"}:{status:"connected",message:"All accounts connected",icon:y,color:"text-success-600"},w=g.icon;return(0,n.jsxs)(h.Zb,{children:[(0,n.jsx)(h.Ol,{className:"pb-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(h.ll,{className:"text-lg",children:"Connection Overview"}),(0,n.jsxs)(i.z,{variant:"outline",size:"sm",onClick:t,disabled:a||0===s.length,className:"h-8",children:[(0,n.jsx)(N.Z,{className:"h-3 w-3 mr-1.5 ".concat(a?"animate-spin":"")}),a?"Syncing...":"Sync All"]})]})}),(0,n.jsxs)(h.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-neutral-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(w,{className:"h-4 w-4 ".concat(g.color)}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Connection Status"})]}),(0,n.jsx)("span",{className:"text-sm ".concat(g.color),children:g.message})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,n.jsxs)("div",{className:"text-center p-3 bg-primary-50 rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-center justify-center mb-1",children:(0,n.jsx)(p.Z,{className:"h-4 w-4 text-primary-600"})}),(0,n.jsx)("div",{className:"text-lg font-semibold text-primary-900",children:r.length}),(0,n.jsxs)("div",{className:"text-xs text-primary-600",children:["Institution",1!==r.length?"s":""]})]}),(0,n.jsxs)("div",{className:"text-center p-3 bg-success-50 rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-center justify-center mb-1",children:(0,n.jsx)(b.Z,{className:"h-4 w-4 text-success-600"})}),(0,n.jsx)("div",{className:"text-lg font-semibold text-success-900",children:c.length}),(0,n.jsx)("div",{className:"text-xs text-success-600",children:"Active"})]}),(0,n.jsxs)("div",{className:"text-center p-3 bg-neutral-50 rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-center justify-center mb-1",children:(0,n.jsx)(o.Z,{className:"h-4 w-4 text-neutral-600"})}),(0,n.jsx)("div",{className:"text-lg font-semibold text-neutral-900",children:s.length}),(0,n.jsx)("div",{className:"text-xs text-neutral-600",children:"Total"})]})]}),s.length>0&&(0,n.jsx)("div",{className:"p-3 border rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Balance"}),(0,n.jsx)("span",{className:"text-lg font-semibold ".concat(d>=0?"text-success-600":"text-error-600"),children:(0,j.xG)(d)})]})}),u&&(0,n.jsxs)("div",{className:"text-xs text-muted-foreground text-center border-t pt-3",children:["Last synced: ",(0,v.WU)(u,"MMM dd, yyyy 'at' h:mm a")]}),l.length>0&&(0,n.jsx)("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,n.jsx)(m.Z,{className:"h-4 w-4 text-warning-600 mt-0.5"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-warning-800",children:"Connection Issues Detected"}),(0,n.jsxs)("p",{className:"text-xs text-warning-700 mt-1",children:[l.length," account",l.length>1?"s are":" is"," inactive and may need to be reconnected."]}),(0,n.jsxs)("div",{className:"mt-2 text-xs",children:[l.slice(0,3).map(e=>(0,n.jsxs)("div",{className:"text-warning-600",children:["• ",e.name]},e.id)),l.length>3&&(0,n.jsxs)("div",{className:"text-warning-600",children:["• And ",l.length-3," more..."]})]})]})]})})]})]})}var k=t(38333),S=t(70844),_=t(10997),P=t(3172);let C=(0,g.Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);var Z=t(77930),A=t(31988),z=t(15969),L=t(39912);function M(e){var s,t,c;let{account:l,institution:d,onRemove:o,onSync:x,isRemoving:u,isSyncing:g}=e,[f,y]=(0,a.useState)(!0),v=l.last_synced_at?new Date(l.last_synced_at).toLocaleDateString():"Never";return(0,n.jsxs)(h.Zb,{className:"transition-shadow hover:shadow-md",children:[(0,n.jsx)(h.Ol,{className:"pb-4",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(null==d?void 0:d.logo)?(0,n.jsx)("img",{src:d.logo,alt:d.name,className:"w-8 h-8 rounded"}):(0,n.jsx)(p.Z,{className:"w-8 h-8 text-muted-foreground"}),(0,n.jsxs)("div",{children:[(0,n.jsx)(h.ll,{className:"text-lg",children:l.name}),(0,n.jsxs)(h.SZ,{className:"text-sm",children:[(s=l.type,(t=l.subtype)?"".concat(s.charAt(0).toUpperCase()+s.slice(1)," - ").concat(t):s.charAt(0).toUpperCase()+s.slice(1)),l.mask&&" •••• ".concat(l.mask)]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>y(!f),children:f?(0,n.jsx)(k.Z,{className:"w-4 h-4"}):(0,n.jsx)(S.Z,{className:"w-4 h-4"})}),(0,n.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>x(l.id),disabled:g,children:g?(0,n.jsx)(r.gb,{size:"sm"}):(0,n.jsx)(N.Z,{className:"w-4 h-4"})}),(0,n.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>o(l.id),disabled:u,children:u?(0,n.jsx)(r.gb,{size:"sm"}):(0,n.jsx)(_.Z,{className:"w-4 h-4 text-error-600"})})]})]})}),(0,n.jsx)(h.aY,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"Current Balance"}),(0,n.jsx)("span",{className:"font-semibold ".concat((c=l.balance_current,"credit"===l.type?c<0?"text-success-600":"text-error-600":c>=0?"text-success-600":"text-error-600")),children:f?(0,j.xG)(l.balance_current):"••••••"})]}),void 0!==l.balance_available&&l.balance_available!==l.balance_current&&(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"Available Balance"}),(0,n.jsx)("span",{className:"font-semibold",children:f?(0,j.xG)(l.balance_available):"••••••"})]}),l.balance_limit&&(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"Credit Limit"}),(0,n.jsx)("span",{className:"font-semibold",children:f?(0,j.xG)(l.balance_limit):"••••••"})]}),(0,n.jsxs)("div",{className:"pt-2 border-t",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,n.jsx)("div",{className:"flex items-center space-x-1",children:l.is_active?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.Z,{className:"w-3 h-3 text-success-600"}),(0,n.jsx)("span",{children:"Active"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{className:"w-3 h-3 text-error-600"}),(0,n.jsx)("span",{children:"Inactive"})]})}),(0,n.jsxs)("span",{children:["Last synced: ",v]})]}),d&&(0,n.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Institution: ",d.name]})]})]})})]})}var F=function(){let[e,s]=(0,a.useState)(!1),[t,x]=(0,a.useState)(new Set),[g,f]=(0,a.useState)(new Set),y=(0,Z.NL)(),{data:v=[],isLoading:k,error:S,refetch:_}=(0,A.a)({queryKey:["accounts"],queryFn:d.S.getAccounts}),F=[...new Set(v.filter(e=>e.institution_id).map(e=>e.institution_id))],{data:T=[],isLoading:E}=(0,A.a)({queryKey:["institutions",F],queryFn:async()=>(await Promise.allSettled(F.map(e=>d.S.getInstitution(e)))).filter(e=>"fulfilled"===e.status).map(e=>e.value),enabled:F.length>0}),O=(0,z.D)({mutationFn:d.S.syncTransactions,onSuccess:()=>{y.invalidateQueries({queryKey:["accounts"]}),y.invalidateQueries({queryKey:["transactions"]})}}),q=(0,z.D)({mutationFn:d.S.deleteAccount,onSuccess:()=>{y.invalidateQueries({queryKey:["accounts"]})}}),I=(0,L.PM)(),Y=(0,L.cM)(),B=async e=>{x(s=>new Set(s).add(e));try{await O.mutateAsync([e]),I("Account Synced","Account balance and transactions updated successfully")}catch(e){console.error("Sync error:",e),Y("Sync Failed",e.message||"Failed to sync account")}finally{x(s=>{let t=new Set(s);return t.delete(e),t})}},D=async e=>{if(confirm("Are you sure you want to remove this account? This action cannot be undone.")){f(s=>new Set(s).add(e));try{await q.mutateAsync(e),I("Account Removed","Account has been successfully disconnected")}catch(e){console.error("Remove error:",e),Y("Remove Failed",e.message||"Failed to remove account")}finally{f(s=>{let t=new Set(s);return t.delete(e),t})}}},K=async()=>{try{let e=await O.mutateAsync(void 0);I("All Accounts Synced","Updated ".concat(e.synced_count," accounts with ").concat(e.new_transactions," new transactions"))}catch(e){console.error("Sync all error:",e),Y("Sync Failed",e.message||"Failed to sync accounts")}},R=new Map(T.map(e=>[e.institution_id,e])),G=v.reduce((e,s)=>"credit"===s.type?e-Math.abs(s.balance_current):e+s.balance_current,0),U=v.filter(e=>e.is_active);return(0,n.jsxs)(c.c,{title:"Accounts",description:"Manage your connected bank accounts and financial institutions",children:[(0,n.jsx)(l,{}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:[(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(h.ll,{className:"text-sm font-medium",children:"Total Balance"}),(0,n.jsx)(o.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(h.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:(0,j.xG)(G)}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"Across all accounts"})]})]}),(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(h.ll,{className:"text-sm font-medium",children:"Connected Accounts"}),(0,n.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(h.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:v.length}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:[U.length," active"]})]})]}),(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(h.ll,{className:"text-sm font-medium",children:"Institutions"}),(0,n.jsx)(b.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(h.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:F.length}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"Connected banks"})]})]})]}),(0,n.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,n.jsxs)(i.z,{onClick:()=>s(!0),disabled:e,children:[(0,n.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Add Account"]}),(0,n.jsxs)(i.z,{variant:"outline",onClick:K,disabled:O.isPending,children:[O.isPending?(0,n.jsx)(r.gb,{size:"sm",className:"mr-2"}):(0,n.jsx)(C,{className:"w-4 h-4 mr-2"}),"Sync All"]}),(0,n.jsxs)(i.z,{variant:"outline",onClick:()=>_(),disabled:k,children:[(0,n.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(w,{accounts:v,onSync:K,isSyncing:O.isPending})}),e&&(0,n.jsxs)(h.Zb,{className:"mb-6",children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{children:"Connect Bank Account"}),(0,n.jsx)(h.SZ,{children:"Use Plaid to securely connect your bank account and automatically import transactions"})]}),(0,n.jsx)(h.aY,{children:(0,n.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(u,{onSuccess:(e,t)=>{s(!1),y.invalidateQueries({queryKey:["accounts"]}),y.invalidateQueries({queryKey:["institutions"]}),I("Accounts Connected Successfully!","Successfully connected ".concat(e.length," accounts from ").concat(t))},onError:e=>{console.error("Plaid connection error:",e),Y("Connection Failed",e)}})}),(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>s(!1),children:"Cancel"})]})})]}),k&&(0,n.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,n.jsx)(r.gb,{size:"lg"}),(0,n.jsx)("span",{className:"ml-2",children:"Loading accounts..."})]}),S&&(0,n.jsx)(h.Zb,{children:(0,n.jsx)(h.aY,{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(m.Z,{className:"w-12 h-12 text-error-600 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Accounts"}),(0,n.jsx)("p",{className:"text-muted-foreground mb-4",children:S.message||"Failed to load accounts"}),(0,n.jsx)(i.z,{onClick:()=>_(),children:"Try Again"})]})})}),!k&&!S&&0===v.length&&(0,n.jsx)(h.Zb,{children:(0,n.jsx)(h.aY,{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(o.Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Accounts Connected"}),(0,n.jsx)("p",{className:"text-muted-foreground mb-4",children:"Connect your first bank account to get started with financial tracking"}),(0,n.jsxs)(i.z,{onClick:()=>s(!0),children:[(0,n.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Add Your First Account"]})]})})}),!k&&v.length>0&&(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:v.map(e=>(0,n.jsx)(M,{account:e,institution:R.get(e.institution_id||""),onRemove:D,onSync:B,isRemoving:g.has(e.id),isSyncing:t.has(e.id)},e.id))})]})}}},function(e){e.O(0,[351,293,528,744],function(){return e(e.s=80750)}),_N_E=e.O()}]);