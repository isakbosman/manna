(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{32903:function(e,s,t){Promise.resolve().then(t.bind(t,27826))},27826:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ei}});var a=t(27573),n=t(7653),i=t(72196),r=t(50466),l=t(49289),c=t(45249);let d=(0,l.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=n.forwardRef((e,s)=>{let{className:t,variant:n,...i}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,c.cn)(d({variant:n}),t),...i})});o.displayName="Alert";let h=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h5",{ref:s,className:(0,c.cn)("mb-1 font-medium leading-none tracking-tight",t),...n})});h.displayName="AlertTitle";let x=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,c.cn)("text-sm [&_p]:leading-relaxed",t),...n})});x.displayName="AlertDescription";var u=t(27751),m=t(38941),j=t(22927),p=t(88623),g=t(70548),v=t(23727),f=t(30609),y=t(20054),N=t(36673),w=t(31815),b=t(2389);let _=(0,b.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),k=(0,b.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var C=t(12439),S=t(18177),Z=t(44242),z=t(50188),E=t(25555),A=t(97066),M=t(81629);function P(e){let{tasks:s,onTaskComplete:t}=e,[i,l]=(0,n.useState)(new Set),{toast:c}=(0,Z.pm)(),d=async e=>{l(s=>new Set(s).add(e.id));try{switch(e.task_type){case"reconciliation":await o(e.account_id);break;case"categorization":await h(e);break;case"journal_entry":await x(e);break;case"period_closing":await u(e);break;default:c({title:"Task Started",description:"Processing ".concat(e.title)})}t()}catch(s){console.error("Error processing task:",s),c({title:"Error",description:"Failed to process ".concat(e.title),variant:"destructive"})}finally{l(s=>{let t=new Set(s);return t.delete(e.id),t})}},o=async e=>{if(!(await fetch("/api/v1/bookkeeping/reconciliation/start",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({account_id:e})})).ok)throw Error("Failed to start reconciliation");c({title:"Reconciliation Started",description:"Account reconciliation has been initiated"})},h=async e=>{c({title:"Opening Categorization Review",description:"".concat(e.transaction_count," transactions to review")}),window.location.href="/bookkeeping/categorization"},x=async e=>{c({title:"Opening Journal Entry",description:"Review and approve journal entry"}),window.location.href="/bookkeeping/journal/".concat(e.id)},u=async e=>{c({title:"Period Closing",description:"Opening period closing workflow"}),window.location.href="/bookkeeping/period-closing"},j=e=>{switch(e){case"high":return(0,a.jsx)(f.Z,{className:"h-4 w-4 text-red-600"});case"medium":return(0,a.jsx)(y.Z,{className:"h-4 w-4 text-yellow-600"});default:return(0,a.jsx)(E.Z,{className:"h-4 w-4 text-blue-600"})}},g=e=>{let s={high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-blue-100 text-blue-800"};return(0,a.jsx)(m.C,{className:s[e]||s.low,variant:"outline",children:e})},v=e=>{switch(e){case"reconciliation":return(0,a.jsx)(p.Z,{className:"h-4 w-4"});case"journal_entry":return(0,a.jsx)(N.Z,{className:"h-4 w-4"});case"categorization":return(0,a.jsx)(f.Z,{className:"h-4 w-4"});default:return(0,a.jsx)(E.Z,{className:"h-4 w-4"})}};return 0===s.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(A.Z,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"All caught up!"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"No pending bookkeeping tasks at this time."})]}):(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(z.iA,{children:[(0,a.jsx)(z.xD,{children:(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.ss,{children:"Priority"}),(0,a.jsx)(z.ss,{children:"Type"}),(0,a.jsx)(z.ss,{children:"Task"}),(0,a.jsx)(z.ss,{children:"Details"}),(0,a.jsx)(z.ss,{children:"Due Date"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Action"})]})}),(0,a.jsx)(z.RM,{children:s.map(e=>(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[j(e.priority),g(e.priority)]})}),(0,a.jsx)(z.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v(e.task_type),(0,a.jsx)("span",{className:"text-sm",children:e.task_type})]})}),(0,a.jsx)(z.pj,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]})}),(0,a.jsx)(z.pj,{children:(0,a.jsxs)("div",{className:"text-sm",children:[e.account_name&&(0,a.jsxs)("p",{children:["Account: ",e.account_name]}),e.transaction_count&&(0,a.jsxs)("p",{children:[e.transaction_count," transactions"]}),e.amount&&(0,a.jsxs)("p",{children:["$",e.amount.toLocaleString()]})]})}),(0,a.jsx)(z.pj,{children:e.due_date?(0,a.jsx)("span",{className:"text-sm",children:(0,M.WU)(new Date(e.due_date),"MMM d, yyyy")}):(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"No deadline"})}),(0,a.jsx)(z.pj,{className:"text-right",children:(0,a.jsx)(r.z,{size:"sm",onClick:()=>d(e),disabled:i.has(e.id),children:i.has(e.id)?(0,a.jsx)(p.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsxs)(a.Fragment,{children:["Process",(0,a.jsx)(k,{className:"h-4 w-4 ml-2"})]})})})]},e.id))})]})})}var R=t(39134),D=t(93125),F=t(50520),O=t(85745),T=t(36120),I=t(95731),B=t(79901),L=t(51733);function q(e){let{onReconciliationComplete:s}=e,[t,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(""),[o,h]=(0,n.useState)([]),[x,u]=(0,n.useState)(""),[j,g]=(0,n.useState)(""),[y,N]=(0,n.useState)(!1),[w,b]=(0,n.useState)(new Set),[_,k]=(0,n.useState)(""),{toast:C}=(0,Z.pm)();(0,n.useEffect)(()=>{E()},[]);let E=async()=>{try{let e=await fetch("/api/v1/accounts",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let s=await e.json();l(s.accounts||[])}}catch(e){console.error("Error fetching accounts:",e)}},A=async()=>{if(!c||!x||!j){C({title:"Missing Information",description:"Please select an account and enter statement details",variant:"destructive"});return}N(!0);try{let s=await fetch("/api/v1/bookkeeping/reconciliation/start",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({account_id:c,statement_balance:parseFloat(x),statement_date:j})});if(s.ok){var e;let t=await s.json();h(t.items||[]),C({title:"Reconciliation Started",description:"Found ".concat((null===(e=t.items)||void 0===e?void 0:e.length)||0," transactions to reconcile")})}else throw Error("Failed to start reconciliation")}catch(e){console.error("Error starting reconciliation:",e),C({title:"Error",description:"Failed to start reconciliation",variant:"destructive"})}finally{N(!1)}},P=async()=>{if(0===w.size){C({title:"No Items Selected",description:"Please select items to reconcile",variant:"destructive"});return}try{if((await fetch("/api/v1/bookkeeping/reconciliation/confirm",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({account_id:c,reconciled_item_ids:Array.from(w)})})).ok)C({title:"Reconciliation Complete",description:"Successfully reconciled ".concat(w.size," items")}),s(),h([]),b(new Set),u(""),g("");else throw Error("Failed to confirm reconciliation")}catch(e){console.error("Error confirming reconciliation:",e),C({title:"Error",description:"Failed to confirm reconciliation",variant:"destructive"})}},q=e=>{b(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},U=o.filter(e=>{var s;return""===_||e.statement_description.toLowerCase().includes(_.toLowerCase())||(null===(s=e.transaction)||void 0===s?void 0:s.description.toLowerCase().includes(_.toLowerCase()))}),Q=()=>{let e=o.filter(e=>w.has(e.id)).reduce((e,s)=>e+s.statement_amount,0);return(parseFloat(x)||0)-e};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Start Reconciliation"}),(0,a.jsx)(i.SZ,{children:"Select an account and enter your statement details"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Account"}),(0,a.jsxs)(O.Ph,{value:c,onValueChange:d,children:[(0,a.jsx)(O.i4,{children:(0,a.jsx)(O.ki,{placeholder:"Select account"})}),(0,a.jsx)(O.Bw,{children:t.map(e=>(0,a.jsx)(O.Ql,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{children:e.name}),e.unreconciled_transaction_count>0&&(0,a.jsxs)(m.C,{variant:"outline",className:"ml-2",children:[e.unreconciled_transaction_count," unreconciled"]})]})},e.id))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Statement Balance"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R.I,{type:"number",placeholder:"0.00",value:x,onChange:e=>u(e.target.value),className:"pl-9"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Statement Date"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(v.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R.I,{type:"date",value:j,onChange:e=>g(e.target.value),className:"pl-9"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.z,{onClick:A,disabled:y||!c,children:y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Starting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Start Reconciliation"]})}),(0,a.jsxs)(r.z,{variant:"outline",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4 mr-2"}),"Import Statement"]})]})]})]}),o.length>0&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{children:"Reconciliation Items"}),(0,a.jsx)(i.SZ,{children:"Review and match transactions with your statement"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(I.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R.I,{placeholder:"Search transactions...",value:_,onChange:e=>k(e.target.value),className:"pl-9 w-64"})]}),(0,a.jsx)(r.z,{variant:"outline",onClick:()=>{b(new Set(o.filter(e=>e.is_matched).map(e=>e.id)))},children:"Select Matched"})]})]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)(z.iA,{children:[(0,a.jsx)(z.xD,{children:(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.ss,{className:"w-12",children:(0,a.jsx)(F.X,{checked:w.size===U.length&&U.length>0,onCheckedChange:e=>{e?b(new Set(U.map(e=>e.id))):b(new Set)}})}),(0,a.jsx)(z.ss,{children:"Date"}),(0,a.jsx)(z.ss,{children:"Statement Description"}),(0,a.jsx)(z.ss,{children:"Matched Transaction"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Amount"}),(0,a.jsx)(z.ss,{children:"Status"}),(0,a.jsx)(z.ss,{children:"Confidence"})]})}),(0,a.jsx)(z.RM,{children:U.map(e=>(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{children:(0,a.jsx)(F.X,{checked:w.has(e.id),onCheckedChange:()=>q(e.id)})}),(0,a.jsx)(z.pj,{children:(0,M.WU)(new Date(e.statement_date),"MMM d, yyyy")}),(0,a.jsx)(z.pj,{children:e.statement_description}),(0,a.jsx)(z.pj,{children:e.transaction?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.transaction.description}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.transaction.category})]}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"No match found"})}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",Math.abs(e.statement_amount).toFixed(2)]}),(0,a.jsx)(z.pj,{children:e.is_matched?(0,a.jsxs)(m.C,{className:"bg-green-100 text-green-800",children:[(0,a.jsx)(B.Z,{className:"h-3 w-3 mr-1"}),"Matched"]}):(0,a.jsxs)(m.C,{variant:"outline",children:[(0,a.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Unmatched"]})}),(0,a.jsx)(z.pj,{children:e.match_confidence&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(100*e.match_confidence,"%")}})}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Math.round(100*e.match_confidence),"%"]})]})})]},e.id))})]}),(0,a.jsx)("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Selected Items"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[w.size," of ",o.length]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Discrepancy"}),(0,a.jsxs)("p",{className:"text-2xl font-bold ".concat(.01>Math.abs(Q())?"text-green-600":"text-red-600"),children:["$",Q().toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",children:[(0,a.jsx)(L.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(r.z,{onClick:P,disabled:0===w.size,children:[(0,a.jsx)(B.Z,{className:"h-4 w-4 mr-2"}),"Confirm Reconciliation"]})]})]})})]})]})]})}var U=t(36733),Q=t(29324),J=t(10269),$=t(87354),V=t(3172),Y=t(69790),W=t(38333),X=t(34915),G=t(51856),H=t(10997);let K=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});function ee(e){let{isOpen:s,onClose:t,onSave:i,entry:l}=e,[c,d]=(0,n.useState)({entry_date:(0,M.WU)(new Date,"yyyy-MM-dd"),description:"",reference:"",journal_type:"general",lines:[{account_id:"",debit_amount:0,credit_amount:0,description:""},{account_id:"",debit_amount:0,credit_amount:0,description:""}]}),[h,u]=(0,n.useState)([]),[m,j]=(0,n.useState)(!1),{toast:p}=(0,Z.pm)();(0,n.useEffect)(()=>{l&&d(l),g()},[l]);let g=async()=>{try{let e=await fetch("/api/v1/bookkeeping/chart-of-accounts",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let s=await e.json();u(s.accounts||[])}}catch(e){console.error("Error fetching accounts:",e)}},v=e=>{if(c.lines.length<=2){p({title:"Minimum Lines Required",description:"A journal entry must have at least 2 lines",variant:"destructive"});return}d(s=>({...s,lines:s.lines.filter((s,t)=>t!==e)}))},y=(e,s,t)=>{d(a=>({...a,lines:a.lines.map((a,n)=>{if(n===e){let e={...a,[s]:t};if("debit_amount"===s&&t>0?e.credit_amount=0:"credit_amount"===s&&t>0&&(e.debit_amount=0),"account_id"===s){let s=h.find(e=>e.id===t);s&&(e.account_code=s.account_code,e.account_name=s.account_name)}return e}return a})}))},N=()=>{let e=c.lines.reduce((e,s)=>e+(s.debit_amount||0),0),s=c.lines.reduce((e,s)=>e+(s.credit_amount||0),0);return{totalDebits:e,totalCredits:s,difference:e-s}},w=()=>{let{totalDebits:e,totalCredits:s}=N();return!(Math.abs(e-s)>.01)&&!!c.entry_date&&!!c.description&&c.lines.every(e=>e.account_id&&(e.debit_amount>0||e.credit_amount>0))},b=async()=>{if(!w()){p({title:"Invalid Entry",description:"Please ensure debits equal credits and all required fields are filled",variant:"destructive"});return}j(!0);try{let e=(null==l?void 0:l.id)?"/api/v1/bookkeeping/journal-entries/".concat(l.id):"/api/v1/bookkeeping/journal-entries",s=(null==l?void 0:l.id)?"PUT":"POST";if((await fetch(e,{method:s,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify(c)})).ok)p({title:"Success",description:(null==l?void 0:l.id)?"Journal entry updated":"Journal entry created"}),i(c);else throw Error("Failed to save journal entry")}catch(e){console.error("Error saving journal entry:",e),p({title:"Error",description:"Failed to save journal entry",variant:"destructive"})}finally{j(!1)}},{totalDebits:_,totalCredits:k,difference:C}=N();return(0,a.jsx)(Q.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(Q.cZ,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(Q.fK,{children:[(0,a.jsxs)(Q.$N,{children:[(null==l?void 0:l.id)?"Edit":"Create"," Journal Entry"]}),(0,a.jsx)(Q.Be,{children:"Record a double-entry bookkeeping transaction. Debits must equal credits."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Entry Date"}),(0,a.jsx)(R.I,{type:"date",value:c.entry_date,onChange:e=>d(s=>({...s,entry_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Journal Type"}),(0,a.jsxs)(O.Ph,{value:c.journal_type,onValueChange:e=>d(s=>({...s,journal_type:e})),children:[(0,a.jsx)(O.i4,{children:(0,a.jsx)(O.ki,{})}),(0,a.jsxs)(O.Bw,{children:[(0,a.jsx)(O.Ql,{value:"general",children:"General"}),(0,a.jsx)(O.Ql,{value:"sales",children:"Sales"}),(0,a.jsx)(O.Ql,{value:"purchase",children:"Purchase"}),(0,a.jsx)(O.Ql,{value:"cash_receipts",children:"Cash Receipts"}),(0,a.jsx)(O.Ql,{value:"cash_disbursements",children:"Cash Disbursements"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Description"}),(0,a.jsx)(K,{placeholder:"Enter journal entry description",value:c.description,onChange:e=>d(s=>({...s,description:e.target.value})),rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Reference (Optional)"}),(0,a.jsx)(R.I,{placeholder:"Invoice #, Check #, etc.",value:c.reference,onChange:e=>d(s=>({...s,reference:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)(D._,{children:"Entry Lines"}),(0,a.jsxs)(r.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{d(e=>({...e,lines:[...e.lines,{account_id:"",debit_amount:0,credit_amount:0,description:""}]}))},children:[(0,a.jsx)(V.Z,{className:"h-4 w-4 mr-2"}),"Add Line"]})]}),(0,a.jsxs)(z.iA,{children:[(0,a.jsx)(z.xD,{children:(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.ss,{children:"Account"}),(0,a.jsx)(z.ss,{children:"Description"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Debit"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Credit"}),(0,a.jsx)(z.ss,{className:"w-10"})]})}),(0,a.jsxs)(z.RM,{children:[c.lines.map((e,s)=>(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{children:(0,a.jsxs)(O.Ph,{value:e.account_id,onValueChange:e=>y(s,"account_id",e),children:[(0,a.jsx)(O.i4,{children:(0,a.jsx)(O.ki,{placeholder:"Select account"})}),(0,a.jsx)(O.Bw,{children:h.map(e=>(0,a.jsxs)(O.Ql,{value:e.id,children:[e.account_code," - ",e.account_name]},e.id))})]})}),(0,a.jsx)(z.pj,{children:(0,a.jsx)(R.I,{placeholder:"Line description",value:e.description,onChange:e=>y(s,"description",e.target.value)})}),(0,a.jsx)(z.pj,{children:(0,a.jsx)(R.I,{type:"number",step:"0.01",placeholder:"0.00",value:e.debit_amount||"",onChange:e=>y(s,"debit_amount",parseFloat(e.target.value)||0),className:"text-right"})}),(0,a.jsx)(z.pj,{children:(0,a.jsx)(R.I,{type:"number",step:"0.01",placeholder:"0.00",value:e.credit_amount||"",onChange:e=>y(s,"credit_amount",parseFloat(e.target.value)||0),className:"text-right"})}),(0,a.jsx)(z.pj,{children:(0,a.jsx)(r.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>v(s),disabled:c.lines.length<=2,children:(0,a.jsx)(H.Z,{className:"h-4 w-4"})})})]},s)),(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{colSpan:2,className:"font-medium",children:"Total"}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",_.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",k.toFixed(2)]}),(0,a.jsx)(z.pj,{})]})]})]})]}),Math.abs(C)>.01&&(0,a.jsxs)(o,{variant:"destructive",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsxs)(x,{children:["Entry is not balanced. Difference: $",Math.abs(C).toFixed(2)]})]}),.01>=Math.abs(C)&&_>0&&(0,a.jsxs)(o,{children:[(0,a.jsx)($.Z,{className:"h-4 w-4"}),(0,a.jsx)(x,{className:"text-green-600",children:"Entry is balanced. Ready to save."})]})]}),(0,a.jsxs)(Q.cN,{children:[(0,a.jsx)(r.z,{variant:"outline",onClick:t,disabled:m,children:"Cancel"}),(0,a.jsx)(r.z,{onClick:b,disabled:!w()||m,children:m?"Saving...":"Save Entry"})]})]})})}function es(){let[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!0),[c,d]=(0,n.useState)(""),[o,h]=(0,n.useState)("all"),[x,u]=(0,n.useState)("all"),[j,p]=(0,n.useState)(null),[g,v]=(0,n.useState)(!1),[f,y]=(0,n.useState)(null),{toast:N}=(0,Z.pm)();(0,n.useEffect)(()=>{w()},[]);let w=async()=>{try{let e=await fetch("/api/v1/bookkeeping/journal-entries",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let t=await e.json();s(t.entries||[])}}catch(e){console.error("Error fetching journal entries:",e),N({title:"Error",description:"Failed to fetch journal entries",variant:"destructive"})}finally{l(!1)}},b=async e=>{try{if((await fetch("/api/v1/bookkeeping/journal-entries/".concat(e,"/post"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).ok)N({title:"Entry Posted",description:"Journal entry has been posted successfully"}),w();else throw Error("Failed to post entry")}catch(e){console.error("Error posting entry:",e),N({title:"Error",description:"Failed to post journal entry",variant:"destructive"})}},_=async e=>{if(confirm("Are you sure you want to delete this journal entry?"))try{if((await fetch("/api/v1/bookkeeping/journal-entries/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).ok)N({title:"Entry Deleted",description:"Journal entry has been deleted"}),w();else throw Error("Failed to delete entry")}catch(e){console.error("Error deleting entry:",e),N({title:"Error",description:"Failed to delete journal entry",variant:"destructive"})}},k=async e=>{y({...e,id:void 0,entry_number:void 0,is_posted:!1,posting_date:null,created_at:void 0}),v(!0)},C=e.filter(e=>{let s=""===c||e.entry_number.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase())||e.reference&&e.reference.toLowerCase().includes(c.toLowerCase()),t="all"===o||e.journal_type===o,a="all"===x||"posted"===x&&e.is_posted||"unposted"===x&&!e.is_posted||"unbalanced"===x&&!e.is_balanced;return s&&t&&a}),S=e=>e.is_balanced?e.is_posted?(0,a.jsxs)(m.C,{className:"bg-green-100 text-green-800",children:[(0,a.jsx)($.Z,{className:"h-3 w-3 mr-1"}),"Posted"]}):(0,a.jsx)(m.C,{variant:"outline",children:"Unposted"}):(0,a.jsxs)(m.C,{variant:"destructive",children:[(0,a.jsx)(J.Z,{className:"h-3 w-3 mr-1"}),"Unbalanced"]}),E=e=>e?(0,a.jsx)(m.C,{className:{plaid_sync:"bg-blue-100 text-blue-800",manual:"bg-gray-100 text-gray-800",recurring:"bg-purple-100 text-purple-800",adjustment:"bg-yellow-100 text-yellow-800"}[e]||"bg-gray-100 text-gray-800",variant:"outline",children:e}):null;return t?(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"flex items-center justify-center h-96",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading journal entries..."})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{children:"Journal Entries"}),(0,a.jsx)(i.SZ,{children:"Manage and review double-entry bookkeeping records"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>{let s=new Blob([e.map(e=>"".concat(e.entry_number,",").concat(e.entry_date,",").concat(e.description,",").concat(e.total_debits,",").concat(e.total_credits)).join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="journal_entries_".concat((0,M.WU)(new Date,"yyyy-MM-dd"),".csv"),a.click()},children:[(0,a.jsx)(L.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,a.jsxs)(r.z,{onClick:()=>v(!0),children:[(0,a.jsx)(V.Z,{className:"h-4 w-4 mr-2"}),"New Entry"]})]})]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(I.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(R.I,{placeholder:"Search entries...",value:c,onChange:e=>d(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(O.Ph,{value:o,onValueChange:h,children:[(0,a.jsx)(O.i4,{className:"w-40",children:(0,a.jsx)(O.ki,{placeholder:"Filter by type"})}),(0,a.jsxs)(O.Bw,{children:[(0,a.jsx)(O.Ql,{value:"all",children:"All Types"}),(0,a.jsx)(O.Ql,{value:"general",children:"General"}),(0,a.jsx)(O.Ql,{value:"sales",children:"Sales"}),(0,a.jsx)(O.Ql,{value:"purchase",children:"Purchase"}),(0,a.jsx)(O.Ql,{value:"cash_receipts",children:"Cash Receipts"}),(0,a.jsx)(O.Ql,{value:"cash_disbursements",children:"Cash Disbursements"})]})]}),(0,a.jsxs)(O.Ph,{value:x,onValueChange:u,children:[(0,a.jsx)(O.i4,{className:"w-40",children:(0,a.jsx)(O.ki,{placeholder:"Filter by status"})}),(0,a.jsxs)(O.Bw,{children:[(0,a.jsx)(O.Ql,{value:"all",children:"All Status"}),(0,a.jsx)(O.Ql,{value:"posted",children:"Posted"}),(0,a.jsx)(O.Ql,{value:"unposted",children:"Unposted"}),(0,a.jsx)(O.Ql,{value:"unbalanced",children:"Unbalanced"})]})]})]}),(0,a.jsxs)(z.iA,{children:[(0,a.jsx)(z.xD,{children:(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.ss,{children:"Entry #"}),(0,a.jsx)(z.ss,{children:"Date"}),(0,a.jsx)(z.ss,{children:"Description"}),(0,a.jsx)(z.ss,{children:"Reference"}),(0,a.jsx)(z.ss,{children:"Type"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Debits"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Credits"}),(0,a.jsx)(z.ss,{children:"Status"}),(0,a.jsx)(z.ss,{children:"Source"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(z.RM,{children:C.map(e=>(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{className:"font-medium",children:e.entry_number}),(0,a.jsx)(z.pj,{children:(0,M.WU)(new Date(e.entry_date),"MMM d, yyyy")}),(0,a.jsx)(z.pj,{className:"max-w-xs truncate",children:e.description}),(0,a.jsx)(z.pj,{children:e.reference||"-"}),(0,a.jsx)(z.pj,{children:e.journal_type||"General"}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",e.total_debits.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right",children:["$",e.total_credits.toFixed(2)]}),(0,a.jsx)(z.pj,{children:S(e)}),(0,a.jsx)(z.pj,{children:E(e.source_type)}),(0,a.jsx)(z.pj,{className:"text-right",children:(0,a.jsxs)(U.h_,{children:[(0,a.jsx)(U.$F,{asChild:!0,children:(0,a.jsx)(r.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(Y.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(U.AW,{align:"end",children:[(0,a.jsx)(U.Ju,{children:"Actions"}),(0,a.jsxs)(U.Xi,{onClick:()=>p(e),children:[(0,a.jsx)(W.Z,{className:"h-4 w-4 mr-2"}),"View Details"]}),!e.is_posted&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(U.Xi,{onClick:()=>{y(e),v(!0)},children:[(0,a.jsx)(X.Z,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,a.jsxs)(U.Xi,{onClick:()=>b(e.id),children:[(0,a.jsx)($.Z,{className:"h-4 w-4 mr-2"}),"Post Entry"]})]}),(0,a.jsxs)(U.Xi,{onClick:()=>k(e),children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 mr-2"}),"Duplicate"]}),(0,a.jsx)(U.VD,{}),!e.is_posted&&(0,a.jsxs)(U.Xi,{onClick:()=>_(e.id),className:"text-red-600",children:[(0,a.jsx)(H.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))})]})]})]}),j&&(0,a.jsx)(Q.Vq,{open:!!j,onOpenChange:()=>p(null),children:(0,a.jsxs)(Q.cZ,{className:"max-w-3xl",children:[(0,a.jsxs)(Q.fK,{children:[(0,a.jsxs)(Q.$N,{children:["Journal Entry #",j.entry_number]}),(0,a.jsx)(Q.Be,{children:j.description})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Date:"})," ",(0,M.WU)(new Date(j.entry_date),"MMM d, yyyy")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Reference:"})," ",j.reference||"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Type:"})," ",j.journal_type||"General"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Status:"})," ",j.is_posted?"Posted":"Unposted"]})]}),(0,a.jsxs)(z.iA,{children:[(0,a.jsx)(z.xD,{children:(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.ss,{children:"Account"}),(0,a.jsx)(z.ss,{children:"Description"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Debit"}),(0,a.jsx)(z.ss,{className:"text-right",children:"Credit"})]})}),(0,a.jsxs)(z.RM,{children:[j.lines.map(e=>(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.account_code}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.account_name})]})}),(0,a.jsx)(z.pj,{children:e.description||"-"}),(0,a.jsx)(z.pj,{className:"text-right",children:e.debit_amount>0?"$".concat(e.debit_amount.toFixed(2)):"-"}),(0,a.jsx)(z.pj,{className:"text-right",children:e.credit_amount>0?"$".concat(e.credit_amount.toFixed(2)):"-"})]},e.id)),(0,a.jsxs)(z.SC,{children:[(0,a.jsx)(z.pj,{colSpan:2,className:"font-medium",children:"Total"}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",j.total_debits.toFixed(2)]}),(0,a.jsxs)(z.pj,{className:"text-right font-medium",children:["$",j.total_credits.toFixed(2)]})]})]})]})]})]})}),g&&(0,a.jsx)(ee,{isOpen:g,onClose:()=>{v(!1),y(null)},onSave:()=>{v(!1),y(null),w()},entry:f})]})}function et(e){let{isOpen:s,onClose:t,onPeriodClosed:i}=e,[l,c]=(0,n.useState)(""),[d,u]=(0,n.useState)([]),[g,N]=(0,n.useState)([]),[w,b]=(0,n.useState)(!1),[_,C]=(0,n.useState)(0),[S,z]=(0,n.useState)(!1),{toast:E}=(0,Z.pm)();(0,n.useEffect)(()=>{s&&(A(),P())},[s]);let A=async()=>{try{let s=await fetch("/api/v1/bookkeeping/periods",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(s.ok){var e;let t=await s.json();u((null===(e=t.periods)||void 0===e?void 0:e.filter(e=>!e.is_closed))||[])}}catch(e){console.error("Error fetching periods:",e)}},P=()=>{N([{id:"reconciliation",task:"Complete All Bank Reconciliations",status:"pending",required:!0,description:"Ensure all bank and credit card accounts are reconciled",warning:"3 accounts remain unreconciled"},{id:"categorization",task:"Review and Categorize All Transactions",status:"pending",required:!0,description:"All transactions must be properly categorized for accurate reporting",warning:"15 transactions need categorization"},{id:"journal_entries",task:"Post All Journal Entries",status:"pending",required:!0,description:"All journal entries must be reviewed and posted",warning:"2 unposted journal entries"},{id:"accruals",task:"Record Accruals and Deferrals",status:"pending",required:!1,description:"Record any necessary accrued expenses or deferred revenue"},{id:"depreciation",task:"Calculate and Record Depreciation",status:"pending",required:!1,description:"Record depreciation for fixed assets"},{id:"inventory",task:"Adjust Inventory Balances",status:"pending",required:!1,description:"Record inventory adjustments if applicable"},{id:"trial_balance",task:"Review Trial Balance",status:"pending",required:!0,description:"Ensure trial balance is balanced and accounts are accurate"},{id:"reports",task:"Generate Financial Reports",status:"pending",required:!0,description:"Generate P&L, Balance Sheet, and Cash Flow statements"},{id:"backup",task:"Create Period Backup",status:"pending",required:!0,description:"Create a backup of all financial data for the period"}])},R=async()=>{b(!0);for(let e=0;e<g.length;e++){let s=g[e];if(C(e),N(e=>e.map(e=>e.id===s.id?{...e,status:"in_progress"}:e)),await new Promise(e=>setTimeout(e,1500)),s.warning&&Math.random()>.7&&s.required){N(e=>e.map(e=>e.id===s.id?{...e,status:"failed"}:e)),b(!1),E({title:"Period Closing Failed",description:"Failed at step: ".concat(s.task,". ").concat(s.warning),variant:"destructive"});return}N(e=>e.map(e=>e.id===s.id?{...e,status:"completed"}:e))}await T()},T=async()=>{try{if((await fetch("/api/v1/bookkeeping/periods/close",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({period_id:l})})).ok)E({title:"Period Closed Successfully",description:"The accounting period has been closed and locked"}),i(),t();else throw Error("Failed to close period")}catch(e){console.error("Error closing period:",e),E({title:"Error",description:"Failed to close the period",variant:"destructive"})}finally{b(!1)}},I=e=>{switch(e){case"completed":return(0,a.jsx)(B.Z,{className:"h-4 w-4 text-green-600"});case"in_progress":return(0,a.jsx)(p.Z,{className:"h-4 w-4 text-blue-600 animate-spin"});case"failed":return(0,a.jsx)(f.Z,{className:"h-4 w-4 text-red-600"});default:return(0,a.jsx)(v.Z,{className:"h-4 w-4 text-gray-400"})}};return(0,a.jsx)(Q.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(Q.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(Q.fK,{children:[(0,a.jsx)(Q.$N,{children:"Close Accounting Period"}),(0,a.jsx)(Q.Be,{children:"Complete all required tasks before closing the period. Once closed, the period will be locked and no changes can be made."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{children:"Select Period to Close"}),(0,a.jsxs)(O.Ph,{value:l,onValueChange:c,children:[(0,a.jsx)(O.i4,{children:(0,a.jsx)(O.ki,{placeholder:"Select accounting period"})}),(0,a.jsx)(O.Bw,{children:d.map(e=>(0,a.jsx)(O.Ql,{value:e.id,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.period_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,M.WU)(new Date(e.start_date),"MMM d")," - ",(0,M.WU)(new Date(e.end_date),"MMM d, yyyy")]})]})},e.id))})]})]}),w&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Closing Progress"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Math.round(g.filter(e=>"completed"===e.status).length/g.length*100),"%"]})]}),(0,a.jsx)(j.E,{value:g.filter(e=>"completed"===e.status).length/g.length*100})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D._,{className:"mb-2",children:"Period Closing Checklist"}),(0,a.jsx)("div",{className:"space-y-2 border rounded-lg p-4",children:g.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded ".concat(s===_&&w?"bg-blue-50":""),children:[I(e.status),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium ".concat("completed"===e.status?"line-through text-muted-foreground":""),children:e.task}),e.required&&(0,a.jsx)(m.C,{variant:"outline",className:"text-xs",children:"Required"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.warning&&"pending"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,a.jsx)(y.Z,{className:"h-3 w-3 text-yellow-600"}),(0,a.jsx)("span",{className:"text-xs text-yellow-600",children:e.warning})]})]})]},e.id))})]}),(0,a.jsxs)(o,{children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)(h,{children:"Important Notice"}),(0,a.jsx)(x,{children:"Closing a period is irreversible. Once closed, you cannot make any changes to transactions or journal entries within this period. Please ensure all data is accurate before proceeding."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.X,{checked:S,onCheckedChange:e=>z(e),disabled:w}),(0,a.jsx)(D._,{className:"text-sm",children:"I confirm that all financial data for this period is accurate and complete"})]})]}),(0,a.jsxs)(Q.cN,{children:[(0,a.jsx)(r.z,{variant:"outline",onClick:t,disabled:w,children:"Cancel"}),(0,a.jsx)(r.z,{onClick:R,disabled:!l||!S||w,children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Closing Period..."]}):(0,a.jsxs)(a.Fragment,{children:["Close Period",(0,a.jsx)(k,{className:"h-4 w-4 ml-2"})]})})]})]})})}function ea(e){let{health:s}=e,t=(e,s)=>0===e?"text-green-600":e<=s/2?"text-yellow-600":e<=s?"text-orange-600":"text-red-600",n=Math.max(0,Math.min(100,100-5*s.unreconciled_accounts-2*s.pending_journal_entries-3*s.days_behind_reconciliation-(100-s.ml_categorization_accuracy)*.5));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Overall Health Score"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[n,"%"]})]}),(0,a.jsx)(j.E,{value:n,className:n<50?"bg-red-100":n<75?"bg-yellow-100":"bg-green-100"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(_,{className:"h-4 w-4 ".concat(t(s.unreconciled_accounts,5))}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Unreconciled"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.unreconciled_accounts}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"accounts"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 ".concat(t(s.pending_journal_entries,10))}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Pending"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.pending_journal_entries}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"journal entries"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(E.Z,{className:"h-4 w-4 ".concat(t(s.days_behind_reconciliation,7))}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Days Behind"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.days_behind_reconciliation}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"reconciliation"})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 ".concat(s.ml_categorization_accuracy>=90?"text-green-600":s.ml_categorization_accuracy>=75?"text-yellow-600":"text-red-600")}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"ML Accuracy"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[s.ml_categorization_accuracy,"%"]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"categorization"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[s.unreconciled_accounts>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-yellow-600"}),(0,a.jsxs)("span",{children:[s.unreconciled_accounts," accounts need reconciliation"]})]}),s.pending_categorizations>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("span",{children:[s.pending_categorizations," transactions pending categorization"]})]}),"healthy"===s.status&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(B.Z,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{children:"All systems operating normally"})]})]})]})}function en(){let[e,s]=(0,n.useState)(null),[t,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0),[b,z]=(0,n.useState)("overview"),[E,A]=(0,n.useState)(!1),[M,R]=(0,n.useState)(!1),{toast:D}=(0,Z.pm)(),F=async()=>{try{A(!0);let e=await fetch("/api/v1/bookkeeping/health",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let t=await e.json();s(t)}let t=await fetch("/api/v1/bookkeeping/pending-tasks",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok){let e=await t.json();l(e.tasks||[])}}catch(e){console.error("Error fetching bookkeeping data:",e),D({title:"Error",description:"Failed to fetch bookkeeping data",variant:"destructive"})}finally{d(!1),A(!1)}};return((0,n.useEffect)(()=>{F()},[]),c)?(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(p.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading bookkeeping data..."})]})}):(0,a.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-8 w-8 text-primary"}),"Bookkeeping & Reconciliation"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Automated double-entry bookkeeping with ML-powered categorization"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>F(),disabled:E,children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2 ".concat(E?"animate-spin":"")}),"Refresh"]}),(0,a.jsxs)(r.z,{onClick:()=>R(!0),children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Close Period"]})]})]}),e&&"critical"===e.status&&(0,a.jsxs)(o,{variant:"destructive",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)(h,{children:"Critical Bookkeeping Issues"}),(0,a.jsxs)(x,{children:["Your bookkeeping is ",e.days_behind_reconciliation," days behind.",e.unreconciled_accounts," accounts need reconciliation. Immediate attention required to maintain accurate financial records."]})]}),t.filter(e=>"high"===e.priority).length>0&&(0,a.jsxs)(o,{children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)(h,{children:"High Priority Tasks"}),(0,a.jsxs)(x,{children:["You have ",t.filter(e=>"high"===e.priority).length," high priority bookkeeping tasks that need attention."]})]}),e&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Bookkeeping Health Status"}),(0,a.jsx)(i.SZ,{children:"Overall system health and key metrics"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.C,{className:(e=>{switch(e){case"healthy":return"text-green-600 bg-green-100";case"warning":return"text-yellow-600 bg-yellow-100";case"behind":return"text-orange-600 bg-orange-100";case"critical":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}})(e.status),variant:"outline",children:e.status.toUpperCase()}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Last reconciliation: ",e.last_reconciliation_date||"Never"]})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current Period: ",e.current_period_status]})]}),(0,a.jsx)(ea,{health:e})]})]}),(0,a.jsxs)(u.mQ,{value:b,onValueChange:z,children:[(0,a.jsxs)(u.dr,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(u.SP,{value:"overview",children:"Overview"}),(0,a.jsx)(u.SP,{value:"reconciliation",children:"Reconciliation"}),(0,a.jsx)(u.SP,{value:"journal",children:"Journal Entries"}),(0,a.jsx)(u.SP,{value:"automation",children:"Automation"})]}),(0,a.jsxs)(u.nU,{value:"overview",className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Pending Tasks"}),(0,a.jsx)(i.SZ,{children:"Tasks requiring manual review or action"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsx)(P,{tasks:t,onTaskComplete:F})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Quick Actions"}),(0,a.jsx)(i.SZ,{children:"Common bookkeeping operations"})]}),(0,a.jsxs)(i.aY,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[(0,a.jsx)(N.Z,{className:"h-5 w-5 mb-2"}),(0,a.jsx)("span",{className:"text-xs",children:"Create Entry"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mb-2"}),(0,a.jsx)("span",{className:"text-xs",children:"Reconcile All"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[(0,a.jsx)(w.Z,{className:"h-5 w-5 mb-2"}),(0,a.jsx)("span",{className:"text-xs",children:"Train ML"})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"h-20 flex-col",children:[(0,a.jsx)(_,{className:"h-5 w-5 mb-2"}),(0,a.jsx)("span",{className:"text-xs",children:"Export Data"})]})]})]})]}),(0,a.jsx)(u.nU,{value:"reconciliation",children:(0,a.jsx)(q,{onReconciliationComplete:F})}),(0,a.jsx)(u.nU,{value:"journal",children:(0,a.jsx)(es,{})}),(0,a.jsxs)(u.nU,{value:"automation",className:"space-y-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"ML Categorization"}),(0,a.jsx)(i.SZ,{children:"Machine learning model performance and training"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Accuracy"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(null==e?void 0:e.ml_categorization_accuracy)||0,"%"]})]}),(0,a.jsx)(j.E,{value:(null==e?void 0:e.ml_categorization_accuracy)||0})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Pending Categorizations"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(null==e?void 0:e.pending_categorizations)||0," transactions need review"]})]}),(0,a.jsxs)(r.z,{children:["Review",(0,a.jsx)(k,{className:"h-4 w-4 ml-2"})]})]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-2"}),"Retrain Model"]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Automation Rules"}),(0,a.jsx)(i.SZ,{children:"Configure automated bookkeeping rules"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Manage Journal Entry Templates"]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Configure Accrual Rules"]}),(0,a.jsxs)(r.z,{variant:"outline",className:"w-full justify-start",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 mr-2"}),"Set Categorization Rules"]})]})})]})]})]}),M&&(0,a.jsx)(et,{isOpen:M,onClose:()=>R(!1),onPeriodClosed:F})]})}function ei(){return(0,a.jsx)(en,{})}K.displayName="Textarea"}},function(e){e.O(0,[351,293,528,744],function(){return e(e.s=32903)}),_N_E=e.O()}]);