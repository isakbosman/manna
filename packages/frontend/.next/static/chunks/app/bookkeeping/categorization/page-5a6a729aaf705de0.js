(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{17957:function(e,t,s){Promise.resolve().then(s.bind(s,6050))},6050:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(27573),i=s(7653),r=s(72196),n=s(50466),c=s(38941),l=s(22927),o=s(85745),d=s(50188),h=s(50520),g=s(88623),x=s(31815),m=s(92482),u=s(87354),j=s(36673),p=s(81629),f=s(44242);function y(){let[e,t]=(0,i.useState)([]),[s,y]=(0,i.useState)([]),[v,N]=(0,i.useState)([]),[S,w]=(0,i.useState)(new Set),[z,_]=(0,i.useState)(""),[k,C]=(0,i.useState)(""),[b,A]=(0,i.useState)(!1),[E,Z]=(0,i.useState)(0),[F,M]=(0,i.useState)(!0),{toast:B}=(0,f.pm)();(0,i.useEffect)(()=>{O()},[]);let O=async()=>{try{let e=await fetch("/api/v1/transactions/uncategorized",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let s=await e.json();t(s.transactions||[])}let s=await fetch("/api/v1/categories",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(s.ok){let e=await s.json();y(e.categories||[])}let a=await fetch("/api/v1/tax-categories",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(a.ok){let e=await a.json();N(e.categories||[])}let i=await fetch("/api/v1/ml/model-status",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(i.ok){let e=await i.json();Z(e.accuracy||0)}}catch(e){console.error("Error fetching data:",e)}finally{M(!1)}},T=e=>{w(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},I=async()=>{let t=e.filter(e=>S.has(e.id)&&e.suggested_category);if(0===t.length){B({title:"No Suggestions",description:"Select transactions with suggestions to apply",variant:"destructive"});return}A(!0);try{let e=t.map(e=>{var t;return{transaction_id:e.id,category_id:e.suggested_category.id,tax_category_id:null===(t=e.suggested_tax_category)||void 0===t?void 0:t.id}});if((await fetch("/api/v1/transactions/bulk-categorize",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({updates:e})})).ok)B({title:"Categories Applied",description:"Successfully categorized ".concat(t.length," transactions")}),O(),w(new Set);else throw Error("Failed to apply categories")}catch(e){console.error("Error applying categories:",e),B({title:"Error",description:"Failed to apply categories",variant:"destructive"})}finally{A(!1)}},P=async()=>{if(!z||0===S.size){B({title:"Selection Required",description:"Select transactions and a category",variant:"destructive"});return}A(!0);try{let e=Array.from(S).map(e=>({transaction_id:e,category_id:z,tax_category_id:k||void 0}));if((await fetch("/api/v1/transactions/bulk-categorize",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({updates:e,train_model:!0})})).ok)B({title:"Categories Applied",description:"Successfully categorized ".concat(S.size," transactions")}),O(),w(new Set),_(""),C("");else throw Error("Failed to apply categories")}catch(e){console.error("Error applying categories:",e),B({title:"Error",description:"Failed to apply categories",variant:"destructive"})}finally{A(!1)}},D=async()=>{A(!0);try{let e=await fetch("/api/v1/ml/train",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let t=await e.json();B({title:"Model Training Complete",description:"New accuracy: ".concat((100*t.accuracy).toFixed(1),"%")}),Z(100*t.accuracy)}else throw Error("Failed to train model")}catch(e){console.error("Error training model:",e),B({title:"Error",description:"Failed to train model",variant:"destructive"})}finally{A(!1)}},Y=e=>e>=.9?(0,a.jsxs)(c.C,{className:"bg-green-100 text-green-800",children:["High (",(100*e).toFixed(0),"%)"]}):e>=.7?(0,a.jsxs)(c.C,{className:"bg-yellow-100 text-yellow-800",children:["Medium (",(100*e).toFixed(0),"%)"]}):(0,a.jsxs)(c.C,{className:"bg-red-100 text-red-800",children:["Low (",(100*e).toFixed(0),"%)"]});return F?(0,a.jsx)(r.Zb,{children:(0,a.jsx)(r.aY,{className:"flex items-center justify-center h-96",children:(0,a.jsx)(g.Z,{className:"h-8 w-8 animate-spin text-primary"})})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 text-primary"}),"ML Categorization Engine"]}),(0,a.jsx)(r.SZ,{children:"Automated transaction categorization using machine learning"})]}),(0,a.jsxs)(n.z,{onClick:D,disabled:b,children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Train Model"]})]})}),(0,a.jsx)(r.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Model Accuracy"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.E,{value:E,className:"flex-1"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[E.toFixed(1),"%"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Uncategorized"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"High Confidence"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.filter(e=>{var t;return(null===(t=e.suggested_category)||void 0===t?void 0:t.confidence)&&e.suggested_category.confidence>.9}).length})]})]})})]}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsxs)(r.Ol,{children:[(0,a.jsx)(r.ll,{children:"Bulk Categorization"}),(0,a.jsx)(r.SZ,{children:"Select multiple transactions to categorize at once"})]}),(0,a.jsxs)(r.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(o.Ph,{value:z,onValueChange:_,children:[(0,a.jsx)(o.i4,{className:"flex-1",children:(0,a.jsx)(o.ki,{placeholder:"Select category"})}),(0,a.jsx)(o.Bw,{children:s.map(e=>(0,a.jsx)(o.Ql,{value:e.id,children:e.name},e.id))})]}),(0,a.jsxs)(o.Ph,{value:k,onValueChange:C,children:[(0,a.jsx)(o.i4,{className:"flex-1",children:(0,a.jsx)(o.ki,{placeholder:"Select tax category (optional)"})}),(0,a.jsx)(o.Bw,{children:v.map(e=>(0,a.jsxs)(o.Ql,{value:e.id,children:[e.code," - ",e.name]},e.id))})]}),(0,a.jsxs)(n.z,{onClick:P,disabled:!z||0===S.size||b,children:["Apply to ",S.size," Selected"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>{w(new Set(e.filter(e=>e.suggested_category&&e.suggested_category.confidence>.8).map(e=>e.id)))},disabled:b,children:"Select High Confidence"}),(0,a.jsxs)(n.z,{variant:"outline",onClick:I,disabled:0===S.size||b,children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Apply Suggestions"]})]})]})]}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsxs)(r.Ol,{children:[(0,a.jsx)(r.ll,{children:"Uncategorized Transactions"}),(0,a.jsx)(r.SZ,{children:"Review and categorize transactions with ML suggestions"})]}),(0,a.jsx)(r.aY,{children:0===e.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(u.Z,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"All transactions categorized!"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"No transactions require categorization at this time."})]}):(0,a.jsxs)(d.iA,{children:[(0,a.jsx)(d.xD,{children:(0,a.jsxs)(d.SC,{children:[(0,a.jsx)(d.ss,{className:"w-12",children:(0,a.jsx)(h.X,{checked:S.size===e.length&&e.length>0,onCheckedChange:t=>{t?w(new Set(e.map(e=>e.id))):w(new Set)}})}),(0,a.jsx)(d.ss,{children:"Date"}),(0,a.jsx)(d.ss,{children:"Description"}),(0,a.jsx)(d.ss,{className:"text-right",children:"Amount"}),(0,a.jsx)(d.ss,{children:"Suggested Category"}),(0,a.jsx)(d.ss,{children:"Tax Category"}),(0,a.jsx)(d.ss,{children:"Confidence"}),(0,a.jsx)(d.ss,{children:"Actions"})]})}),(0,a.jsx)(d.RM,{children:e.map(e=>(0,a.jsxs)(d.SC,{children:[(0,a.jsx)(d.pj,{children:(0,a.jsx)(h.X,{checked:S.has(e.id),onCheckedChange:()=>T(e.id)})}),(0,a.jsx)(d.pj,{children:(0,p.WU)(new Date(e.date),"MMM d")}),(0,a.jsx)(d.pj,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.description}),e.merchant_name&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.merchant_name})]})}),(0,a.jsxs)(d.pj,{className:"text-right",children:["$",Math.abs(e.amount).toFixed(2)]}),(0,a.jsx)(d.pj,{children:e.suggested_category?(0,a.jsx)(c.C,{variant:"outline",children:e.suggested_category.name}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"No suggestion"})}),(0,a.jsx)(d.pj,{children:e.suggested_tax_category?(0,a.jsx)(c.C,{variant:"outline",className:"text-xs",children:e.suggested_tax_category.code}):"-"}),(0,a.jsx)(d.pj,{children:e.suggested_category&&Y(e.suggested_category.confidence)}),(0,a.jsx)(d.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[e.suggested_category&&(0,a.jsx)(n.z,{size:"sm",variant:"ghost",onClick:()=>{w(new Set([e.id])),I()},title:"Accept suggestion",children:(0,a.jsx)(u.Z,{className:"h-4 w-4 text-green-600"})}),(0,a.jsx)(n.z,{size:"sm",variant:"ghost",onClick:()=>{var t;B({title:"Similar Transactions",description:"Found ".concat((null===(t=e.similar_transactions)||void 0===t?void 0:t.length)||0," similar transactions")})},title:"View similar",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})}function v(){return(0,a.jsx)("div",{className:"container mx-auto py-6",children:(0,a.jsx)(y,{})})}}},function(e){e.O(0,[351,293,528,744],function(){return e(e.s=17957)}),_N_E=e.O()}]);